<!DOCTYPE html>
<html>
<head>
    <title>PHPXRef 0.7.1 : SimpleID : /www/index.php source</title>
    <link rel="stylesheet" href="../xref.css" type="text/css">
    <link rel="stylesheet" href="../xref-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>
<body>
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of SimpleID</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Mon Apr  6 15:24:46 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='www';
filename='index.php.source.html';
cookiekey='simpleid';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/www/</a> -> <a href="index.php.html">index.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="index.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="index.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php 
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/*</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * SimpleID</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> *</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> * Copyright (C) Kelvin Mo 2007-8</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> *</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> * Includes code Drupal OpenID module (http://drupal.org/project/openid)</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> * Rowan Kerr &lt;rowan@standardinteractive.com&gt;</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * James Walker &lt;james@bryght.com&gt;</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> *</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> * Copyright (C) Rowan Kerr and James Walker</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> *</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> * modify it under the terms of the GNU General Public</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment"> * version 2 of the License, or (at your option) any later version.</span>
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment"> *</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * General Public License for more details.</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> *</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * You should have received a copy of the GNU General Public</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * License along with this program; if not, write to the Free</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * </span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * $Id$</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> */</span>
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">/**</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * Main SimpleID file.</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> *</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * @package simpleid</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * @filesource</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> */</span>
<a name="l36"><span class="linenum">  36</span></a>   
<a name="l37"><span class="linenum">  37</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/version.inc.php.html" onMouseOver="reqPopup(event, 'version.inc.php', '../www/version.inc.php')"> &quot;version.inc.php&quot;</a>;
<a name="l38"><span class="linenum">  38</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/locale.inc.php.html" onMouseOver="reqPopup(event, 'locale.inc.php', '../www/locale.inc.php')"> &quot;locale.inc.php&quot;</a>;
<a name="l39"><span class="linenum">  39</span></a>  
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">// Check if the configuration file has been defined</span>
<a name="l41"><span class="linenum">  41</span></a>  if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>('config.php')) {
<a name="l42"><span class="linenum">  42</span></a>      <a class="phpfunction" onClick="logFunction('die')" href="../_functions/die.html" onMouseOver="phpfuncPopup(event,'die')">die</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('No configuration file found.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for instructions on how to set up a configuration file.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started')));
<a name="l43"><span class="linenum">  43</span></a>  }
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>  include_once &quot;config.php&quot;;
<a name="l46"><span class="linenum">  46</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/config.default.php.html" onMouseOver="reqPopup(event, 'config.default.php', '../www/config.default.php')"> &quot;config.default.php&quot;</a>;
<a name="l47"><span class="linenum">  47</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/log.inc.php.html" onMouseOver="reqPopup(event, 'log.inc.php', '../www/log.inc.php')"> &quot;log.inc.php&quot;</a>;
<a name="l48"><span class="linenum">  48</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/common.inc.php.html" onMouseOver="reqPopup(event, 'common.inc.php', '../www/common.inc.php')"> &quot;common.inc.php&quot;</a>;
<a name="l49"><span class="linenum">  49</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/simpleweb.inc.php.html" onMouseOver="reqPopup(event, 'simpleweb.inc.php', '../www/simpleweb.inc.php')"> &quot;simpleweb.inc.php&quot;</a>;
<a name="l50"><span class="linenum">  50</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/openid.inc.php.html" onMouseOver="reqPopup(event, 'openid.inc.php', '../www/openid.inc.php')"> &quot;openid.inc.php&quot;</a>;
<a name="l51"><span class="linenum">  51</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/discovery.inc.php.html" onMouseOver="reqPopup(event, 'discovery.inc.php', '../www/discovery.inc.php')"> &quot;discovery.inc.php&quot;</a>;
<a name="l52"><span class="linenum">  52</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/user.inc.php.html" onMouseOver="reqPopup(event, 'user.inc.php', '../www/user.inc.php')"> &quot;user.inc.php&quot;</a>;
<a name="l53"><span class="linenum">  53</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/cache.inc.php.html" onMouseOver="reqPopup(event, 'cache.inc.php', '../www/cache.inc.php')"> &quot;cache.inc.php&quot;</a>;
<a name="l54"><span class="linenum">  54</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/filesystem.store.php.html" onMouseOver="reqPopup(event, 'filesystem.store.php', '../www/filesystem.store.php')"> SIMPLEID_STORE . &quot;.store.php&quot;</a>;
<a name="l55"><span class="linenum">  55</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/page.inc.php.html" onMouseOver="reqPopup(event, 'page.inc.php', '../www/page.inc.php')"> &quot;page.inc.php&quot;</a>;
<a name="l56"><span class="linenum">  56</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/lib/xtemplate.class.php.html" onMouseOver="reqPopup(event, 'xtemplate.class.php', '../www/lib/xtemplate.class.php')"> &quot;lib/xtemplate.class.php&quot;</a>;
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CACHE_DIR')" href="../_constants/CACHE_DIR.html" onMouseOver="constPopup(event,'CACHE_DIR')">CACHE_DIR</a>', SIMPLEID_CACHE_DIR);
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">/**</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment"> */</span>
<a name="l62"><span class="linenum">  62</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CHECKID_OK')" href="../_constants/CHECKID_OK.html" onMouseOver="constPopup(event,'CHECKID_OK')">CHECKID_OK</a>', 127);
<a name="l63"><span class="linenum">  63</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CHECKID_RETURN_TO_SUSPECT')" href="../_constants/CHECKID_RETURN_TO_SUSPECT.html" onMouseOver="constPopup(event,'CHECKID_RETURN_TO_SUSPECT')">CHECKID_RETURN_TO_SUSPECT</a>', 3);
<a name="l64"><span class="linenum">  64</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CHECKID_APPROVAL_REQUIRED')" href="../_constants/CHECKID_APPROVAL_REQUIRED.html" onMouseOver="constPopup(event,'CHECKID_APPROVAL_REQUIRED')">CHECKID_APPROVAL_REQUIRED</a>', 2);
<a name="l65"><span class="linenum">  65</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CHECKID_LOGIN_REQUIRED')" href="../_constants/CHECKID_LOGIN_REQUIRED.html" onMouseOver="constPopup(event,'CHECKID_LOGIN_REQUIRED')">CHECKID_LOGIN_REQUIRED</a>', -1);
<a name="l66"><span class="linenum">  66</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CHECKID_IDENTITIES_NOT_MATCHING')" href="../_constants/CHECKID_IDENTITIES_NOT_MATCHING.html" onMouseOver="constPopup(event,'CHECKID_IDENTITIES_NOT_MATCHING')">CHECKID_IDENTITIES_NOT_MATCHING</a>', -2);
<a name="l67"><span class="linenum">  67</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CHECKID_IDENTITY_NOT_EXIST')" href="../_constants/CHECKID_IDENTITY_NOT_EXIST.html" onMouseOver="constPopup(event,'CHECKID_IDENTITY_NOT_EXIST')">CHECKID_IDENTITY_NOT_EXIST</a>', -3);
<a name="l68"><span class="linenum">  68</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CHECKID_PROTOCOL_ERROR')" href="../_constants/CHECKID_PROTOCOL_ERROR.html" onMouseOver="constPopup(event,'CHECKID_PROTOCOL_ERROR')">CHECKID_PROTOCOL_ERROR</a>', -127);
<a name="l69"><span class="linenum">  69</span></a>  
<a name="l70"><span class="linenum">  70</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ASSOCIATION_PRIVATE')" href="../_constants/ASSOCIATION_PRIVATE.html" onMouseOver="constPopup(event,'ASSOCIATION_PRIVATE')">ASSOCIATION_PRIVATE</a>', 2);
<a name="l71"><span class="linenum">  71</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ASSOCIATION_SHARED')" href="../_constants/ASSOCIATION_SHARED.html" onMouseOver="constPopup(event,'ASSOCIATION_SHARED')">ASSOCIATION_SHARED</a>', 1);
<a name="l72"><span class="linenum">  72</span></a>  
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">/**</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment"> * This variable holds the version of the OpenID specification associated with</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment"> * the current OpenID request.  This can be either {@link OPENID_VERSION_1_1}</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment"> * or {@link OPENID_VERSION_2}.</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment"> *</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment"> * @global float $version</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> */</span>
<a name="l81"><span class="linenum">  81</span></a>  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> = <a class="constant" onClick="logConstant('OPENID_VERSION_1_1')" href="../_constants/OPENID_VERSION_1_1.html" onMouseOver="constPopup(event,'OPENID_VERSION_1_1')">OPENID_VERSION_1_1</a>;
<a name="l82"><span class="linenum">  82</span></a>  
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">/**</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment"> * This variable holds an instance of the XTemplate engine.</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment"> *</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="comment"> * @global object $xtpl</span>
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment"> */</span>
<a name="l88"><span class="linenum">  88</span></a>  <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a> = NULL;
<a name="l89"><span class="linenum">  89</span></a>  
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">/**</span>
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment"> * This variable holds the combined $_GET and $_POST superglobal arrays.</span>
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment"> * This is then passed through {@link fix_http_request()}.</span>
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment"> *</span>
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment"> * @global array $GETPOST</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment"> */</span>
<a name="l96"><span class="linenum">  96</span></a>  <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>();
<a name="l97"><span class="linenum">  97</span></a>  
<a name="l98"><span class="linenum">  98</span></a>  <a class="function" onClick="logFunction('simpleid_start')" href="../_functions/simpleid_start.html" onMouseOver="funcPopup(event,'simpleid_start')">simpleid_start</a>();
<a name="l99"><span class="linenum">  99</span></a>  
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment">/**</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment"> * Entry point for SimpleID.</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment"> *</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment"> * @see user_init()</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment"> */</span>
<a name="l105"><span class="linenum"> 105</span></a>  function <a class="function" onClick="logFunction('simpleid_start')" href="../_functions/simpleid_start.html" onMouseOver="funcPopup(event,'simpleid_start')">simpleid_start</a>() {
<a name="l106"><span class="linenum"> 106</span></a>      global <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>, <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>;
<a name="l107"><span class="linenum"> 107</span></a>      
<a name="l108"><span class="linenum"> 108</span></a>      <a class="function" onClick="logFunction('locale_init')" href="../_functions/locale_init.html" onMouseOver="funcPopup(event,'locale_init')">locale_init</a>(SIMPLEID_LOCALE);
<a name="l109"><span class="linenum"> 109</span></a>  
<a name="l110"><span class="linenum"> 110</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('XTemplate')" href="../_classes/xtemplate.html" onMouseOver="classPopup(event,'xtemplate')">XTemplate</a>('html/template.xtpl');
<a name="l111"><span class="linenum"> 111</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('version', <a class="constant" onClick="logConstant('SIMPLEID_VERSION')" href="../_constants/SIMPLEID_VERSION.html" onMouseOver="constPopup(event,'SIMPLEID_VERSION')">SIMPLEID_VERSION</a>);
<a name="l112"><span class="linenum"> 112</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('base_path', <a class="function" onClick="logFunction('get_base_path')" href="../_functions/get_base_path.html" onMouseOver="funcPopup(event,'get_base_path')">get_base_path</a>());
<a name="l113"><span class="linenum"> 113</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('footer_doc', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Documentation'));
<a name="l114"><span class="linenum"> 114</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('footer_support', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Support'));
<a name="l115"><span class="linenum"> 115</span></a>      
<a name="l116"><span class="linenum"> 116</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(SIMPLEID_IDENTITIES_DIR)) {
<a name="l117"><span class="linenum"> 117</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('Identities directory not found.');
<a name="l118"><span class="linenum"> 118</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Identities directory not found.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for instructions on how to set up SimpleID.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started')));
<a name="l119"><span class="linenum"> 119</span></a>      }
<a name="l120"><span class="linenum"> 120</span></a>      
<a name="l121"><span class="linenum"> 121</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(SIMPLEID_CACHE_DIR) || !<a class="phpfunction" onClick="logFunction('is_writeable')" href="../_functions/is_writeable.html" onMouseOver="phpfuncPopup(event,'is_writeable')">is_writeable</a>(SIMPLEID_CACHE_DIR)) {
<a name="l122"><span class="linenum"> 122</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('Cache directory not found or not writeable.');
<a name="l123"><span class="linenum"> 123</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Cache directory not found or not writeable.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for instructions on how to set up SimpleID.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started')));
<a name="l124"><span class="linenum"> 124</span></a>      }
<a name="l125"><span class="linenum"> 125</span></a>      
<a name="l126"><span class="linenum"> 126</span></a>      
<a name="l127"><span class="linenum"> 127</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(SIMPLEID_STORE_DIR) || !<a class="phpfunction" onClick="logFunction('is_writeable')" href="../_functions/is_writeable.html" onMouseOver="phpfuncPopup(event,'is_writeable')">is_writeable</a>(SIMPLEID_STORE_DIR)) {
<a name="l128"><span class="linenum"> 128</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('Store directory not found or not writeable.');
<a name="l129"><span class="linenum"> 129</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Store directory not found or not writeable.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for instructions on how to set up SimpleID.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started')));
<a name="l130"><span class="linenum"> 130</span></a>      }
<a name="l131"><span class="linenum"> 131</span></a>      
<a name="l132"><span class="linenum"> 132</span></a>      if ((@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('register_globals') === 1) || (@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('register_globals') === '1') || (<a class="phpfunction" onClick="logFunction('strtolower')" href="../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('register_globals')) == 'on')) {
<a name="l133"><span class="linenum"> 133</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('register_globals is enabled in PHP configuration.');
<a name="l134"><span class="linenum"> 134</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('register_globals is enabled in PHP configuration, which is not supported by SimpleID.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l135"><span class="linenum"> 135</span></a>      }
<a name="l136"><span class="linenum"> 136</span></a>      
<a name="l137"><span class="linenum"> 137</span></a>      if (!<a class="function" onClick="logFunction('bignum_loaded')" href="../_functions/bignum_loaded.html" onMouseOver="funcPopup(event,'bignum_loaded')">bignum_loaded</a>()) {
<a name="l138"><span class="linenum"> 138</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('gmp/bcmath PHP extension not loaded.');
<a name="l139"><span class="linenum"> 139</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'gmp/bcmath', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l140"><span class="linenum"> 140</span></a>      }
<a name="l141"><span class="linenum"> 141</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('preg_match')) {
<a name="l142"><span class="linenum"> 142</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('pcre PHP extension not loaded.');
<a name="l143"><span class="linenum"> 143</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'pcre', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l144"><span class="linenum"> 144</span></a>      }
<a name="l145"><span class="linenum"> 145</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('session_start')) {
<a name="l146"><span class="linenum"> 146</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('session PHP extension not loaded.');
<a name="l147"><span class="linenum"> 147</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'session', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l148"><span class="linenum"> 148</span></a>      }
<a name="l149"><span class="linenum"> 149</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('xml_parser_create_ns')) {
<a name="l150"><span class="linenum"> 150</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('xml PHP extension not loaded.');
<a name="l151"><span class="linenum"> 151</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'xml', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l152"><span class="linenum"> 152</span></a>      }
<a name="l153"><span class="linenum"> 153</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('hash')) {
<a name="l154"><span class="linenum"> 154</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('hash PHP extension not loaded.');
<a name="l155"><span class="linenum"> 155</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'hash', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l156"><span class="linenum"> 156</span></a>      }
<a name="l157"><span class="linenum"> 157</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('suhosin.get.max_value_length')) &amp;&amp; (@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('suhosin.get.max_value_length') &lt; 1024)) {
<a name="l158"><span class="linenum"> 158</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('suhosin.get.max_value_length &lt; 1024');
<a name="l159"><span class="linenum"> 159</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('suhosin.get.max_value_length is less than 1024, which will lead to problems. See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l160"><span class="linenum"> 160</span></a>      }
<a name="l161"><span class="linenum"> 161</span></a>  
<a name="l162"><span class="linenum"> 162</span></a>      <a class="function" onClick="logFunction('fix_http_request')" href="../_functions/fix_http_request.html" onMouseOver="funcPopup(event,'fix_http_request')">fix_http_request</a>();
<a name="l163"><span class="linenum"> 163</span></a>      <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it30" onMouseOver="hilite(30)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../_variables/_GET.html">$_GET</a>, <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('_POST')" href="../_variables/_POST.html">$_POST</a>);
<a name="l164"><span class="linenum"> 164</span></a>      <a class="function" onClick="logFunction('openid_parse_request')" href="../_functions/openid_parse_request.html" onMouseOver="funcPopup(event,'openid_parse_request')">openid_parse_request</a>(<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>);
<a name="l165"><span class="linenum"> 165</span></a>      
<a name="l166"><span class="linenum"> 166</span></a>      <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a> = (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['q'])) ? <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['q'] : '';
<a name="l167"><span class="linenum"> 167</span></a>      
<a name="l168"><span class="linenum"> 168</span></a>      <a class="var it222" onMouseOver="hilite(222)" onMouseOut="lolite()" onClick="logVariable('uaid')" href="../_variables/uaid.html">$uaid</a> = <a class="function" onClick="logFunction('get_user_agent_id')" href="../_functions/get_user_agent_id.html" onMouseOver="funcPopup(event,'get_user_agent_id')">get_user_agent_id</a>();
<a name="l169"><span class="linenum"> 169</span></a>      <a class="function" onClick="logFunction('extension_init')" href="../_functions/extension_init.html" onMouseOver="funcPopup(event,'extension_init')">extension_init</a>();
<a name="l170"><span class="linenum"> 170</span></a>      <a class="function" onClick="logFunction('user_init')" href="../_functions/user_init.html" onMouseOver="funcPopup(event,'user_init')">user_init</a>(<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a>);
<a name="l171"><span class="linenum"> 171</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('Session opened for &quot;' . <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a> . '&quot; from ' . <a class="var it222" onMouseOver="hilite(222)" onMouseOut="lolite()" onClick="logVariable('uaid')" href="../_variables/uaid.html">$uaid</a> . ' [' . <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../_variables/_SERVER.html">$_SERVER</a>['REMOTE_ADDR'] . ', ' . <a class="phpfunction" onClick="logFunction('gethostbyaddr')" href="../_functions/gethostbyaddr.html" onMouseOver="phpfuncPopup(event,'gethostbyaddr')">gethostbyaddr</a>(<a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../_variables/_SERVER.html">$_SERVER</a>['REMOTE_ADDR']) . ']');
<a name="l172"><span class="linenum"> 172</span></a>      
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">    // Clean stale assocations</span>
<a name="l174"><span class="linenum"> 174</span></a>      <a class="function" onClick="logFunction('cache_expire')" href="../_functions/cache_expire.html" onMouseOver="funcPopup(event,'cache_expire')">cache_expire</a>(<a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l175"><span class="linenum"> 175</span></a>          'association' =&gt; SIMPLEID_ASSOC_EXPIRES_IN,
<a name="l176"><span class="linenum"> 176</span></a>          'stateless' =&gt; 300)
<a name="l177"><span class="linenum"> 177</span></a>      );
<a name="l178"><span class="linenum"> 178</span></a>      
<a name="l179"><span class="linenum"> 179</span></a>      <a class="function" onClick="logFunction('simpleid_route')" href="../_functions/simpleid_route.html" onMouseOver="funcPopup(event,'simpleid_route')">simpleid_route</a>(<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a>);
<a name="l180"><span class="linenum"> 180</span></a>  }
<a name="l181"><span class="linenum"> 181</span></a>  
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment">/**</span>
<a name="l183"><span class="linenum"> 183</span></a>  <span class="comment"> * Dispatches to the correct SimpleID function based on the request path.  The</span>
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment"> * request path usually comes from the q parameter in the query string (which may</span>
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment"> * be inserted by mod_rewrite), but can come from other functions as well.</span>
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment"> *</span>
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment"> * @param string $q the request path</span>
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment"> */</span>
<a name="l189"><span class="linenum"> 189</span></a>  function <a class="function" onClick="logFunction('simpleid_route')" href="../_functions/simpleid_route.html" onMouseOver="funcPopup(event,'simpleid_route')">simpleid_route</a>(<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a>) {
<a name="l190"><span class="linenum"> 190</span></a>      <a class="var it248" onMouseOver="hilite(248)" onMouseOut="lolite()" onClick="logVariable('routes')" href="../_variables/routes.html">$routes</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l191"><span class="linenum"> 191</span></a>          'continue' =&gt; 'simpleid_continue',
<a name="l192"><span class="linenum"> 192</span></a>          'login' =&gt; 'user_login',
<a name="l193"><span class="linenum"> 193</span></a>          'logout' =&gt; 'user_logout',
<a name="l194"><span class="linenum"> 194</span></a>          'my/dashboard' =&gt; 'page_dashboard',
<a name="l195"><span class="linenum"> 195</span></a>          'my/sites' =&gt; 'page_sites',
<a name="l196"><span class="linenum"> 196</span></a>          'my/profile' =&gt; 'page_profile',
<a name="l197"><span class="linenum"> 197</span></a>          'otp' =&gt; 'user_otp_page',
<a name="l198"><span class="linenum"> 198</span></a>          'openid/consent' =&gt; 'simpleid_openid_consent',
<a name="l199"><span class="linenum"> 199</span></a>          'ppid/(.*)' =&gt; 'user_ppid_page',
<a name="l200"><span class="linenum"> 200</span></a>          'user' =&gt; 'user_public_page',
<a name="l201"><span class="linenum"> 201</span></a>          'user/(.+)' =&gt; 'user_public_page',
<a name="l202"><span class="linenum"> 202</span></a>          'xrds/(.*)' =&gt; 'user_xrds',
<a name="l203"><span class="linenum"> 203</span></a>          'xrds' =&gt; 'simpleid_xrds',
<a name="l204"><span class="linenum"> 204</span></a>      );
<a name="l205"><span class="linenum"> 205</span></a>      <a class="var it248" onMouseOver="hilite(248)" onMouseOut="lolite()" onClick="logVariable('routes')" href="../_variables/routes.html">$routes</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it248" onMouseOver="hilite(248)" onMouseOut="lolite()" onClick="logVariable('routes')" href="../_variables/routes.html">$routes</a>, <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('routes'), <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('.*' =&gt; 'simpleid_index'));
<a name="l206"><span class="linenum"> 206</span></a>      
<a name="l207"><span class="linenum"> 207</span></a>      <a class="function" onClick="logFunction('simpleweb_run')" href="../_functions/simpleweb_run.html" onMouseOver="funcPopup(event,'simpleweb_run')">simpleweb_run</a>(<a class="var it248" onMouseOver="hilite(248)" onMouseOut="lolite()" onClick="logVariable('routes')" href="../_variables/routes.html">$routes</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a>);
<a name="l208"><span class="linenum"> 208</span></a>  }
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment">/**</span>
<a name="l211"><span class="linenum"> 211</span></a>  <span class="comment"> * The default route, called when the q parameter is missing or is invalid.</span>
<a name="l212"><span class="linenum"> 212</span></a>  <span class="comment"> *</span>
<a name="l213"><span class="linenum"> 213</span></a>  <span class="comment"> * This function performs the following:</span>
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment"> *</span>
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment"> * - If openid.mode is present, then the request is an OpenID request.  This</span>
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment"> *   is passed to {@link simpleid_process_openid()}</span>
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment"> * - If the Accept HTTP header contains the expression application/xrds+xml, then</span>
<a name="l218"><span class="linenum"> 218</span></a>  <span class="comment"> *   the request is a YADIS discovery request for SimpleID as an OpenID provider.  Thi</span>
<a name="l219"><span class="linenum"> 219</span></a>  <span class="comment"> *   is passed to {@link simpleid_xrds()}</span>
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment"> * - Otherwise, the dashboard or the login page is displayed to the user as</span>
<a name="l221"><span class="linenum"> 221</span></a>  <span class="comment"> *   appropriate</span>
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment"> *</span>
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment"> */</span>
<a name="l224"><span class="linenum"> 224</span></a>  function <a class="function" onClick="logFunction('simpleid_index')" href="../_functions/simpleid_index.html" onMouseOver="funcPopup(event,'simpleid_index')">simpleid_index</a>() {
<a name="l225"><span class="linenum"> 225</span></a>      global <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>;
<a name="l226"><span class="linenum"> 226</span></a>      
<a name="l227"><span class="linenum"> 227</span></a>      <a class="function" onClick="logFunction('log_debug')" href="../_functions/log_debug.html" onMouseOver="funcPopup(event,'log_debug')">log_debug</a>('simpleid_index');
<a name="l228"><span class="linenum"> 228</span></a>      
<a name="l229"><span class="linenum"> 229</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('content_type')" href="../_variables/content_type.html">$content_type</a> = <a class="function" onClick="logFunction('negotiate_content_type')" href="../_functions/negotiate_content_type.html" onMouseOver="funcPopup(event,'negotiate_content_type')">negotiate_content_type</a>(<a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('text/html', 'application/xml', 'application/xhtml+xml', 'application/xrds+xml'));
<a name="l230"><span class="linenum"> 230</span></a>      
<a name="l231"><span class="linenum"> 231</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Vary: Accept');
<a name="l232"><span class="linenum"> 232</span></a>      if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['openid.mode'])) {
<a name="l233"><span class="linenum"> 233</span></a>          <a class="function" onClick="logFunction('simpleid_process_openid')" href="../_functions/simpleid_process_openid.html" onMouseOver="funcPopup(event,'simpleid_process_openid')">simpleid_process_openid</a>(<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>);
<a name="l234"><span class="linenum"> 234</span></a>          return;
<a name="l235"><span class="linenum"> 235</span></a>      } elseif (<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('content_type')" href="../_variables/content_type.html">$content_type</a> == 'application/xrds+xml') {
<a name="l236"><span class="linenum"> 236</span></a>          <a class="function" onClick="logFunction('simpleid_xrds')" href="../_functions/simpleid_xrds.html" onMouseOver="funcPopup(event,'simpleid_xrds')">simpleid_xrds</a>();
<a name="l237"><span class="linenum"> 237</span></a>      } else {
<a name="l238"><span class="linenum"> 238</span></a>  <span class="comment">        // Point to SimpleID's XRDS document</span>
<a name="l239"><span class="linenum"> 239</span></a>          <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('X-XRDS-Location: ' . <a class="function" onClick="logFunction('simpleid_url')" href="../_functions/simpleid_url.html" onMouseOver="funcPopup(event,'simpleid_url')">simpleid_url</a>('xrds'));
<a name="l240"><span class="linenum"> 240</span></a>          <a class="function" onClick="logFunction('page_dashboard')" href="../_functions/page_dashboard.html" onMouseOver="funcPopup(event,'page_dashboard')">page_dashboard</a>();
<a name="l241"><span class="linenum"> 241</span></a>      }
<a name="l242"><span class="linenum"> 242</span></a>  }
<a name="l243"><span class="linenum"> 243</span></a>  
<a name="l244"><span class="linenum"> 244</span></a>  
<a name="l245"><span class="linenum"> 245</span></a>  <span class="comment">/**</span>
<a name="l246"><span class="linenum"> 246</span></a>  <span class="comment"> * Process an OpenID request.</span>
<a name="l247"><span class="linenum"> 247</span></a>  <span class="comment"> *</span>
<a name="l248"><span class="linenum"> 248</span></a>  <span class="comment"> * This function determines the version of the OpenID specification that is</span>
<a name="l249"><span class="linenum"> 249</span></a>  <span class="comment"> * relevant to this request, checks openid.mode and passes the</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment"> * request on to the function required to process the request.</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment"> *</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment"> * The OpenID request expressed as an array contain key-value pairs corresponding</span>
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment"> * to the HTTP request.  This is usually contained in the &lt;code&gt;$_REQUEST&lt;/code&gt;</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment"> * variable.</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment"> *</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment"> * @param array $request the OpenID request</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment"> */</span>
<a name="l258"><span class="linenum"> 258</span></a>  function <a class="function" onClick="logFunction('simpleid_process_openid')" href="../_functions/simpleid_process_openid.html" onMouseOver="funcPopup(event,'simpleid_process_openid')">simpleid_process_openid</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>) {
<a name="l259"><span class="linenum"> 259</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l260"><span class="linenum"> 260</span></a>      
<a name="l261"><span class="linenum"> 261</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> = <a class="function" onClick="logFunction('openid_get_version')" href="../_functions/openid_get_version.html" onMouseOver="funcPopup(event,'openid_get_version')">openid_get_version</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l262"><span class="linenum"> 262</span></a>      
<a name="l263"><span class="linenum"> 263</span></a>      switch (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.mode']) {
<a name="l264"><span class="linenum"> 264</span></a>          case 'associate':
<a name="l265"><span class="linenum"> 265</span></a>              <a class="function" onClick="logFunction('simpleid_associate')" href="../_functions/simpleid_associate.html" onMouseOver="funcPopup(event,'simpleid_associate')">simpleid_associate</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l266"><span class="linenum"> 266</span></a>              return;
<a name="l267"><span class="linenum"> 267</span></a>          case 'checkid_immediate':
<a name="l268"><span class="linenum"> 268</span></a>          case 'checkid_setup':
<a name="l269"><span class="linenum"> 269</span></a>              <a class="function" onClick="logFunction('check_https')" href="../_functions/check_https.html" onMouseOver="funcPopup(event,'check_https')">check_https</a>('redirect', true, <a class="function" onClick="logFunction('simpleid_url')" href="../_functions/simpleid_url.html" onMouseOver="funcPopup(event,'simpleid_url')">simpleid_url</a>('continue', 's=' . <a class="phpfunction" onClick="logFunction('rawurlencode')" href="../_functions/rawurlencode.html" onMouseOver="phpfuncPopup(event,'rawurlencode')">rawurlencode</a>(<a class="function" onClick="logFunction('pickle')" href="../_functions/pickle.html" onMouseOver="funcPopup(event,'pickle')">pickle</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>)), false, 'https'));
<a name="l270"><span class="linenum"> 270</span></a>              
<a name="l271"><span class="linenum"> 271</span></a>              return <a class="function" onClick="logFunction('simpleid_checkid')" href="../_functions/simpleid_checkid.html" onMouseOver="funcPopup(event,'simpleid_checkid')">simpleid_checkid</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l272"><span class="linenum"> 272</span></a>          case 'check_authentication':
<a name="l273"><span class="linenum"> 273</span></a>              <a class="function" onClick="logFunction('simpleid_check_authentication')" href="../_functions/simpleid_check_authentication.html" onMouseOver="funcPopup(event,'simpleid_check_authentication')">simpleid_check_authentication</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l274"><span class="linenum"> 274</span></a>              break;
<a name="l275"><span class="linenum"> 275</span></a>          default:
<a name="l276"><span class="linenum"> 276</span></a>              if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'])) {
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment">                // Indirect communication - send error via indirect communication.</span>
<a name="l278"><span class="linenum"> 278</span></a>                  <a class="function" onClick="logFunction('header_response_code')" href="../_functions/header_response_code.html" onMouseOver="funcPopup(event,'header_response_code')">header_response_code</a>('400 Bad Request');
<a name="l279"><span class="linenum"> 279</span></a>                  <a class="function" onClick="logFunction('set_message')" href="../_functions/set_message.html" onMouseOver="funcPopup(event,'set_message')">set_message</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Invalid OpenID message.'));
<a name="l280"><span class="linenum"> 280</span></a>                  <a class="function" onClick="logFunction('page_dashboard')" href="../_functions/page_dashboard.html" onMouseOver="funcPopup(event,'page_dashboard')">page_dashboard</a>();
<a name="l281"><span class="linenum"> 281</span></a>              } else {
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">                // Direct communication</span>
<a name="l283"><span class="linenum"> 283</span></a>                  <a class="function" onClick="logFunction('openid_direct_error')" href="../_functions/openid_direct_error.html" onMouseOver="funcPopup(event,'openid_direct_error')">openid_direct_error</a>('Invalid OpenID message.');
<a name="l284"><span class="linenum"> 284</span></a>              }
<a name="l285"><span class="linenum"> 285</span></a>      }
<a name="l286"><span class="linenum"> 286</span></a>  }
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment">/**</span>
<a name="l289"><span class="linenum"> 289</span></a>  <span class="comment"> * Processes an association request from a relying party.</span>
<a name="l290"><span class="linenum"> 290</span></a>  <span class="comment"> *</span>
<a name="l291"><span class="linenum"> 291</span></a>  <span class="comment"> * An association request has an openid.mode value of</span>
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment"> * associate.  This function checks whether the association request</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment"> * is valid, and if so, creates an association and sends the response to</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment"> * the relying party.</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment"> *</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment"> * @see _simpleid_create_association()</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment"> * @param array $request the OpenID request</span>
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment"> * @link http://openid.net/specs/openid-authentication-1_1.html#mode_associate, http://openid.net/specs/openid-authentication-2_0.html#associations</span>
<a name="l299"><span class="linenum"> 299</span></a>  <span class="comment"> *</span>
<a name="l300"><span class="linenum"> 300</span></a>  <span class="comment"> */</span>
<a name="l301"><span class="linenum"> 301</span></a>  function <a class="function" onClick="logFunction('simpleid_associate')" href="../_functions/simpleid_associate.html" onMouseOver="funcPopup(event,'simpleid_associate')">simpleid_associate</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>) {
<a name="l302"><span class="linenum"> 302</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l303"><span class="linenum"> 303</span></a>      
<a name="l304"><span class="linenum"> 304</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID association request: ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>));
<a name="l305"><span class="linenum"> 305</span></a>      
<a name="l306"><span class="linenum"> 306</span></a>      <a class="var it455" onMouseOver="hilite(455)" onMouseOut="lolite()" onClick="logVariable('assoc_types')" href="../_variables/assoc_types.html">$assoc_types</a> = <a class="function" onClick="logFunction('openid_association_types')" href="../_functions/openid_association_types.html" onMouseOver="funcPopup(event,'openid_association_types')">openid_association_types</a>();
<a name="l307"><span class="linenum"> 307</span></a>      <a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('session_types')" href="../_variables/session_types.html">$session_types</a> = <a class="function" onClick="logFunction('openid_session_types')" href="../_functions/openid_session_types.html" onMouseOver="funcPopup(event,'openid_session_types')">openid_session_types</a>(<a class="function" onClick="logFunction('is_https')" href="../_functions/is_https.html" onMouseOver="funcPopup(event,'is_https')">is_https</a>(), <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l308"><span class="linenum"> 308</span></a>  
<a name="l309"><span class="linenum"> 309</span></a>  <span class="comment">    // Common Request Parameters [8.1.1]</span>
<a name="l310"><span class="linenum"> 310</span></a>      if ((<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> == <a class="constant" onClick="logConstant('OPENID_VERSION_1_1')" href="../_constants/OPENID_VERSION_1_1.html" onMouseOver="constPopup(event,'OPENID_VERSION_1_1')">OPENID_VERSION_1_1</a>) &amp;&amp; !<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.session_type'])) <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.session_type'] = '';
<a name="l311"><span class="linenum"> 311</span></a>      <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('assoc_type')" href="../_variables/assoc_type.html">$assoc_type</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.assoc_type'];
<a name="l312"><span class="linenum"> 312</span></a>      <a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.session_type'];
<a name="l313"><span class="linenum"> 313</span></a>      
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">    // Diffie-Hellman Request Parameters [8.1.2]</span>
<a name="l315"><span class="linenum"> 315</span></a>      <a class="var it174" onMouseOver="hilite(174)" onMouseOut="lolite()" onClick="logVariable('dh_modulus')" href="../_variables/dh_modulus.html">$dh_modulus</a> = (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.dh_modulus'])) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.dh_modulus'] : NULL;
<a name="l316"><span class="linenum"> 316</span></a>      <a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('dh_gen')" href="../_variables/dh_gen.html">$dh_gen</a> = (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.dh_gen'])) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.dh_gen'] : NULL;
<a name="l317"><span class="linenum"> 317</span></a>      <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('dh_consumer_public')" href="../_variables/dh_consumer_public.html">$dh_consumer_public</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.dh_consumer_public'];
<a name="l318"><span class="linenum"> 318</span></a>      
<a name="l319"><span class="linenum"> 319</span></a>      if (!<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.session_type']) || !<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.assoc_type'])) {
<a name="l320"><span class="linenum"> 320</span></a>          <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('Association failed: openid.session_type or openid.assoc_type not set');
<a name="l321"><span class="linenum"> 321</span></a>          <a class="function" onClick="logFunction('openid_direct_error')" href="../_functions/openid_direct_error.html" onMouseOver="funcPopup(event,'openid_direct_error')">openid_direct_error</a>('openid.session_type or openid.assoc_type not set');
<a name="l322"><span class="linenum"> 322</span></a>          return;
<a name="l323"><span class="linenum"> 323</span></a>      }
<a name="l324"><span class="linenum"> 324</span></a>      
<a name="l325"><span class="linenum"> 325</span></a>  <span class="comment">    // Check if the assoc_type is supported</span>
<a name="l326"><span class="linenum"> 326</span></a>      if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('assoc_type')" href="../_variables/assoc_type.html">$assoc_type</a>, <a class="var it455" onMouseOver="hilite(455)" onMouseOut="lolite()" onClick="logVariable('assoc_types')" href="../_variables/assoc_types.html">$assoc_types</a>)) {
<a name="l327"><span class="linenum"> 327</span></a>          <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('error')" href="../_variables/error.html">$error</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l328"><span class="linenum"> 328</span></a>              'error_code' =&gt; 'unsupported-type',
<a name="l329"><span class="linenum"> 329</span></a>              'session_type' =&gt; 'DH-SHA1',
<a name="l330"><span class="linenum"> 330</span></a>              'assoc_type' =&gt; 'HMAC-SHA1'
<a name="l331"><span class="linenum"> 331</span></a>          );
<a name="l332"><span class="linenum"> 332</span></a>          <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('Association failed: The association type is not supported by SimpleID.');
<a name="l333"><span class="linenum"> 333</span></a>          <a class="function" onClick="logFunction('openid_direct_error')" href="../_functions/openid_direct_error.html" onMouseOver="funcPopup(event,'openid_direct_error')">openid_direct_error</a>('The association type is not supported by SimpleID.', <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('error')" href="../_variables/error.html">$error</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l334"><span class="linenum"> 334</span></a>          return;
<a name="l335"><span class="linenum"> 335</span></a>      }
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">    // Check if the session_type is supported</span>
<a name="l337"><span class="linenum"> 337</span></a>      if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a>, <a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('session_types')" href="../_variables/session_types.html">$session_types</a>)) {
<a name="l338"><span class="linenum"> 338</span></a>          <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('error')" href="../_variables/error.html">$error</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l339"><span class="linenum"> 339</span></a>              'error_code' =&gt; 'unsupported-type',
<a name="l340"><span class="linenum"> 340</span></a>              'session_type' =&gt; 'DH-SHA1',
<a name="l341"><span class="linenum"> 341</span></a>              'assoc_type' =&gt; 'HMAC-SHA1'
<a name="l342"><span class="linenum"> 342</span></a>          );
<a name="l343"><span class="linenum"> 343</span></a>          <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('Association failed: The session type is not supported by SimpleID.');
<a name="l344"><span class="linenum"> 344</span></a>          <a class="function" onClick="logFunction('openid_direct_error')" href="../_functions/openid_direct_error.html" onMouseOver="funcPopup(event,'openid_direct_error')">openid_direct_error</a>('The session type is not supported by SimpleID.', <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('error')" href="../_variables/error.html">$error</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l345"><span class="linenum"> 345</span></a>          return;
<a name="l346"><span class="linenum"> 346</span></a>      }
<a name="l347"><span class="linenum"> 347</span></a>      
<a name="l348"><span class="linenum"> 348</span></a>      if (<a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a> == 'DH-SHA1' || <a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a> == 'DH-SHA256') {
<a name="l349"><span class="linenum"> 349</span></a>          if (!<a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('dh_consumer_public')" href="../_variables/dh_consumer_public.html">$dh_consumer_public</a>) {
<a name="l350"><span class="linenum"> 350</span></a>              <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('Association failed: openid.dh_consumer_public not set');
<a name="l351"><span class="linenum"> 351</span></a>              <a class="function" onClick="logFunction('openid_direct_error')" href="../_functions/openid_direct_error.html" onMouseOver="funcPopup(event,'openid_direct_error')">openid_direct_error</a>('openid.dh_consumer_public not set');
<a name="l352"><span class="linenum"> 352</span></a>              return;
<a name="l353"><span class="linenum"> 353</span></a>          }
<a name="l354"><span class="linenum"> 354</span></a>      }
<a name="l355"><span class="linenum"> 355</span></a>  
<a name="l356"><span class="linenum"> 356</span></a>      <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('_simpleid_create_association')" href="../_functions/_simpleid_create_association.html" onMouseOver="funcPopup(event,'_simpleid_create_association')">_simpleid_create_association</a>(<a class="constant" onClick="logConstant('ASSOCIATION_SHARED')" href="../_constants/ASSOCIATION_SHARED.html" onMouseOver="constPopup(event,'ASSOCIATION_SHARED')">ASSOCIATION_SHARED</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('assoc_type')" href="../_variables/assoc_type.html">$assoc_type</a>, <a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a>, <a class="var it174" onMouseOver="hilite(174)" onMouseOut="lolite()" onClick="logVariable('dh_modulus')" href="../_variables/dh_modulus.html">$dh_modulus</a>, <a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('dh_gen')" href="../_variables/dh_gen.html">$dh_gen</a>, <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('dh_consumer_public')" href="../_variables/dh_consumer_public.html">$dh_consumer_public</a>);
<a name="l357"><span class="linenum"> 357</span></a>      
<a name="l358"><span class="linenum"> 358</span></a>      <a class="function" onClick="logFunction('openid_direct_response')" href="../_functions/openid_direct_response.html" onMouseOver="funcPopup(event,'openid_direct_response')">openid_direct_response</a>(<a class="function" onClick="logFunction('openid_direct_message')" href="../_functions/openid_direct_message.html" onMouseOver="funcPopup(event,'openid_direct_message')">openid_direct_message</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>));
<a name="l359"><span class="linenum"> 359</span></a>  }
<a name="l360"><span class="linenum"> 360</span></a>  
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment">/**</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment"> * Creates an association.</span>
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment"> *</span>
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment"> * This function calls {@link openid_dh_server_assoc()} where required, to </span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment"> * generate the cryptographic values required for an association response.</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment"> *</span>
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment"> * @param int $mode either ASSOCIATION_SHARED or ASSOCIATION_PRIVATE</span>
<a name="l369"><span class="linenum"> 369</span></a>  <span class="comment"> * @param string $assoc_type a valid OpenID association type</span>
<a name="l370"><span class="linenum"> 370</span></a>  <span class="comment"> * @param string $session_type a valid OpenID session type</span>
<a name="l371"><span class="linenum"> 371</span></a>  <span class="comment"> * @param string $dh_modulus for Diffie-Hellman key exchange, the modulus encoded in Base64</span>
<a name="l372"><span class="linenum"> 372</span></a>  <span class="comment"> * @param string $dh_gen for Diffie-Hellman key exchange, g encoded in Base64</span>
<a name="l373"><span class="linenum"> 373</span></a>  <span class="comment"> * @param string $dh_consumer_public for Diffie-Hellman key exchange, the public key of the relying party encoded in Base64</span>
<a name="l374"><span class="linenum"> 374</span></a>  <span class="comment"> * @return mixed if $mode is ASSOCIATION_SHARED, an OpenID response</span>
<a name="l375"><span class="linenum"> 375</span></a>  <span class="comment"> * to the association request, if $mode is ASSOCIATION_PRIVATE, the</span>
<a name="l376"><span class="linenum"> 376</span></a>  <span class="comment"> * association data for storage.</span>
<a name="l377"><span class="linenum"> 377</span></a>  <span class="comment"> * @link http://openid.net/specs/openid-authentication-1_1.html#anchor14, http://openid.net/specs/openid-authentication-2_0.html#anchor20</span>
<a name="l378"><span class="linenum"> 378</span></a>  <span class="comment"> */</span>
<a name="l379"><span class="linenum"> 379</span></a>  function <a class="function" onClick="logFunction('_simpleid_create_association')" href="../_functions/_simpleid_create_association.html" onMouseOver="funcPopup(event,'_simpleid_create_association')">_simpleid_create_association</a>(<a class="var it6" onMouseOver="hilite(6)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../_variables/mode.html">$mode</a> = <a class="constant" onClick="logConstant('ASSOCIATION_SHARED')" href="../_constants/ASSOCIATION_SHARED.html" onMouseOver="constPopup(event,'ASSOCIATION_SHARED')">ASSOCIATION_SHARED</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('assoc_type')" href="../_variables/assoc_type.html">$assoc_type</a> = 'HMAC-SHA1', <a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a> = 'no-encryption', <a class="var it174" onMouseOver="hilite(174)" onMouseOut="lolite()" onClick="logVariable('dh_modulus')" href="../_variables/dh_modulus.html">$dh_modulus</a> = NULL, <a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('dh_gen')" href="../_variables/dh_gen.html">$dh_gen</a> = NULL, <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('dh_consumer_public')" href="../_variables/dh_consumer_public.html">$dh_consumer_public</a> = NULL) {
<a name="l380"><span class="linenum"> 380</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l381"><span class="linenum"> 381</span></a>      
<a name="l382"><span class="linenum"> 382</span></a>      <a class="var it455" onMouseOver="hilite(455)" onMouseOut="lolite()" onClick="logVariable('assoc_types')" href="../_variables/assoc_types.html">$assoc_types</a> = <a class="function" onClick="logFunction('openid_association_types')" href="../_functions/openid_association_types.html" onMouseOver="funcPopup(event,'openid_association_types')">openid_association_types</a>();
<a name="l383"><span class="linenum"> 383</span></a>      <a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('session_types')" href="../_variables/session_types.html">$session_types</a> = <a class="function" onClick="logFunction('openid_session_types')" href="../_functions/openid_session_types.html" onMouseOver="funcPopup(event,'openid_session_types')">openid_session_types</a>(<a class="function" onClick="logFunction('is_https')" href="../_functions/is_https.html" onMouseOver="funcPopup(event,'is_https')">is_https</a>(), <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l384"><span class="linenum"> 384</span></a>      
<a name="l385"><span class="linenum"> 385</span></a>      <a class="var it458" onMouseOver="hilite(458)" onMouseOut="lolite()" onClick="logVariable('mac_size')" href="../_variables/mac_size.html">$mac_size</a> = <a class="var it455" onMouseOver="hilite(455)" onMouseOut="lolite()" onClick="logVariable('assoc_types')" href="../_variables/assoc_types.html">$assoc_types</a>[<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('assoc_type')" href="../_variables/assoc_type.html">$assoc_type</a>]['mac_size'];
<a name="l386"><span class="linenum"> 386</span></a>      <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('hmac_func')" href="../_variables/hmac_func.html">$hmac_func</a> = <a class="var it455" onMouseOver="hilite(455)" onMouseOut="lolite()" onClick="logVariable('assoc_types')" href="../_variables/assoc_types.html">$assoc_types</a>[<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('assoc_type')" href="../_variables/assoc_type.html">$assoc_type</a>]['hmac_func'];
<a name="l387"><span class="linenum"> 387</span></a>      
<a name="l388"><span class="linenum"> 388</span></a>      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('assoc_handle')" href="../_variables/assoc_handle.html">$assoc_handle</a> = <a class="function" onClick="logFunction('random_id')" href="../_functions/random_id.html" onMouseOver="funcPopup(event,'random_id')">random_id</a>();
<a name="l389"><span class="linenum"> 389</span></a>      <a class="var it460" onMouseOver="hilite(460)" onMouseOut="lolite()" onClick="logVariable('expires_in')" href="../_variables/expires_in.html">$expires_in</a> = SIMPLEID_ASSOC_EXPIRES_IN;
<a name="l390"><span class="linenum"> 390</span></a>      
<a name="l391"><span class="linenum"> 391</span></a>      <a class="var it204" onMouseOver="hilite(204)" onMouseOut="lolite()" onClick="logVariable('secret')" href="../_variables/secret.html">$secret</a> = <a class="function" onClick="logFunction('random_bytes')" href="../_functions/random_bytes.html" onMouseOver="funcPopup(event,'random_bytes')">random_bytes</a>(<a class="var it458" onMouseOver="hilite(458)" onMouseOut="lolite()" onClick="logVariable('mac_size')" href="../_variables/mac_size.html">$mac_size</a>);
<a name="l392"><span class="linenum"> 392</span></a>      
<a name="l393"><span class="linenum"> 393</span></a>      <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l394"><span class="linenum"> 394</span></a>          'assoc_handle' =&gt; <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('assoc_handle')" href="../_variables/assoc_handle.html">$assoc_handle</a>,
<a name="l395"><span class="linenum"> 395</span></a>          'assoc_type' =&gt; <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('assoc_type')" href="../_variables/assoc_type.html">$assoc_type</a>,
<a name="l396"><span class="linenum"> 396</span></a>          'expires_in' =&gt; <a class="var it460" onMouseOver="hilite(460)" onMouseOut="lolite()" onClick="logVariable('expires_in')" href="../_variables/expires_in.html">$expires_in</a>
<a name="l397"><span class="linenum"> 397</span></a>      );
<a name="l398"><span class="linenum"> 398</span></a>      
<a name="l399"><span class="linenum"> 399</span></a>  <span class="comment">    // If $session_type is '', then it must be using OpenID 1.1 (blank parameter</span>
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment">    // is not allowed for OpenID 2.0.  For OpenID 1.1 blank requests, we don't</span>
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment">    // put a session_type in the response.</span>
<a name="l402"><span class="linenum"> 402</span></a>      if (<a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a> != '') <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['session_type'] = <a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a>;
<a name="l403"><span class="linenum"> 403</span></a>      
<a name="l404"><span class="linenum"> 404</span></a>      if ((<a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a> == 'no-encryption') || (<a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a> == '')) {
<a name="l405"><span class="linenum"> 405</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('mac_key')" href="../_variables/mac_key.html">$mac_key</a> = <a class="phpfunction" onClick="logFunction('base64_encode')" href="../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="phpfunction" onClick="logFunction('call_user_func')" href="../_functions/call_user_func.html" onMouseOver="phpfuncPopup(event,'call_user_func')">call_user_func</a>(<a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('hmac_func')" href="../_variables/hmac_func.html">$hmac_func</a>, <a class="var it204" onMouseOver="hilite(204)" onMouseOut="lolite()" onClick="logVariable('secret')" href="../_variables/secret.html">$secret</a>, <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['assoc_handle']));
<a name="l406"><span class="linenum"> 406</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['mac_key'] = <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('mac_key')" href="../_variables/mac_key.html">$mac_key</a>;
<a name="l407"><span class="linenum"> 407</span></a>      } elseif (<a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a> == 'DH-SHA1' || <a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a> == 'DH-SHA256') {
<a name="l408"><span class="linenum"> 408</span></a>          <a class="var it176" onMouseOver="hilite(176)" onMouseOut="lolite()" onClick="logVariable('hash_func')" href="../_variables/hash_func.html">$hash_func</a> = <a class="var it171" onMouseOver="hilite(171)" onMouseOut="lolite()" onClick="logVariable('session_types')" href="../_variables/session_types.html">$session_types</a>[<a class="var it457" onMouseOver="hilite(457)" onMouseOut="lolite()" onClick="logVariable('session_type')" href="../_variables/session_type.html">$session_type</a>]['hash_func'];
<a name="l409"><span class="linenum"> 409</span></a>          
<a name="l410"><span class="linenum"> 410</span></a>          <a class="var it461" onMouseOver="hilite(461)" onMouseOut="lolite()" onClick="logVariable('dh_assoc')" href="../_variables/dh_assoc.html">$dh_assoc</a> = <a class="function" onClick="logFunction('openid_dh_server_assoc')" href="../_functions/openid_dh_server_assoc.html" onMouseOver="funcPopup(event,'openid_dh_server_assoc')">openid_dh_server_assoc</a>(<a class="var it204" onMouseOver="hilite(204)" onMouseOut="lolite()" onClick="logVariable('secret')" href="../_variables/secret.html">$secret</a>, <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('dh_consumer_public')" href="../_variables/dh_consumer_public.html">$dh_consumer_public</a>, <a class="var it174" onMouseOver="hilite(174)" onMouseOut="lolite()" onClick="logVariable('dh_modulus')" href="../_variables/dh_modulus.html">$dh_modulus</a>, <a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('dh_gen')" href="../_variables/dh_gen.html">$dh_gen</a>, <a class="var it176" onMouseOver="hilite(176)" onMouseOut="lolite()" onClick="logVariable('hash_func')" href="../_variables/hash_func.html">$hash_func</a>);
<a name="l411"><span class="linenum"> 411</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('mac_key')" href="../_variables/mac_key.html">$mac_key</a> = <a class="phpfunction" onClick="logFunction('base64_encode')" href="../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="var it204" onMouseOver="hilite(204)" onMouseOut="lolite()" onClick="logVariable('secret')" href="../_variables/secret.html">$secret</a>);
<a name="l412"><span class="linenum"> 412</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['dh_server_public'] = <a class="var it461" onMouseOver="hilite(461)" onMouseOut="lolite()" onClick="logVariable('dh_assoc')" href="../_variables/dh_assoc.html">$dh_assoc</a>['dh_server_public'];
<a name="l413"><span class="linenum"> 413</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['enc_mac_key'] = <a class="var it461" onMouseOver="hilite(461)" onMouseOut="lolite()" onClick="logVariable('dh_assoc')" href="../_variables/dh_assoc.html">$dh_assoc</a>['enc_mac_key'];
<a name="l414"><span class="linenum"> 414</span></a>      }
<a name="l415"><span class="linenum"> 415</span></a>  
<a name="l416"><span class="linenum"> 416</span></a>      <a class="var it462" onMouseOver="hilite(462)" onMouseOut="lolite()" onClick="logVariable('association')" href="../_variables/association.html">$association</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('assoc_handle' =&gt; <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('assoc_handle')" href="../_variables/assoc_handle.html">$assoc_handle</a>, 'assoc_type' =&gt; <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('assoc_type')" href="../_variables/assoc_type.html">$assoc_type</a>, 'mac_key' =&gt; <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('mac_key')" href="../_variables/mac_key.html">$mac_key</a>, 'created' =&gt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>());
<a name="l417"><span class="linenum"> 417</span></a>      if (<a class="var it6" onMouseOver="hilite(6)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../_variables/mode.html">$mode</a> == <a class="constant" onClick="logConstant('ASSOCIATION_PRIVATE')" href="../_constants/ASSOCIATION_PRIVATE.html" onMouseOver="constPopup(event,'ASSOCIATION_PRIVATE')">ASSOCIATION_PRIVATE</a>) <a class="var it462" onMouseOver="hilite(462)" onMouseOut="lolite()" onClick="logVariable('association')" href="../_variables/association.html">$association</a>['private'] = 1;
<a name="l418"><span class="linenum"> 418</span></a>      <a class="function" onClick="logFunction('cache_set')" href="../_functions/cache_set.html" onMouseOver="funcPopup(event,'cache_set')">cache_set</a>('association', <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('assoc_handle')" href="../_variables/assoc_handle.html">$assoc_handle</a>, <a class="var it462" onMouseOver="hilite(462)" onMouseOut="lolite()" onClick="logVariable('association')" href="../_variables/association.html">$association</a>);
<a name="l419"><span class="linenum"> 419</span></a>  
<a name="l420"><span class="linenum"> 420</span></a>      if (<a class="var it6" onMouseOver="hilite(6)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../_variables/mode.html">$mode</a> == <a class="constant" onClick="logConstant('ASSOCIATION_SHARED')" href="../_constants/ASSOCIATION_SHARED.html" onMouseOver="constPopup(event,'ASSOCIATION_SHARED')">ASSOCIATION_SHARED</a>) {
<a name="l421"><span class="linenum"> 421</span></a>          <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('Created association: ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>));
<a name="l422"><span class="linenum"> 422</span></a>          <a class="function" onClick="logFunction('log_debug')" href="../_functions/log_debug.html" onMouseOver="funcPopup(event,'log_debug')">log_debug</a>('***** MAC key: ' . <a class="var it462" onMouseOver="hilite(462)" onMouseOut="lolite()" onClick="logVariable('association')" href="../_variables/association.html">$association</a>['mac_key']);
<a name="l423"><span class="linenum"> 423</span></a>          return <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>;
<a name="l424"><span class="linenum"> 424</span></a>      } else {
<a name="l425"><span class="linenum"> 425</span></a>          <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('Created association: private; ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it462" onMouseOver="hilite(462)" onMouseOut="lolite()" onClick="logVariable('association')" href="../_variables/association.html">$association</a>, <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('assoc_handle', 'assoc_type')));
<a name="l426"><span class="linenum"> 426</span></a>          <a class="function" onClick="logFunction('log_debug')" href="../_functions/log_debug.html" onMouseOver="funcPopup(event,'log_debug')">log_debug</a>('***** MAC key: ' . <a class="var it462" onMouseOver="hilite(462)" onMouseOut="lolite()" onClick="logVariable('association')" href="../_variables/association.html">$association</a>['mac_key']);
<a name="l427"><span class="linenum"> 427</span></a>          return <a class="var it462" onMouseOver="hilite(462)" onMouseOut="lolite()" onClick="logVariable('association')" href="../_variables/association.html">$association</a>;
<a name="l428"><span class="linenum"> 428</span></a>      }
<a name="l429"><span class="linenum"> 429</span></a>  }
<a name="l430"><span class="linenum"> 430</span></a>  
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>  <span class="comment">/**</span>
<a name="l433"><span class="linenum"> 433</span></a>  <span class="comment"> * Processes an authentication request from a relying party.</span>
<a name="l434"><span class="linenum"> 434</span></a>  <span class="comment"> *</span>
<a name="l435"><span class="linenum"> 435</span></a>  <span class="comment"> * An authentication request has an openid.mode value of</span>
<a name="l436"><span class="linenum"> 436</span></a>  <span class="comment"> * checkid_setup or checkid_immediate.</span>
<a name="l437"><span class="linenum"> 437</span></a>  <span class="comment"> *</span>
<a name="l438"><span class="linenum"> 438</span></a>  <span class="comment"> * If the authentication request is a standard OpenID request about an identity</span>
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment"> * (i.e. contains the key openid.identity), this function calls</span>
<a name="l440"><span class="linenum"> 440</span></a>  <span class="comment"> * {@link simpleid_checkid_identity()} to see whether the user logged on into SimpleID</span>
<a name="l441"><span class="linenum"> 441</span></a>  <span class="comment"> * matches the identity supplied in the OpenID request.</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment"> *</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment"> * If the authentication request is not about an identity, this function calls</span>
<a name="l444"><span class="linenum"> 444</span></a>  <span class="comment"> * the {@link hook_checkid() checkid hook} of the loaded extensions.</span>
<a name="l445"><span class="linenum"> 445</span></a>  <span class="comment"> *</span>
<a name="l446"><span class="linenum"> 446</span></a>  <span class="comment"> * Depending on the OpenID version, this function will supply an appropriate</span>
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment"> * assertion.</span>
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment"> *</span>
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment"> * @param array $request the OpenID request</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment"> *</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment"> */</span>
<a name="l452"><span class="linenum"> 452</span></a>  function <a class="function" onClick="logFunction('simpleid_checkid')" href="../_functions/simpleid_checkid.html" onMouseOver="funcPopup(event,'simpleid_checkid')">simpleid_checkid</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>) {
<a name="l453"><span class="linenum"> 453</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l454"><span class="linenum"> 454</span></a>      
<a name="l455"><span class="linenum"> 455</span></a>      <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a> = (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.mode'] == 'checkid_immediate');
<a name="l456"><span class="linenum"> 456</span></a>      
<a name="l457"><span class="linenum"> 457</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID authentication request: ' . ((<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>) ? 'immediate' : 'setup') . '; '. <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>));
<a name="l458"><span class="linenum"> 458</span></a>  
<a name="l459"><span class="linenum"> 459</span></a>  <span class="comment">    // Check for protocol correctness    </span>
<a name="l460"><span class="linenum"> 460</span></a>      if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> == <a class="constant" onClick="logConstant('OPENID_VERSION_1_1')" href="../_constants/OPENID_VERSION_1_1.html" onMouseOver="constPopup(event,'OPENID_VERSION_1_1')">OPENID_VERSION_1_1</a>) {
<a name="l461"><span class="linenum"> 461</span></a>          if (!<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'])) {
<a name="l462"><span class="linenum"> 462</span></a>              <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('Protocol Error: openid.return_to not set.');
<a name="l463"><span class="linenum"> 463</span></a>              <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Protocol Error: openid.return_to not set.'));
<a name="l464"><span class="linenum"> 464</span></a>              return;
<a name="l465"><span class="linenum"> 465</span></a>          }
<a name="l466"><span class="linenum"> 466</span></a>          if (!<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity'])) {
<a name="l467"><span class="linenum"> 467</span></a>              <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('Protocol Error: openid.identity not set.');
<a name="l468"><span class="linenum"> 468</span></a>              <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Protocol Error: openid.identity not set.'));
<a name="l469"><span class="linenum"> 469</span></a>              return;
<a name="l470"><span class="linenum"> 470</span></a>          }
<a name="l471"><span class="linenum"> 471</span></a>      }
<a name="l472"><span class="linenum"> 472</span></a>  
<a name="l473"><span class="linenum"> 473</span></a>      if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> &gt;= <a class="constant" onClick="logConstant('OPENID_VERSION_2')" href="../_constants/OPENID_VERSION_2.html" onMouseOver="constPopup(event,'OPENID_VERSION_2')">OPENID_VERSION_2</a>) {
<a name="l474"><span class="linenum"> 474</span></a>          if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity']) &amp;&amp; !<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.claimed_id'])) {
<a name="l475"><span class="linenum"> 475</span></a>              <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('Protocol Error: openid.identity set, but not openid.claimed_id.');
<a name="l476"><span class="linenum"> 476</span></a>              <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Protocol Error: openid.identity set, but not openid.claimed_id.'));
<a name="l477"><span class="linenum"> 477</span></a>              return;
<a name="l478"><span class="linenum"> 478</span></a>          }
<a name="l479"><span class="linenum"> 479</span></a>          
<a name="l480"><span class="linenum"> 480</span></a>          if (!<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.realm']) &amp;&amp; !<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'])) {
<a name="l481"><span class="linenum"> 481</span></a>              <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('Protocol Error: openid.return_to not set when openid.realm is not set.');
<a name="l482"><span class="linenum"> 482</span></a>              <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Protocol Error: openid.return_to not set when openid.realm is not set.'));
<a name="l483"><span class="linenum"> 483</span></a>              return;
<a name="l484"><span class="linenum"> 484</span></a>          }
<a name="l485"><span class="linenum"> 485</span></a>      }
<a name="l486"><span class="linenum"> 486</span></a>      
<a name="l487"><span class="linenum"> 487</span></a>      if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'])) {
<a name="l488"><span class="linenum"> 488</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a> = <a class="function" onClick="logFunction('openid_get_realm')" href="../_functions/openid_get_realm.html" onMouseOver="funcPopup(event,'openid_get_realm')">openid_get_realm</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l489"><span class="linenum"> 489</span></a>          
<a name="l490"><span class="linenum"> 490</span></a>          if (!<a class="function" onClick="logFunction('openid_url_matches_realm')" href="../_functions/openid_url_matches_realm.html" onMouseOver="funcPopup(event,'openid_url_matches_realm')">openid_url_matches_realm</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'], <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>)) {
<a name="l491"><span class="linenum"> 491</span></a>              <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('Protocol Error: openid.return_to does not match realm.');
<a name="l492"><span class="linenum"> 492</span></a>              <a class="function" onClick="logFunction('openid_indirect_error')" href="../_functions/openid_indirect_error.html" onMouseOver="funcPopup(event,'openid_indirect_error')">openid_indirect_error</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'], 'Protocol Error: openid.return_to does not match realm.');
<a name="l493"><span class="linenum"> 493</span></a>              return;
<a name="l494"><span class="linenum"> 494</span></a>          }
<a name="l495"><span class="linenum"> 495</span></a>      }
<a name="l496"><span class="linenum"> 496</span></a>      
<a name="l497"><span class="linenum"> 497</span></a>      if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity'])) {
<a name="l498"><span class="linenum"> 498</span></a>  <span class="comment">        // Standard request</span>
<a name="l499"><span class="linenum"> 499</span></a>          <a class="function" onClick="logFunction('log_debug')" href="../_functions/log_debug.html" onMouseOver="funcPopup(event,'log_debug')">log_debug</a>('openid.identity found, use simpleid_checkid_identity');
<a name="l500"><span class="linenum"> 500</span></a>          <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="function" onClick="logFunction('simpleid_checkid_identity')" href="../_functions/simpleid_checkid_identity.html" onMouseOver="funcPopup(event,'simpleid_checkid_identity')">simpleid_checkid_identity</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>);
<a name="l501"><span class="linenum"> 501</span></a>      } else {
<a name="l502"><span class="linenum"> 502</span></a>          <a class="function" onClick="logFunction('log_debug')" href="../_functions/log_debug.html" onMouseOver="funcPopup(event,'log_debug')">log_debug</a>('openid.identity not found, trying extensions');
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment">        // Extension request</span>
<a name="l504"><span class="linenum"> 504</span></a>          <a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a> = <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('checkid', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>);
<a name="l505"><span class="linenum"> 505</span></a>          
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment">        // Filter out nulls</span>
<a name="l507"><span class="linenum"> 507</span></a>          <a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="phpfunction" onClick="logFunction('array_diff')" href="../_functions/array_diff.html" onMouseOver="phpfuncPopup(event,'array_diff')">array_diff</a>(<a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a>, <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(NULL)));
<a name="l508"><span class="linenum"> 508</span></a>          
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment">        // If there are still results, it is the lowest value, otherwise, it is CHECKID_PROTOCOL_ERROR</span>
<a name="l510"><span class="linenum"> 510</span></a>          <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = (<a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a>) ? <a class="phpfunction" onClick="logFunction('min')" href="../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">min</a>(<a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a>) : <a class="constant" onClick="logConstant('CHECKID_PROTOCOL_ERROR')" href="../_constants/CHECKID_PROTOCOL_ERROR.html" onMouseOver="constPopup(event,'CHECKID_PROTOCOL_ERROR')">CHECKID_PROTOCOL_ERROR</a>;
<a name="l511"><span class="linenum"> 511</span></a>      }
<a name="l512"><span class="linenum"> 512</span></a>      
<a name="l513"><span class="linenum"> 513</span></a>      switch (<a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>) {
<a name="l514"><span class="linenum"> 514</span></a>          case <a class="constant" onClick="logConstant('CHECKID_APPROVAL_REQUIRED')" href="../_constants/CHECKID_APPROVAL_REQUIRED.html" onMouseOver="constPopup(event,'CHECKID_APPROVAL_REQUIRED')">CHECKID_APPROVAL_REQUIRED</a>:
<a name="l515"><span class="linenum"> 515</span></a>              <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('<a class="constant" onClick="logConstant('CHECKID_APPROVAL_REQUIRED')" href="../_constants/CHECKID_APPROVAL_REQUIRED.html" onMouseOver="constPopup(event,'CHECKID_APPROVAL_REQUIRED')">CHECKID_APPROVAL_REQUIRED</a>');
<a name="l516"><span class="linenum"> 516</span></a>              if (<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>) {
<a name="l517"><span class="linenum"> 517</span></a>                  <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_checkid_approval_required')" href="../_functions/simpleid_checkid_approval_required.html" onMouseOver="funcPopup(event,'simpleid_checkid_approval_required')">simpleid_checkid_approval_required</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l518"><span class="linenum"> 518</span></a>                  <a class="function" onClick="logFunction('simpleid_assertion_response')" href="../_functions/simpleid_assertion_response.html" onMouseOver="funcPopup(event,'simpleid_assertion_response')">simpleid_assertion_response</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to']);
<a name="l519"><span class="linenum"> 519</span></a>              } else {
<a name="l520"><span class="linenum"> 520</span></a>                  <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_checkid_ok')" href="../_functions/simpleid_checkid_ok.html" onMouseOver="funcPopup(event,'simpleid_checkid_ok')">simpleid_checkid_ok</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l521"><span class="linenum"> 521</span></a>                  <a class="function" onClick="logFunction('simpleid_openid_consent_form')" href="../_functions/simpleid_openid_consent_form.html" onMouseOver="funcPopup(event,'simpleid_openid_consent_form')">simpleid_openid_consent_form</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>);
<a name="l522"><span class="linenum"> 522</span></a>              }
<a name="l523"><span class="linenum"> 523</span></a>              break;
<a name="l524"><span class="linenum"> 524</span></a>          case <a class="constant" onClick="logConstant('CHECKID_RETURN_TO_SUSPECT')" href="../_constants/CHECKID_RETURN_TO_SUSPECT.html" onMouseOver="constPopup(event,'CHECKID_RETURN_TO_SUSPECT')">CHECKID_RETURN_TO_SUSPECT</a>:
<a name="l525"><span class="linenum"> 525</span></a>              <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('<a class="constant" onClick="logConstant('CHECKID_RETURN_TO_SUSPECT')" href="../_constants/CHECKID_RETURN_TO_SUSPECT.html" onMouseOver="constPopup(event,'CHECKID_RETURN_TO_SUSPECT')">CHECKID_RETURN_TO_SUSPECT</a>');
<a name="l526"><span class="linenum"> 526</span></a>              if (<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>) {
<a name="l527"><span class="linenum"> 527</span></a>                  <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_checkid_error')" href="../_functions/simpleid_checkid_error.html" onMouseOver="funcPopup(event,'simpleid_checkid_error')">simpleid_checkid_error</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>);
<a name="l528"><span class="linenum"> 528</span></a>                  <a class="function" onClick="logFunction('simpleid_assertion_response')" href="../_functions/simpleid_assertion_response.html" onMouseOver="funcPopup(event,'simpleid_assertion_response')">simpleid_assertion_response</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to']);
<a name="l529"><span class="linenum"> 529</span></a>              } else {
<a name="l530"><span class="linenum"> 530</span></a>                  <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_checkid_ok')" href="../_functions/simpleid_checkid_ok.html" onMouseOver="funcPopup(event,'simpleid_checkid_ok')">simpleid_checkid_ok</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l531"><span class="linenum"> 531</span></a>                  <a class="function" onClick="logFunction('simpleid_openid_consent_form')" href="../_functions/simpleid_openid_consent_form.html" onMouseOver="funcPopup(event,'simpleid_openid_consent_form')">simpleid_openid_consent_form</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>);
<a name="l532"><span class="linenum"> 532</span></a>              }
<a name="l533"><span class="linenum"> 533</span></a>              break;
<a name="l534"><span class="linenum"> 534</span></a>          case <a class="constant" onClick="logConstant('CHECKID_OK')" href="../_constants/CHECKID_OK.html" onMouseOver="constPopup(event,'CHECKID_OK')">CHECKID_OK</a>:
<a name="l535"><span class="linenum"> 535</span></a>              <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('<a class="constant" onClick="logConstant('CHECKID_OK')" href="../_constants/CHECKID_OK.html" onMouseOver="constPopup(event,'CHECKID_OK')">CHECKID_OK</a>');
<a name="l536"><span class="linenum"> 536</span></a>              <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_checkid_ok')" href="../_functions/simpleid_checkid_ok.html" onMouseOver="funcPopup(event,'simpleid_checkid_ok')">simpleid_checkid_ok</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l537"><span class="linenum"> 537</span></a>              <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_sign')" href="../_functions/simpleid_sign.html" onMouseOver="funcPopup(event,'simpleid_sign')">simpleid_sign</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.assoc_handle']) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.assoc_handle'] : NULL);
<a name="l538"><span class="linenum"> 538</span></a>              <a class="function" onClick="logFunction('simpleid_assertion_response')" href="../_functions/simpleid_assertion_response.html" onMouseOver="funcPopup(event,'simpleid_assertion_response')">simpleid_assertion_response</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to']);
<a name="l539"><span class="linenum"> 539</span></a>              break;
<a name="l540"><span class="linenum"> 540</span></a>          case <a class="constant" onClick="logConstant('CHECKID_LOGIN_REQUIRED')" href="../_constants/CHECKID_LOGIN_REQUIRED.html" onMouseOver="constPopup(event,'CHECKID_LOGIN_REQUIRED')">CHECKID_LOGIN_REQUIRED</a>:
<a name="l541"><span class="linenum"> 541</span></a>              <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('<a class="constant" onClick="logConstant('CHECKID_LOGIN_REQUIRED')" href="../_constants/CHECKID_LOGIN_REQUIRED.html" onMouseOver="constPopup(event,'CHECKID_LOGIN_REQUIRED')">CHECKID_LOGIN_REQUIRED</a>');
<a name="l542"><span class="linenum"> 542</span></a>              if (<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>) {
<a name="l543"><span class="linenum"> 543</span></a>                  <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_checkid_login_required')" href="../_functions/simpleid_checkid_login_required.html" onMouseOver="funcPopup(event,'simpleid_checkid_login_required')">simpleid_checkid_login_required</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l544"><span class="linenum"> 544</span></a>                  <a class="function" onClick="logFunction('simpleid_assertion_response')" href="../_functions/simpleid_assertion_response.html" onMouseOver="funcPopup(event,'simpleid_assertion_response')">simpleid_assertion_response</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to']);
<a name="l545"><span class="linenum"> 545</span></a>              } else {
<a name="l546"><span class="linenum"> 546</span></a>                  <a class="function" onClick="logFunction('user_login_form')" href="../_functions/user_login_form.html" onMouseOver="funcPopup(event,'user_login_form')">user_login_form</a>('continue', <a class="function" onClick="logFunction('pickle')" href="../_functions/pickle.html" onMouseOver="funcPopup(event,'pickle')">pickle</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>));
<a name="l547"><span class="linenum"> 547</span></a>                  exit;
<a name="l548"><span class="linenum"> 548</span></a>              }
<a name="l549"><span class="linenum"> 549</span></a>              break;
<a name="l550"><span class="linenum"> 550</span></a>          case <a class="constant" onClick="logConstant('CHECKID_IDENTITIES_NOT_MATCHING')" href="../_constants/CHECKID_IDENTITIES_NOT_MATCHING.html" onMouseOver="constPopup(event,'CHECKID_IDENTITIES_NOT_MATCHING')">CHECKID_IDENTITIES_NOT_MATCHING</a>:
<a name="l551"><span class="linenum"> 551</span></a>          case <a class="constant" onClick="logConstant('CHECKID_IDENTITY_NOT_EXIST')" href="../_constants/CHECKID_IDENTITY_NOT_EXIST.html" onMouseOver="constPopup(event,'CHECKID_IDENTITY_NOT_EXIST')">CHECKID_IDENTITY_NOT_EXIST</a>:
<a name="l552"><span class="linenum"> 552</span></a>              <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('<a class="constant" onClick="logConstant('CHECKID_IDENTITIES_NOT_MATCHING')" href="../_constants/CHECKID_IDENTITIES_NOT_MATCHING.html" onMouseOver="constPopup(event,'CHECKID_IDENTITIES_NOT_MATCHING')">CHECKID_IDENTITIES_NOT_MATCHING</a> | <a class="constant" onClick="logConstant('CHECKID_IDENTITY_NOT_EXIST')" href="../_constants/CHECKID_IDENTITY_NOT_EXIST.html" onMouseOver="constPopup(event,'CHECKID_IDENTITY_NOT_EXIST')">CHECKID_IDENTITY_NOT_EXIST</a>');
<a name="l553"><span class="linenum"> 553</span></a>              <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_checkid_error')" href="../_functions/simpleid_checkid_error.html" onMouseOver="funcPopup(event,'simpleid_checkid_error')">simpleid_checkid_error</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>);
<a name="l554"><span class="linenum"> 554</span></a>              if (<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>) {                
<a name="l555"><span class="linenum"> 555</span></a>                  <a class="function" onClick="logFunction('simpleid_assertion_response')" href="../_functions/simpleid_assertion_response.html" onMouseOver="funcPopup(event,'simpleid_assertion_response')">simpleid_assertion_response</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to']);
<a name="l556"><span class="linenum"> 556</span></a>              } else {                
<a name="l557"><span class="linenum"> 557</span></a>                  <a class="function" onClick="logFunction('simpleid_openid_consent_form')" href="../_functions/simpleid_openid_consent_form.html" onMouseOver="funcPopup(event,'simpleid_openid_consent_form')">simpleid_openid_consent_form</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>);                
<a name="l558"><span class="linenum"> 558</span></a>              }
<a name="l559"><span class="linenum"> 559</span></a>              break;
<a name="l560"><span class="linenum"> 560</span></a>          case <a class="constant" onClick="logConstant('CHECKID_PROTOCOL_ERROR')" href="../_constants/CHECKID_PROTOCOL_ERROR.html" onMouseOver="constPopup(event,'CHECKID_PROTOCOL_ERROR')">CHECKID_PROTOCOL_ERROR</a>:
<a name="l561"><span class="linenum"> 561</span></a>              if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'])) {
<a name="l562"><span class="linenum"> 562</span></a>                  <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_checkid_error')" href="../_functions/simpleid_checkid_error.html" onMouseOver="funcPopup(event,'simpleid_checkid_error')">simpleid_checkid_error</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>);
<a name="l563"><span class="linenum"> 563</span></a>                  <a class="function" onClick="logFunction('simpleid_assertion_response')" href="../_functions/simpleid_assertion_response.html" onMouseOver="funcPopup(event,'simpleid_assertion_response')">simpleid_assertion_response</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to']);
<a name="l564"><span class="linenum"> 564</span></a>              } else {
<a name="l565"><span class="linenum"> 565</span></a>                  <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>('Unrecognised request.');
<a name="l566"><span class="linenum"> 566</span></a>              }
<a name="l567"><span class="linenum"> 567</span></a>              break;
<a name="l568"><span class="linenum"> 568</span></a>      }
<a name="l569"><span class="linenum"> 569</span></a>  }
<a name="l570"><span class="linenum"> 570</span></a>  
<a name="l571"><span class="linenum"> 571</span></a>  <span class="comment">/**</span>
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment"> * Processes a standard OpenID authentication request about an identity.</span>
<a name="l573"><span class="linenum"> 573</span></a>  <span class="comment"> *</span>
<a name="l574"><span class="linenum"> 574</span></a>  <span class="comment"> * Checks whether the current user logged into SimpleID matches the identity</span>
<a name="l575"><span class="linenum"> 575</span></a>  <span class="comment"> * supplied in an OpenID request.</span>
<a name="l576"><span class="linenum"> 576</span></a>  <span class="comment"> *</span>
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment"> * @param array &amp;$request the OpenID request</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment"> * @param bool $immediate whether checkid_immediate was used</span>
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment"> * @return int one of CHECKID_OK, CHECKID_APPROVAL_REQUIRED, CHECKID_RETURN_TO_SUSPECT, CHECKID_IDENTITY_NOT_EXIST,</span>
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment"> * CHECKID_IDENTITIES_NOT_MATCHING, CHECKID_LOGIN_REQUIRED or CHECKID_PROTOCOL_ERROR</span>
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment"> * @global array the current logged in user</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment"> */</span>
<a name="l583"><span class="linenum"> 583</span></a>  function <a class="function" onClick="logFunction('simpleid_checkid_identity')" href="../_functions/simpleid_checkid_identity.html" onMouseOver="funcPopup(event,'simpleid_checkid_identity')">simpleid_checkid_identity</a>(&amp;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>) {
<a name="l584"><span class="linenum"> 584</span></a>      global <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l585"><span class="linenum"> 585</span></a>      
<a name="l586"><span class="linenum"> 586</span></a>      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a> = <a class="function" onClick="logFunction('openid_get_realm')" href="../_functions/openid_get_realm.html" onMouseOver="funcPopup(event,'openid_get_realm')">openid_get_realm</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l587"><span class="linenum"> 587</span></a>      
<a name="l588"><span class="linenum"> 588</span></a>  <span class="comment">    // Check 1: Is the user logged into SimpleID as any user?</span>
<a name="l589"><span class="linenum"> 589</span></a>      if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> == NULL) {
<a name="l590"><span class="linenum"> 590</span></a>          return <a class="constant" onClick="logConstant('CHECKID_LOGIN_REQUIRED')" href="../_constants/CHECKID_LOGIN_REQUIRED.html" onMouseOver="constPopup(event,'CHECKID_LOGIN_REQUIRED')">CHECKID_LOGIN_REQUIRED</a>;
<a name="l591"><span class="linenum"> 591</span></a>      } else {
<a name="l592"><span class="linenum"> 592</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('uid')" href="../_variables/uid.html">$uid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['uid'];
<a name="l593"><span class="linenum"> 593</span></a>      }
<a name="l594"><span class="linenum"> 594</span></a>      
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment">    // Check 2: Is the user logged in as the same identity as the identity requested?</span>
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment">    // Choose the identity URL for the user automatically</span>
<a name="l597"><span class="linenum"> 597</span></a>      if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity'] == <a class="constant" onClick="logConstant('OPENID_IDENTIFIER_SELECT')" href="../_constants/OPENID_IDENTIFIER_SELECT.html" onMouseOver="constPopup(event,'OPENID_IDENTIFIER_SELECT')">OPENID_IDENTIFIER_SELECT</a>) {
<a name="l598"><span class="linenum"> 598</span></a>          <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('test_user')" href="../_variables/test_user.html">$test_user</a> = <a class="function" onClick="logFunction('user_load')" href="../_functions/user_load.html" onMouseOver="funcPopup(event,'user_load')">user_load</a>(<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('uid')" href="../_variables/uid.html">$uid</a>);
<a name="l599"><span class="linenum"> 599</span></a>          <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('identity')" href="../_variables/identity.html">$identity</a> = <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('test_user')" href="../_variables/test_user.html">$test_user</a>['identity'];
<a name="l600"><span class="linenum"> 600</span></a>          
<a name="l601"><span class="linenum"> 601</span></a>          <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID identifier selection: Selected ' . <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('uid')" href="../_variables/uid.html">$uid</a> . ' [' . <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('identity')" href="../_variables/identity.html">$identity</a> . ']');
<a name="l602"><span class="linenum"> 602</span></a>      } else {
<a name="l603"><span class="linenum"> 603</span></a>          <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('identity')" href="../_variables/identity.html">$identity</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity'];
<a name="l604"><span class="linenum"> 604</span></a>          <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('test_user')" href="../_variables/test_user.html">$test_user</a> = <a class="function" onClick="logFunction('user_load_from_identity')" href="../_functions/user_load_from_identity.html" onMouseOver="funcPopup(event,'user_load_from_identity')">user_load_from_identity</a>(<a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('identity')" href="../_variables/identity.html">$identity</a>);
<a name="l605"><span class="linenum"> 605</span></a>      }
<a name="l606"><span class="linenum"> 606</span></a>      if (<a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('test_user')" href="../_variables/test_user.html">$test_user</a> == NULL) return <a class="constant" onClick="logConstant('CHECKID_IDENTITY_NOT_EXIST')" href="../_constants/CHECKID_IDENTITY_NOT_EXIST.html" onMouseOver="constPopup(event,'CHECKID_IDENTITY_NOT_EXIST')">CHECKID_IDENTITY_NOT_EXIST</a>;
<a name="l607"><span class="linenum"> 607</span></a>      if (<a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('test_user')" href="../_variables/test_user.html">$test_user</a>['uid'] != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['uid']) {
<a name="l608"><span class="linenum"> 608</span></a>          <a class="function" onClick="logFunction('log_notice')" href="../_functions/log_notice.html" onMouseOver="funcPopup(event,'log_notice')">log_notice</a>('Requested user ' . <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('test_user')" href="../_variables/test_user.html">$test_user</a>['uid'] . ' does not match logged in user ' . <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['uid']);
<a name="l609"><span class="linenum"> 609</span></a>          return <a class="constant" onClick="logConstant('CHECKID_IDENTITIES_NOT_MATCHING')" href="../_constants/CHECKID_IDENTITIES_NOT_MATCHING.html" onMouseOver="constPopup(event,'CHECKID_IDENTITIES_NOT_MATCHING')">CHECKID_IDENTITIES_NOT_MATCHING</a>;
<a name="l610"><span class="linenum"> 610</span></a>      }
<a name="l611"><span class="linenum"> 611</span></a>      
<a name="l612"><span class="linenum"> 612</span></a>  <span class="comment">    // Pass the assertion to extensions</span>
<a name="l613"><span class="linenum"> 613</span></a>      <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('assertion_results')" href="../_variables/assertion_results.html">$assertion_results</a> = <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('checkid_identity', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('identity')" href="../_variables/identity.html">$identity</a>, <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>);
<a name="l614"><span class="linenum"> 614</span></a>      <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('assertion_results')" href="../_variables/assertion_results.html">$assertion_results</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="phpfunction" onClick="logFunction('array_diff')" href="../_functions/array_diff.html" onMouseOver="phpfuncPopup(event,'array_diff')">array_diff</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('assertion_results')" href="../_variables/assertion_results.html">$assertion_results</a>, <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(NULL)));
<a name="l615"><span class="linenum"> 615</span></a>      
<a name="l616"><span class="linenum"> 616</span></a>  <span class="comment">    // Populate the request with the selected identity</span>
<a name="l617"><span class="linenum"> 617</span></a>      if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity'] == <a class="constant" onClick="logConstant('OPENID_IDENTIFIER_SELECT')" href="../_constants/OPENID_IDENTIFIER_SELECT.html" onMouseOver="constPopup(event,'OPENID_IDENTIFIER_SELECT')">OPENID_IDENTIFIER_SELECT</a>) {
<a name="l618"><span class="linenum"> 618</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.claimed_id'] = <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('identity')" href="../_variables/identity.html">$identity</a>;
<a name="l619"><span class="linenum"> 619</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity'] = <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('identity')" href="../_variables/identity.html">$identity</a>;
<a name="l620"><span class="linenum"> 620</span></a>      }
<a name="l621"><span class="linenum"> 621</span></a>      
<a name="l622"><span class="linenum"> 622</span></a>  <span class="comment">    // Check 3: Discover the realm and match its return_to</span>
<a name="l623"><span class="linenum"> 623</span></a>      <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('user_rp')" href="../_variables/user_rp.html">$user_rp</a> = (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['rp'][<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>])) ? <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['rp'][<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>] : NULL;
<a name="l624"><span class="linenum"> 624</span></a>  
<a name="l625"><span class="linenum"> 625</span></a>      if ((<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> &gt;= <a class="constant" onClick="logConstant('OPENID_VERSION_2')" href="../_constants/OPENID_VERSION_2.html" onMouseOver="constPopup(event,'OPENID_VERSION_2')">OPENID_VERSION_2</a>) &amp;&amp; SIMPLEID_VERIFY_RETURN_URL_USING_REALM) {
<a name="l626"><span class="linenum"> 626</span></a>          <a class="var it465" onMouseOver="hilite(465)" onMouseOut="lolite()" onClick="logVariable('verified')" href="../_variables/verified.html">$verified</a> = FALSE;
<a name="l627"><span class="linenum"> 627</span></a>          
<a name="l628"><span class="linenum"> 628</span></a>          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a> = <a class="function" onClick="logFunction('simpleid_get_rp_info')" href="../_functions/simpleid_get_rp_info.html" onMouseOver="funcPopup(event,'simpleid_get_rp_info')">simpleid_get_rp_info</a>(<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>);
<a name="l629"><span class="linenum"> 629</span></a>          <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('services')" href="../_variables/services.html">$services</a> = <a class="function" onClick="logFunction('discovery_xrds_services_by_type')" href="../_functions/discovery_xrds_services_by_type.html" onMouseOver="funcPopup(event,'discovery_xrds_services_by_type')">discovery_xrds_services_by_type</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>['services'], <a class="constant" onClick="logConstant('OPENID_RETURN_TO')" href="../_constants/OPENID_RETURN_TO.html" onMouseOver="constPopup(event,'OPENID_RETURN_TO')">OPENID_RETURN_TO</a>);
<a name="l630"><span class="linenum"> 630</span></a>          
<a name="l631"><span class="linenum"> 631</span></a>          <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID 2 discovery: ' . <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('services')" href="../_variables/services.html">$services</a>) . ' matching services');
<a name="l632"><span class="linenum"> 632</span></a>          
<a name="l633"><span class="linenum"> 633</span></a>          if (<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('services')" href="../_variables/services.html">$services</a>) {
<a name="l634"><span class="linenum"> 634</span></a>              <a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('return_to_uris')" href="../_variables/return_to_uris.html">$return_to_uris</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>();
<a name="l635"><span class="linenum"> 635</span></a>              
<a name="l636"><span class="linenum"> 636</span></a>              foreach (<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('services')" href="../_variables/services.html">$services</a> as <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l637"><span class="linenum"> 637</span></a>                  <a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('return_to_uris')" href="../_variables/return_to_uris.html">$return_to_uris</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('return_to_uris')" href="../_variables/return_to_uris.html">$return_to_uris</a>, <a class="var it69" onMouseOver="hilite(69)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>['uri']);
<a name="l638"><span class="linenum"> 638</span></a>              }
<a name="l639"><span class="linenum"> 639</span></a>              foreach (<a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('return_to_uris')" href="../_variables/return_to_uris.html">$return_to_uris</a> as <a class="var it159" onMouseOver="hilite(159)" onMouseOut="lolite()" onClick="logVariable('return_to')" href="../_variables/return_to.html">$return_to</a>) {
<a name="l640"><span class="linenum"> 640</span></a>                  if (<a class="function" onClick="logFunction('openid_url_matches_realm')" href="../_functions/openid_url_matches_realm.html" onMouseOver="funcPopup(event,'openid_url_matches_realm')">openid_url_matches_realm</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'], <a class="var it159" onMouseOver="hilite(159)" onMouseOut="lolite()" onClick="logVariable('return_to')" href="../_variables/return_to.html">$return_to</a>)) {
<a name="l641"><span class="linenum"> 641</span></a>                      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID 2 discovery: verified');
<a name="l642"><span class="linenum"> 642</span></a>                      <a class="var it465" onMouseOver="hilite(465)" onMouseOut="lolite()" onClick="logVariable('verified')" href="../_variables/verified.html">$verified</a> = TRUE;
<a name="l643"><span class="linenum"> 643</span></a>                      break;
<a name="l644"><span class="linenum"> 644</span></a>                  }
<a name="l645"><span class="linenum"> 645</span></a>              }
<a name="l646"><span class="linenum"> 646</span></a>          }
<a name="l647"><span class="linenum"> 647</span></a>          
<a name="l648"><span class="linenum"> 648</span></a>          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>['return_to_verified'] = <a class="var it465" onMouseOver="hilite(465)" onMouseOut="lolite()" onClick="logVariable('verified')" href="../_variables/verified.html">$verified</a>;
<a name="l649"><span class="linenum"> 649</span></a>          <a class="function" onClick="logFunction('simpleid_set_rp_info')" href="../_functions/simpleid_set_rp_info.html" onMouseOver="funcPopup(event,'simpleid_set_rp_info')">simpleid_set_rp_info</a>(<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>, <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>);
<a name="l650"><span class="linenum"> 650</span></a>          
<a name="l651"><span class="linenum"> 651</span></a>          if (!<a class="var it465" onMouseOver="hilite(465)" onMouseOut="lolite()" onClick="logVariable('verified')" href="../_variables/verified.html">$verified</a>) {
<a name="l652"><span class="linenum"> 652</span></a>              if ((<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('user_rp')" href="../_variables/user_rp.html">$user_rp</a> != NULL) &amp;&amp; (<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('user_rp')" href="../_variables/user_rp.html">$user_rp</a>['auto_release'] == 1)) {
<a name="l653"><span class="linenum"> 653</span></a>                  <a class="function" onClick="logFunction('log_notice')" href="../_functions/log_notice.html" onMouseOver="funcPopup(event,'log_notice')">log_notice</a>('OpenID 2 discovery: not verified, but overridden by user preference');
<a name="l654"><span class="linenum"> 654</span></a>              } else {
<a name="l655"><span class="linenum"> 655</span></a>                  <a class="function" onClick="logFunction('log_notice')" href="../_functions/log_notice.html" onMouseOver="funcPopup(event,'log_notice')">log_notice</a>('OpenID 2 discovery: not verified');
<a name="l656"><span class="linenum"> 656</span></a>                  <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('assertion_results')" href="../_variables/assertion_results.html">$assertion_results</a>[] = <a class="constant" onClick="logConstant('CHECKID_RETURN_TO_SUSPECT')" href="../_constants/CHECKID_RETURN_TO_SUSPECT.html" onMouseOver="constPopup(event,'CHECKID_RETURN_TO_SUSPECT')">CHECKID_RETURN_TO_SUSPECT</a>;
<a name="l657"><span class="linenum"> 657</span></a>              }
<a name="l658"><span class="linenum"> 658</span></a>          }
<a name="l659"><span class="linenum"> 659</span></a>      }
<a name="l660"><span class="linenum"> 660</span></a>      
<a name="l661"><span class="linenum"> 661</span></a>  <span class="comment">    // Check 4: For checkid_immediate, the user must already have given</span>
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment">    // permission to log in automatically.    </span>
<a name="l663"><span class="linenum"> 663</span></a>      if ((<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('user_rp')" href="../_variables/user_rp.html">$user_rp</a> != NULL) &amp;&amp; (<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('user_rp')" href="../_variables/user_rp.html">$user_rp</a>['auto_release'] == 1)) {
<a name="l664"><span class="linenum"> 664</span></a>          <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('Automatic set for realm ' . <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>);
<a name="l665"><span class="linenum"> 665</span></a>          <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('assertion_results')" href="../_variables/assertion_results.html">$assertion_results</a>[] = <a class="constant" onClick="logConstant('CHECKID_OK')" href="../_constants/CHECKID_OK.html" onMouseOver="constPopup(event,'CHECKID_OK')">CHECKID_OK</a>;
<a name="l666"><span class="linenum"> 666</span></a>          return <a class="phpfunction" onClick="logFunction('min')" href="../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">min</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('assertion_results')" href="../_variables/assertion_results.html">$assertion_results</a>);
<a name="l667"><span class="linenum"> 667</span></a>      } else {
<a name="l668"><span class="linenum"> 668</span></a>          <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('assertion_results')" href="../_variables/assertion_results.html">$assertion_results</a>[] = <a class="constant" onClick="logConstant('CHECKID_APPROVAL_REQUIRED')" href="../_constants/CHECKID_APPROVAL_REQUIRED.html" onMouseOver="constPopup(event,'CHECKID_APPROVAL_REQUIRED')">CHECKID_APPROVAL_REQUIRED</a>;
<a name="l669"><span class="linenum"> 669</span></a>          return <a class="phpfunction" onClick="logFunction('min')" href="../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">min</a>(<a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('assertion_results')" href="../_variables/assertion_results.html">$assertion_results</a>);
<a name="l670"><span class="linenum"> 670</span></a>      }
<a name="l671"><span class="linenum"> 671</span></a>  }
<a name="l672"><span class="linenum"> 672</span></a>  
<a name="l673"><span class="linenum"> 673</span></a>  <span class="comment">/**</span>
<a name="l674"><span class="linenum"> 674</span></a>  <span class="comment"> * Obtains information on a relying party by performing discovery on them.  Information</span>
<a name="l675"><span class="linenum"> 675</span></a>  <span class="comment"> * obtained includes the discovery URL, the parsed XRDS document, and any other</span>
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment"> * information saved by SimpleID extensions</span>
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment"> *</span>
<a name="l678"><span class="linenum"> 678</span></a>  <span class="comment"> * The results are cached for 1 hour.  For performance reasons, stale results may</span>
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment"> * be obtained by using the $allow_stale parameter</span>
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment"> *</span>
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment"> * @param string $realm the openid.realm parameter</span>
<a name="l682"><span class="linenum"> 682</span></a>  <span class="comment"> * @param bool $allow_stale allow stale results to be returned, otherwise discovery</span>
<a name="l683"><span class="linenum"> 683</span></a>  <span class="comment"> * will occur</span>
<a name="l684"><span class="linenum"> 684</span></a>  <span class="comment"> * @return array containing information on a relying party.</span>
<a name="l685"><span class="linenum"> 685</span></a>  <span class="comment"> * @link http://openid.net/specs/openid-authentication-2_0.html#rp_discovery</span>
<a name="l686"><span class="linenum"> 686</span></a>  <span class="comment"> * @since 0.8</span>
<a name="l687"><span class="linenum"> 687</span></a>  <span class="comment"> */</span>
<a name="l688"><span class="linenum"> 688</span></a>  function <a class="function" onClick="logFunction('simpleid_get_rp_info')" href="../_functions/simpleid_get_rp_info.html" onMouseOver="funcPopup(event,'simpleid_get_rp_info')">simpleid_get_rp_info</a>(<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>, <a class="var it467" onMouseOver="hilite(467)" onMouseOut="lolite()" onClick="logVariable('allow_stale')" href="../_variables/allow_stale.html">$allow_stale</a> = FALSE) {
<a name="l689"><span class="linenum"> 689</span></a>      <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <a class="function" onClick="logFunction('openid_realm_discovery_url')" href="../_functions/openid_realm_discovery_url.html" onMouseOver="funcPopup(event,'openid_realm_discovery_url')">openid_realm_discovery_url</a>(<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>);
<a name="l690"><span class="linenum"> 690</span></a>      
<a name="l691"><span class="linenum"> 691</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('simpleid_get_rp_info');
<a name="l692"><span class="linenum"> 692</span></a>      
<a name="l693"><span class="linenum"> 693</span></a>      <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a> = <a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>('rp-info', <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>);
<a name="l694"><span class="linenum"> 694</span></a>      
<a name="l695"><span class="linenum"> 695</span></a>      if ((<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a> == NULL) || (!<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>['updated'])) || (!<a class="var it467" onMouseOver="hilite(467)" onMouseOut="lolite()" onClick="logVariable('allow_stale')" href="../_variables/allow_stale.html">$allow_stale</a> &amp;&amp; (<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>['updated'] &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - 3600))) {
<a name="l696"><span class="linenum"> 696</span></a>          <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID 2 RP discovery: realm: ' . <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a> . '; url: ' . <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>);
<a name="l697"><span class="linenum"> 697</span></a>          
<a name="l698"><span class="linenum"> 698</span></a>          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l699"><span class="linenum"> 699</span></a>              'url' =&gt; <a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>,
<a name="l700"><span class="linenum"> 700</span></a>              'services' =&gt; <a class="function" onClick="logFunction('discovery_xrds_discover')" href="../_functions/discovery_xrds_discover.html" onMouseOver="funcPopup(event,'discovery_xrds_discover')">discovery_xrds_discover</a>(<a class="var it28" onMouseOver="hilite(28)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>),
<a name="l701"><span class="linenum"> 701</span></a>              'updated' =&gt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()
<a name="l702"><span class="linenum"> 702</span></a>          );
<a name="l703"><span class="linenum"> 703</span></a>          
<a name="l704"><span class="linenum"> 704</span></a>          <a class="function" onClick="logFunction('cache_set')" href="../_functions/cache_set.html" onMouseOver="funcPopup(event,'cache_set')">cache_set</a>('rp-info', <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>, <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>);
<a name="l705"><span class="linenum"> 705</span></a>      }
<a name="l706"><span class="linenum"> 706</span></a>  
<a name="l707"><span class="linenum"> 707</span></a>      return <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>;
<a name="l708"><span class="linenum"> 708</span></a>  }
<a name="l709"><span class="linenum"> 709</span></a>  
<a name="l710"><span class="linenum"> 710</span></a>  <span class="comment">/**</span>
<a name="l711"><span class="linenum"> 711</span></a>  <span class="comment"> * Saves information on a relying party to disk.</span>
<a name="l712"><span class="linenum"> 712</span></a>  <span class="comment"> *</span>
<a name="l713"><span class="linenum"> 713</span></a>  <span class="comment"> * @param string $realm the openid.realm parameter</span>
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment"> * @param array $rp_info containing information on a relying party.</span>
<a name="l715"><span class="linenum"> 715</span></a>  <span class="comment"> *</span>
<a name="l716"><span class="linenum"> 716</span></a>  <span class="comment"> * @since 0.8</span>
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment"> */</span>
<a name="l718"><span class="linenum"> 718</span></a>  function <a class="function" onClick="logFunction('simpleid_set_rp_info')" href="../_functions/simpleid_set_rp_info.html" onMouseOver="funcPopup(event,'simpleid_set_rp_info')">simpleid_set_rp_info</a>(<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>, <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>) {
<a name="l719"><span class="linenum"> 719</span></a>      if (!<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>['updated'])) <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>['updated'] = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l720"><span class="linenum"> 720</span></a>      <a class="function" onClick="logFunction('cache_set')" href="../_functions/cache_set.html" onMouseOver="funcPopup(event,'cache_set')">cache_set</a>('rp-info', <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>, <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>, <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('rp_info')" href="../_variables/rp_info.html">$rp_info</a>['updated']);
<a name="l721"><span class="linenum"> 721</span></a>  }
<a name="l722"><span class="linenum"> 722</span></a>  
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment">/**</span>
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment"> * Returns an OpenID response indicating a positive assertion.</span>
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment"> *</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment"> * @param array $request the OpenID request</span>
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment"> * @return array an OpenID response with a positive assertion</span>
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment"> * @link http://openid.net/specs/openid-authentication-1_1.html#anchor17, http://openid.net/specs/openid-authentication-1_1.html#anchor23, http://openid.net/specs/openid-authentication-2_0.html#positive_assertions</span>
<a name="l729"><span class="linenum"> 729</span></a>  <span class="comment"> */</span>
<a name="l730"><span class="linenum"> 730</span></a>  function <a class="function" onClick="logFunction('simpleid_checkid_ok')" href="../_functions/simpleid_checkid_ok.html" onMouseOver="funcPopup(event,'simpleid_checkid_ok')">simpleid_checkid_ok</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>) {
<a name="l731"><span class="linenum"> 731</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l732"><span class="linenum"> 732</span></a>      
<a name="l733"><span class="linenum"> 733</span></a>      <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l734"><span class="linenum"> 734</span></a>          'openid.mode' =&gt; 'id_res',
<a name="l735"><span class="linenum"> 735</span></a>          'openid.op_endpoint' =&gt; <a class="function" onClick="logFunction('simpleid_url')" href="../_functions/simpleid_url.html" onMouseOver="funcPopup(event,'simpleid_url')">simpleid_url</a>(),
<a name="l736"><span class="linenum"> 736</span></a>          'openid.response_nonce' =&gt; <a class="function" onClick="logFunction('openid_nonce')" href="../_functions/openid_nonce.html" onMouseOver="funcPopup(event,'openid_nonce')">openid_nonce</a>()
<a name="l737"><span class="linenum"> 737</span></a>      );
<a name="l738"><span class="linenum"> 738</span></a>      
<a name="l739"><span class="linenum"> 739</span></a>      if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.assoc_handle'])) <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>['openid.assoc_handle'] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.assoc_handle'];
<a name="l740"><span class="linenum"> 740</span></a>      if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity'])) <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>['openid.identity'] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity'];
<a name="l741"><span class="linenum"> 741</span></a>      if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'])) <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>['openid.return_to'] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'];
<a name="l742"><span class="linenum"> 742</span></a>      
<a name="l743"><span class="linenum"> 743</span></a>      if ((<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> &gt;= <a class="constant" onClick="logConstant('OPENID_VERSION_2')" href="../_constants/OPENID_VERSION_2.html" onMouseOver="constPopup(event,'OPENID_VERSION_2')">OPENID_VERSION_2</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.claimed_id'])) {
<a name="l744"><span class="linenum"> 744</span></a>          <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>['openid.claimed_id'] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.claimed_id'];
<a name="l745"><span class="linenum"> 745</span></a>      }
<a name="l746"><span class="linenum"> 746</span></a>      
<a name="l747"><span class="linenum"> 747</span></a>      <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('response', TRUE, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>));
<a name="l748"><span class="linenum"> 748</span></a>      
<a name="l749"><span class="linenum"> 749</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID authentication response: ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>));
<a name="l750"><span class="linenum"> 750</span></a>      return <a class="function" onClick="logFunction('openid_indirect_message')" href="../_functions/openid_indirect_message.html" onMouseOver="funcPopup(event,'openid_indirect_message')">openid_indirect_message</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l751"><span class="linenum"> 751</span></a>  }
<a name="l752"><span class="linenum"> 752</span></a>  
<a name="l753"><span class="linenum"> 753</span></a>  <span class="comment">/**</span>
<a name="l754"><span class="linenum"> 754</span></a>  <span class="comment"> * Returns an OpenID response indicating a negative assertion to a</span>
<a name="l755"><span class="linenum"> 755</span></a>  <span class="comment"> * checkid_immediate request, where an approval of the relying party by the</span>
<a name="l756"><span class="linenum"> 756</span></a>  <span class="comment"> * user is required</span>
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment"> *</span>
<a name="l758"><span class="linenum"> 758</span></a>  <span class="comment"> * @param mixed $request the OpenID request</span>
<a name="l759"><span class="linenum"> 759</span></a>  <span class="comment"> * @return mixed an OpenID response with a negative assertion</span>
<a name="l760"><span class="linenum"> 760</span></a>  <span class="comment"> * @link http://openid.net/specs/openid-authentication-1_1.html#anchor17, http://openid.net/specs/openid-authentication-1_1.html#anchor23, http://openid.net/specs/openid-authentication-2_0.html#negative_assertions</span>
<a name="l761"><span class="linenum"> 761</span></a>  <span class="comment"> */</span>
<a name="l762"><span class="linenum"> 762</span></a>  function <a class="function" onClick="logFunction('simpleid_checkid_approval_required')" href="../_functions/simpleid_checkid_approval_required.html" onMouseOver="funcPopup(event,'simpleid_checkid_approval_required')">simpleid_checkid_approval_required</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>) {
<a name="l763"><span class="linenum"> 763</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l764"><span class="linenum"> 764</span></a>      
<a name="l765"><span class="linenum"> 765</span></a>      if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> &gt;= <a class="constant" onClick="logConstant('OPENID_VERSION_2')" href="../_constants/OPENID_VERSION_2.html" onMouseOver="constPopup(event,'OPENID_VERSION_2')">OPENID_VERSION_2</a>) {
<a name="l766"><span class="linenum"> 766</span></a>          <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('openid.mode' =&gt; 'setup_needed');
<a name="l767"><span class="linenum"> 767</span></a>      } else {
<a name="l768"><span class="linenum"> 768</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.mode'] = 'checkid_setup';
<a name="l769"><span class="linenum"> 769</span></a>          <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l770"><span class="linenum"> 770</span></a>              'openid.mode' =&gt; 'id_res',            
<a name="l771"><span class="linenum"> 771</span></a>              'openid.user_setup_url' =&gt; <a class="function" onClick="logFunction('simpleid_url')" href="../_functions/simpleid_url.html" onMouseOver="funcPopup(event,'simpleid_url')">simpleid_url</a>('continue', 's=' . <a class="phpfunction" onClick="logFunction('rawurlencode')" href="../_functions/rawurlencode.html" onMouseOver="phpfuncPopup(event,'rawurlencode')">rawurlencode</a>(<a class="function" onClick="logFunction('pickle')" href="../_functions/pickle.html" onMouseOver="funcPopup(event,'pickle')">pickle</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>)))
<a name="l772"><span class="linenum"> 772</span></a>          );
<a name="l773"><span class="linenum"> 773</span></a>      }
<a name="l774"><span class="linenum"> 774</span></a>      
<a name="l775"><span class="linenum"> 775</span></a>      <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('response', FALSE, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>));
<a name="l776"><span class="linenum"> 776</span></a>      
<a name="l777"><span class="linenum"> 777</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID authentication response: ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>));
<a name="l778"><span class="linenum"> 778</span></a>      return <a class="function" onClick="logFunction('openid_indirect_message')" href="../_functions/openid_indirect_message.html" onMouseOver="funcPopup(event,'openid_indirect_message')">openid_indirect_message</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l779"><span class="linenum"> 779</span></a>  }
<a name="l780"><span class="linenum"> 780</span></a>  
<a name="l781"><span class="linenum"> 781</span></a>  <span class="comment">/**</span>
<a name="l782"><span class="linenum"> 782</span></a>  <span class="comment"> * Returns an OpenID response indicating a negative assertion to a</span>
<a name="l783"><span class="linenum"> 783</span></a>  <span class="comment"> * checkid_immediate request, where the user has not logged in.</span>
<a name="l784"><span class="linenum"> 784</span></a>  <span class="comment"> *</span>
<a name="l785"><span class="linenum"> 785</span></a>  <span class="comment"> * @param array $request the OpenID request</span>
<a name="l786"><span class="linenum"> 786</span></a>  <span class="comment"> * @return array an OpenID response with a negative assertion</span>
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment"> * @link http://openid.net/specs/openid-authentication-1_1.html#anchor17, http://openid.net/specs/openid-authentication-1_1.html#anchor23, http://openid.net/specs/openid-authentication-2_0.html#negative_assertions</span>
<a name="l788"><span class="linenum"> 788</span></a>  <span class="comment"> */</span>
<a name="l789"><span class="linenum"> 789</span></a>  function <a class="function" onClick="logFunction('simpleid_checkid_login_required')" href="../_functions/simpleid_checkid_login_required.html" onMouseOver="funcPopup(event,'simpleid_checkid_login_required')">simpleid_checkid_login_required</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>) {
<a name="l790"><span class="linenum"> 790</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l791"><span class="linenum"> 791</span></a>      
<a name="l792"><span class="linenum"> 792</span></a>      if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> &gt;= <a class="constant" onClick="logConstant('OPENID_VERSION_2')" href="../_constants/OPENID_VERSION_2.html" onMouseOver="constPopup(event,'OPENID_VERSION_2')">OPENID_VERSION_2</a>) {
<a name="l793"><span class="linenum"> 793</span></a>          <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('openid.mode' =&gt; 'setup_needed');
<a name="l794"><span class="linenum"> 794</span></a>      } else {    
<a name="l795"><span class="linenum"> 795</span></a>          <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l796"><span class="linenum"> 796</span></a>              'openid.mode' =&gt; 'id_res',
<a name="l797"><span class="linenum"> 797</span></a>              'openid.user_setup_url' =&gt; <a class="function" onClick="logFunction('simpleid_url')" href="../_functions/simpleid_url.html" onMouseOver="funcPopup(event,'simpleid_url')">simpleid_url</a>('login', 'destination=continue&amp;s=' . <a class="phpfunction" onClick="logFunction('rawurlencode')" href="../_functions/rawurlencode.html" onMouseOver="phpfuncPopup(event,'rawurlencode')">rawurlencode</a>(<a class="function" onClick="logFunction('pickle')" href="../_functions/pickle.html" onMouseOver="funcPopup(event,'pickle')">pickle</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>)))
<a name="l798"><span class="linenum"> 798</span></a>          );
<a name="l799"><span class="linenum"> 799</span></a>      }
<a name="l800"><span class="linenum"> 800</span></a>      
<a name="l801"><span class="linenum"> 801</span></a>      <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('response', FALSE, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>));
<a name="l802"><span class="linenum"> 802</span></a>      
<a name="l803"><span class="linenum"> 803</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID authentication response: ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>));
<a name="l804"><span class="linenum"> 804</span></a>      return <a class="function" onClick="logFunction('openid_indirect_message')" href="../_functions/openid_indirect_message.html" onMouseOver="funcPopup(event,'openid_indirect_message')">openid_indirect_message</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l805"><span class="linenum"> 805</span></a>  }
<a name="l806"><span class="linenum"> 806</span></a>  
<a name="l807"><span class="linenum"> 807</span></a>  <span class="comment">/**</span>
<a name="l808"><span class="linenum"> 808</span></a>  <span class="comment"> * Returns an OpenID response indicating a generic negative assertion.</span>
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment"> *</span>
<a name="l810"><span class="linenum"> 810</span></a>  <span class="comment"> * The content of the negative version depends on the OpenID version, and whether</span>
<a name="l811"><span class="linenum"> 811</span></a>  <span class="comment"> * the openid.mode of the request was checkid_immediate</span>
<a name="l812"><span class="linenum"> 812</span></a>  <span class="comment"> *</span>
<a name="l813"><span class="linenum"> 813</span></a>  <span class="comment"> * @param array $request the OpenID request</span>
<a name="l814"><span class="linenum"> 814</span></a>  <span class="comment"> * @param bool $immediate true if openid.mode of the request was checkid_immediate</span>
<a name="l815"><span class="linenum"> 815</span></a>  <span class="comment"> * @return array an OpenID response with a negative assertion</span>
<a name="l816"><span class="linenum"> 816</span></a>  <span class="comment"> * @link http://openid.net/specs/openid-authentication-1_1.html#anchor17, http://openid.net/specs/openid-authentication-1_1.html#anchor23, http://openid.net/specs/openid-authentication-2_0.html#negative_assertions</span>
<a name="l817"><span class="linenum"> 817</span></a>  <span class="comment"> */</span>
<a name="l818"><span class="linenum"> 818</span></a>  function <a class="function" onClick="logFunction('simpleid_checkid_error')" href="../_functions/simpleid_checkid_error.html" onMouseOver="funcPopup(event,'simpleid_checkid_error')">simpleid_checkid_error</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a> = false) {
<a name="l819"><span class="linenum"> 819</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l820"><span class="linenum"> 820</span></a>      
<a name="l821"><span class="linenum"> 821</span></a>      <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>();
<a name="l822"><span class="linenum"> 822</span></a>      if (<a class="var it325" onMouseOver="hilite(325)" onMouseOut="lolite()" onClick="logVariable('immediate')" href="../_variables/immediate.html">$immediate</a>) {
<a name="l823"><span class="linenum"> 823</span></a>          if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> &gt;= <a class="constant" onClick="logConstant('OPENID_VERSION_2')" href="../_constants/OPENID_VERSION_2.html" onMouseOver="constPopup(event,'OPENID_VERSION_2')">OPENID_VERSION_2</a>) {
<a name="l824"><span class="linenum"> 824</span></a>              <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>['openid.mode'] = 'setup_needed';
<a name="l825"><span class="linenum"> 825</span></a>          } else {
<a name="l826"><span class="linenum"> 826</span></a>              <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>['openid.mode'] = 'id_res';
<a name="l827"><span class="linenum"> 827</span></a>          }
<a name="l828"><span class="linenum"> 828</span></a>      } else {
<a name="l829"><span class="linenum"> 829</span></a>          <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>['openid.mode'] = 'cancel';
<a name="l830"><span class="linenum"> 830</span></a>      }
<a name="l831"><span class="linenum"> 831</span></a>      
<a name="l832"><span class="linenum"> 832</span></a>      <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('response', FALSE, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>));
<a name="l833"><span class="linenum"> 833</span></a>      
<a name="l834"><span class="linenum"> 834</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID authentication response: ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>));
<a name="l835"><span class="linenum"> 835</span></a>      return <a class="function" onClick="logFunction('openid_indirect_message')" href="../_functions/openid_indirect_message.html" onMouseOver="funcPopup(event,'openid_indirect_message')">openid_indirect_message</a>(<a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l836"><span class="linenum"> 836</span></a>  }
<a name="l837"><span class="linenum"> 837</span></a>  
<a name="l838"><span class="linenum"> 838</span></a>  <span class="comment">/**</span>
<a name="l839"><span class="linenum"> 839</span></a>  <span class="comment"> * Signs an OpenID response, using signature information from an association</span>
<a name="l840"><span class="linenum"> 840</span></a>  <span class="comment"> * handle.</span>
<a name="l841"><span class="linenum"> 841</span></a>  <span class="comment"> *</span>
<a name="l842"><span class="linenum"> 842</span></a>  <span class="comment"> * @param array &amp;$response the OpenID response</span>
<a name="l843"><span class="linenum"> 843</span></a>  <span class="comment"> * @param array $assoc_handle the association handle containing key information</span>
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment"> * for the signature.  If $assoc_handle is not specified, a private association</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment"> * is created</span>
<a name="l846"><span class="linenum"> 846</span></a>  <span class="comment"> * @return array the signed OpenID response</span>
<a name="l847"><span class="linenum"> 847</span></a>  <span class="comment"> *</span>
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment"> */</span>
<a name="l849"><span class="linenum"> 849</span></a>  function <a class="function" onClick="logFunction('simpleid_sign')" href="../_functions/simpleid_sign.html" onMouseOver="funcPopup(event,'simpleid_sign')">simpleid_sign</a>(&amp;<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('assoc_handle')" href="../_variables/assoc_handle.html">$assoc_handle</a> = NULL) {
<a name="l850"><span class="linenum"> 850</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l851"><span class="linenum"> 851</span></a>      
<a name="l852"><span class="linenum"> 852</span></a>      if (!<a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('assoc_handle')" href="../_variables/assoc_handle.html">$assoc_handle</a>) {
<a name="l853"><span class="linenum"> 853</span></a>          <a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a> = <a class="function" onClick="logFunction('_simpleid_create_association')" href="../_functions/_simpleid_create_association.html" onMouseOver="funcPopup(event,'_simpleid_create_association')">_simpleid_create_association</a>(<a class="constant" onClick="logConstant('ASSOCIATION_PRIVATE')" href="../_constants/ASSOCIATION_PRIVATE.html" onMouseOver="constPopup(event,'ASSOCIATION_PRIVATE')">ASSOCIATION_PRIVATE</a>);
<a name="l854"><span class="linenum"> 854</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.assoc_handle'] = <a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['assoc_handle'];
<a name="l855"><span class="linenum"> 855</span></a>      } else {
<a name="l856"><span class="linenum"> 856</span></a>          <a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a> = <a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>('association', <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('assoc_handle')" href="../_variables/assoc_handle.html">$assoc_handle</a>);
<a name="l857"><span class="linenum"> 857</span></a>          
<a name="l858"><span class="linenum"> 858</span></a>          if (<a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['created'] + SIMPLEID_ASSOC_EXPIRES_IN &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l859"><span class="linenum"> 859</span></a>  <span class="comment">            // Association has expired, need to create a new one</span>
<a name="l860"><span class="linenum"> 860</span></a>              <a class="function" onClick="logFunction('log_notice')" href="../_functions/log_notice.html" onMouseOver="funcPopup(event,'log_notice')">log_notice</a>('Association handle ' . <a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['assoc_handle'] . ' expired.  Using stateless mode.');
<a name="l861"><span class="linenum"> 861</span></a>              <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.invalidate_handle'] = <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('assoc_handle')" href="../_variables/assoc_handle.html">$assoc_handle</a>;
<a name="l862"><span class="linenum"> 862</span></a>              <a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a> = <a class="function" onClick="logFunction('_simpleid_create_association')" href="../_functions/_simpleid_create_association.html" onMouseOver="funcPopup(event,'_simpleid_create_association')">_simpleid_create_association</a>(<a class="constant" onClick="logConstant('ASSOCIATION_PRIVATE')" href="../_constants/ASSOCIATION_PRIVATE.html" onMouseOver="constPopup(event,'ASSOCIATION_PRIVATE')">ASSOCIATION_PRIVATE</a>);
<a name="l863"><span class="linenum"> 863</span></a>              <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.assoc_handle'] = <a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['assoc_handle'];
<a name="l864"><span class="linenum"> 864</span></a>          }
<a name="l865"><span class="linenum"> 865</span></a>      }
<a name="l866"><span class="linenum"> 866</span></a>      
<a name="l867"><span class="linenum"> 867</span></a>  <span class="comment">    // If we are using stateless mode, then we need to cache the response_nonce</span>
<a name="l868"><span class="linenum"> 868</span></a>  <span class="comment">    // so that the RP can only verify once</span>
<a name="l869"><span class="linenum"> 869</span></a>      if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['private']) &amp;&amp; (<a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['private'] == 1) &amp;&amp; <a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.response_nonce'])) {
<a name="l870"><span class="linenum"> 870</span></a>          <a class="function" onClick="logFunction('cache_set')" href="../_functions/cache_set.html" onMouseOver="funcPopup(event,'cache_set')">cache_set</a>('stateless', <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.response_nonce'], <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l871"><span class="linenum"> 871</span></a>              'response_nonce' =&gt; <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.response_nonce'],
<a name="l872"><span class="linenum"> 872</span></a>              'assoc_handle' =&gt; <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.assoc_handle']));
<a name="l873"><span class="linenum"> 873</span></a>      }
<a name="l874"><span class="linenum"> 874</span></a>      
<a name="l875"><span class="linenum"> 875</span></a>  <span class="comment">    // Get all the signed fields [10.1]</span>
<a name="l876"><span class="linenum"> 876</span></a>      <a class="function" onClick="logFunction('openid_parse_request')" href="../_functions/openid_parse_request.html" onMouseOver="funcPopup(event,'openid_parse_request')">openid_parse_request</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>); <span class="comment">// Fill the namespace array</span>
<a name="l877"><span class="linenum"> 877</span></a>      <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('signed_fields')" href="../_variables/signed_fields.html">$signed_fields</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('op_endpoint', 'return_to', 'response_nonce', 'assoc_handle', 'identity', 'claimed_id');
<a name="l878"><span class="linenum"> 878</span></a>      <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('signed_fields')" href="../_variables/signed_fields.html">$signed_fields</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('signed_fields')" href="../_variables/signed_fields.html">$signed_fields</a>, <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('signed_fields', <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>));
<a name="l879"><span class="linenum"> 879</span></a>      
<a name="l880"><span class="linenum"> 880</span></a>  <span class="comment">    // Check if the signed keys are actually present</span>
<a name="l881"><span class="linenum"> 881</span></a>      <a class="var it469" onMouseOver="hilite(469)" onMouseOut="lolite()" onClick="logVariable('to_sign')" href="../_variables/to_sign.html">$to_sign</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>();
<a name="l882"><span class="linenum"> 882</span></a>      foreach (<a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('signed_fields')" href="../_variables/signed_fields.html">$signed_fields</a> as <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>) {
<a name="l883"><span class="linenum"> 883</span></a>          if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.' . <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>])) <a class="var it469" onMouseOver="hilite(469)" onMouseOut="lolite()" onClick="logVariable('to_sign')" href="../_variables/to_sign.html">$to_sign</a>[] = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>;
<a name="l884"><span class="linenum"> 884</span></a>      }
<a name="l885"><span class="linenum"> 885</span></a>      
<a name="l886"><span class="linenum"> 886</span></a>      <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.signed'] = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it469" onMouseOver="hilite(469)" onMouseOut="lolite()" onClick="logVariable('to_sign')" href="../_variables/to_sign.html">$to_sign</a>);
<a name="l887"><span class="linenum"> 887</span></a>    
<a name="l888"><span class="linenum"> 888</span></a>  <span class="comment">    // Generate signature for this message</span>
<a name="l889"><span class="linenum"> 889</span></a>      <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('mac_key')" href="../_variables/mac_key.html">$mac_key</a> = <a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['mac_key'];
<a name="l890"><span class="linenum"> 890</span></a>      <a class="var it455" onMouseOver="hilite(455)" onMouseOut="lolite()" onClick="logVariable('assoc_types')" href="../_variables/assoc_types.html">$assoc_types</a> = <a class="function" onClick="logFunction('openid_association_types')" href="../_functions/openid_association_types.html" onMouseOver="funcPopup(event,'openid_association_types')">openid_association_types</a>();
<a name="l891"><span class="linenum"> 891</span></a>      <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('hmac_func')" href="../_variables/hmac_func.html">$hmac_func</a> = <a class="var it455" onMouseOver="hilite(455)" onMouseOut="lolite()" onClick="logVariable('assoc_types')" href="../_variables/assoc_types.html">$assoc_types</a>[<a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['assoc_type']]['hmac_func'];
<a name="l892"><span class="linenum"> 892</span></a>      
<a name="l893"><span class="linenum"> 893</span></a>      <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.sig'] = <a class="function" onClick="logFunction('openid_sign')" href="../_functions/openid_sign.html" onMouseOver="funcPopup(event,'openid_sign')">openid_sign</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it469" onMouseOver="hilite(469)" onMouseOut="lolite()" onClick="logVariable('to_sign')" href="../_variables/to_sign.html">$to_sign</a>, <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('mac_key')" href="../_variables/mac_key.html">$mac_key</a>, <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('hmac_func')" href="../_variables/hmac_func.html">$hmac_func</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l894"><span class="linenum"> 894</span></a>      
<a name="l895"><span class="linenum"> 895</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID signed authentication response: ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>));
<a name="l896"><span class="linenum"> 896</span></a>      
<a name="l897"><span class="linenum"> 897</span></a>      return <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>;
<a name="l898"><span class="linenum"> 898</span></a>  }
<a name="l899"><span class="linenum"> 899</span></a>  
<a name="l900"><span class="linenum"> 900</span></a>  <span class="comment">/**</span>
<a name="l901"><span class="linenum"> 901</span></a>  <span class="comment"> * Processes a direct verification request.  This is used in the OpenID specification</span>
<a name="l902"><span class="linenum"> 902</span></a>  <span class="comment"> * to verify signatures generated using stateless mode.</span>
<a name="l903"><span class="linenum"> 903</span></a>  <span class="comment"> *</span>
<a name="l904"><span class="linenum"> 904</span></a>  <span class="comment"> * @param array $request the OpenID request</span>
<a name="l905"><span class="linenum"> 905</span></a>  <span class="comment"> * @see http://openid.net/specs/openid-authentication-1_1.html#mode_check_authentication, http://openid.net/specs/openid-authentication-2_0.html#verifying_signatures</span>
<a name="l906"><span class="linenum"> 906</span></a>  <span class="comment"> */</span>
<a name="l907"><span class="linenum"> 907</span></a>  function <a class="function" onClick="logFunction('simpleid_check_authentication')" href="../_functions/simpleid_check_authentication.html" onMouseOver="funcPopup(event,'simpleid_check_authentication')">simpleid_check_authentication</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>) {
<a name="l908"><span class="linenum"> 908</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l909"><span class="linenum"> 909</span></a>      
<a name="l910"><span class="linenum"> 910</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID direct verification: ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>));
<a name="l911"><span class="linenum"> 911</span></a>      
<a name="l912"><span class="linenum"> 912</span></a>      <a class="var it470" onMouseOver="hilite(470)" onMouseOut="lolite()" onClick="logVariable('is_valid')" href="../_variables/is_valid.html">$is_valid</a> = <a class="function" onClick="logFunction('simpleid_verify_signatures')" href="../_functions/simpleid_verify_signatures.html" onMouseOver="funcPopup(event,'simpleid_verify_signatures')">simpleid_verify_signatures</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l913"><span class="linenum"> 913</span></a>  
<a name="l914"><span class="linenum"> 914</span></a>      if (<a class="var it470" onMouseOver="hilite(470)" onMouseOut="lolite()" onClick="logVariable('is_valid')" href="../_variables/is_valid.html">$is_valid</a>) {
<a name="l915"><span class="linenum"> 915</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('is_valid' =&gt; 'true');
<a name="l916"><span class="linenum"> 916</span></a>      } else {
<a name="l917"><span class="linenum"> 917</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('is_valid' =&gt; 'false');
<a name="l918"><span class="linenum"> 918</span></a>      }
<a name="l919"><span class="linenum"> 919</span></a>      
<a name="l920"><span class="linenum"> 920</span></a>  <span class="comment">    // RP wants to check whether a handle is invalid</span>
<a name="l921"><span class="linenum"> 921</span></a>      if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.invalidate_handle'])) {
<a name="l922"><span class="linenum"> 922</span></a>          <a class="var it471" onMouseOver="hilite(471)" onMouseOut="lolite()" onClick="logVariable('invalid_assoc')" href="../_variables/invalid_assoc.html">$invalid_assoc</a> = <a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>('association', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.invalidate_handle']);
<a name="l923"><span class="linenum"> 923</span></a>          
<a name="l924"><span class="linenum"> 924</span></a>          if (!<a class="var it471" onMouseOver="hilite(471)" onMouseOut="lolite()" onClick="logVariable('invalid_assoc')" href="../_variables/invalid_assoc.html">$invalid_assoc</a> || (<a class="var it471" onMouseOver="hilite(471)" onMouseOut="lolite()" onClick="logVariable('invalid_assoc')" href="../_variables/invalid_assoc.html">$invalid_assoc</a>['created'] + SIMPLEID_ASSOC_EXPIRES_IN &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>())) {
<a name="l925"><span class="linenum"> 925</span></a>  <span class="comment">            // Yes, it's invalid</span>
<a name="l926"><span class="linenum"> 926</span></a>              <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['invalidate_handle'] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.invalidate_handle'];
<a name="l927"><span class="linenum"> 927</span></a>          }
<a name="l928"><span class="linenum"> 928</span></a>      }
<a name="l929"><span class="linenum"> 929</span></a>  
<a name="l930"><span class="linenum"> 930</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('OpenID direct verification response: ' . <a class="function" onClick="logFunction('log_array')" href="../_functions/log_array.html" onMouseOver="funcPopup(event,'log_array')">log_array</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>));
<a name="l931"><span class="linenum"> 931</span></a>      
<a name="l932"><span class="linenum"> 932</span></a>      <a class="function" onClick="logFunction('openid_direct_response')" href="../_functions/openid_direct_response.html" onMouseOver="funcPopup(event,'openid_direct_response')">openid_direct_response</a>(<a class="function" onClick="logFunction('openid_direct_message')" href="../_functions/openid_direct_message.html" onMouseOver="funcPopup(event,'openid_direct_message')">openid_direct_message</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>));
<a name="l933"><span class="linenum"> 933</span></a>  }
<a name="l934"><span class="linenum"> 934</span></a>  
<a name="l935"><span class="linenum"> 935</span></a>  <span class="comment">/**</span>
<a name="l936"><span class="linenum"> 936</span></a>  <span class="comment"> * Verifies the signature of a signed OpenID request/response.</span>
<a name="l937"><span class="linenum"> 937</span></a>  <span class="comment"> *</span>
<a name="l938"><span class="linenum"> 938</span></a>  <span class="comment"> * @param array $request the OpenID request/response</span>
<a name="l939"><span class="linenum"> 939</span></a>  <span class="comment"> * @return bool true if the signature is verified</span>
<a name="l940"><span class="linenum"> 940</span></a>  <span class="comment"> * @since 0.8</span>
<a name="l941"><span class="linenum"> 941</span></a>  <span class="comment"> */</span>
<a name="l942"><span class="linenum"> 942</span></a>  function <a class="function" onClick="logFunction('simpleid_verify_signatures')" href="../_functions/simpleid_verify_signatures.html" onMouseOver="funcPopup(event,'simpleid_verify_signatures')">simpleid_verify_signatures</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>) {
<a name="l943"><span class="linenum"> 943</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l944"><span class="linenum"> 944</span></a>      
<a name="l945"><span class="linenum"> 945</span></a>      <a class="function" onClick="logFunction('log_info')" href="../_functions/log_info.html" onMouseOver="funcPopup(event,'log_info')">log_info</a>('simpleid_verify_signatures');
<a name="l946"><span class="linenum"> 946</span></a>      
<a name="l947"><span class="linenum"> 947</span></a>      <a class="var it470" onMouseOver="hilite(470)" onMouseOut="lolite()" onClick="logVariable('is_valid')" href="../_variables/is_valid.html">$is_valid</a> = TRUE;
<a name="l948"><span class="linenum"> 948</span></a>    
<a name="l949"><span class="linenum"> 949</span></a>      <a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a> = (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.assoc_handle'])) ? <a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>('association', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.assoc_handle']) : NULL;
<a name="l950"><span class="linenum"> 950</span></a>      <a class="var it472" onMouseOver="hilite(472)" onMouseOut="lolite()" onClick="logVariable('stateless')" href="../_variables/stateless.html">$stateless</a> = (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.response_nonce'])) ? <a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>('stateless', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.response_nonce']) : NULL;
<a name="l951"><span class="linenum"> 951</span></a>    
<a name="l952"><span class="linenum"> 952</span></a>      if (!<a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>) {
<a name="l953"><span class="linenum"> 953</span></a>          <a class="function" onClick="logFunction('log_notice')" href="../_functions/log_notice.html" onMouseOver="funcPopup(event,'log_notice')">log_notice</a>('simpleid_verify_signatures: Association not found.');
<a name="l954"><span class="linenum"> 954</span></a>          <a class="var it470" onMouseOver="hilite(470)" onMouseOut="lolite()" onClick="logVariable('is_valid')" href="../_variables/is_valid.html">$is_valid</a> = FALSE;
<a name="l955"><span class="linenum"> 955</span></a>      } elseif (!<a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['assoc_type']) {
<a name="l956"><span class="linenum"> 956</span></a>          <a class="function" onClick="logFunction('log_error')" href="../_functions/log_error.html" onMouseOver="funcPopup(event,'log_error')">log_error</a>('simpleid_verify_signatures: Association does not contain valid assoc_type.');
<a name="l957"><span class="linenum"> 957</span></a>          <a class="var it470" onMouseOver="hilite(470)" onMouseOut="lolite()" onClick="logVariable('is_valid')" href="../_variables/is_valid.html">$is_valid</a> = FALSE;
<a name="l958"><span class="linenum"> 958</span></a>      } elseif (!<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['private']) || (<a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['private'] != 1)) {
<a name="l959"><span class="linenum"> 959</span></a>          <a class="function" onClick="logFunction('log_warn')" href="../_functions/log_warn.html" onMouseOver="funcPopup(event,'log_warn')">log_warn</a>('simpleid_verify_signatures: Attempting to verify an association with a shared key.');
<a name="l960"><span class="linenum"> 960</span></a>          <a class="var it470" onMouseOver="hilite(470)" onMouseOut="lolite()" onClick="logVariable('is_valid')" href="../_variables/is_valid.html">$is_valid</a> = FALSE;
<a name="l961"><span class="linenum"> 961</span></a>      } elseif (!<a class="var it472" onMouseOver="hilite(472)" onMouseOut="lolite()" onClick="logVariable('stateless')" href="../_variables/stateless.html">$stateless</a> || (<a class="var it472" onMouseOver="hilite(472)" onMouseOut="lolite()" onClick="logVariable('stateless')" href="../_variables/stateless.html">$stateless</a>['assoc_handle'] != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.assoc_handle'])) {
<a name="l962"><span class="linenum"> 962</span></a>          <a class="function" onClick="logFunction('log_warn')" href="../_functions/log_warn.html" onMouseOver="funcPopup(event,'log_warn')">log_warn</a>('simpleid_verify_signatures: Attempting to verify a response_nonce more than once, or private association expired.');
<a name="l963"><span class="linenum"> 963</span></a>          <a class="var it470" onMouseOver="hilite(470)" onMouseOut="lolite()" onClick="logVariable('is_valid')" href="../_variables/is_valid.html">$is_valid</a> = FALSE;
<a name="l964"><span class="linenum"> 964</span></a>      } else {
<a name="l965"><span class="linenum"> 965</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('mac_key')" href="../_variables/mac_key.html">$mac_key</a> = <a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['mac_key'];
<a name="l966"><span class="linenum"> 966</span></a>          <a class="var it455" onMouseOver="hilite(455)" onMouseOut="lolite()" onClick="logVariable('assoc_types')" href="../_variables/assoc_types.html">$assoc_types</a> = <a class="function" onClick="logFunction('openid_association_types')" href="../_functions/openid_association_types.html" onMouseOver="funcPopup(event,'openid_association_types')">openid_association_types</a>();
<a name="l967"><span class="linenum"> 967</span></a>          <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('hmac_func')" href="../_variables/hmac_func.html">$hmac_func</a> = <a class="var it455" onMouseOver="hilite(455)" onMouseOut="lolite()" onClick="logVariable('assoc_types')" href="../_variables/assoc_types.html">$assoc_types</a>[<a class="var it468" onMouseOver="hilite(468)" onMouseOut="lolite()" onClick="logVariable('assoc')" href="../_variables/assoc.html">$assoc</a>['assoc_type']]['hmac_func'];
<a name="l968"><span class="linenum"> 968</span></a>          
<a name="l969"><span class="linenum"> 969</span></a>          <a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('signed_keys')" href="../_variables/signed_keys.html">$signed_keys</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.signed']);
<a name="l970"><span class="linenum"> 970</span></a>          <a class="var it201" onMouseOver="hilite(201)" onMouseOut="lolite()" onClick="logVariable('signature')" href="../_variables/signature.html">$signature</a> = <a class="function" onClick="logFunction('openid_sign')" href="../_functions/openid_sign.html" onMouseOver="funcPopup(event,'openid_sign')">openid_sign</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('signed_keys')" href="../_variables/signed_keys.html">$signed_keys</a>, <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('mac_key')" href="../_variables/mac_key.html">$mac_key</a>, <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('hmac_func')" href="../_variables/hmac_func.html">$hmac_func</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l971"><span class="linenum"> 971</span></a>          <a class="function" onClick="logFunction('log_debug')" href="../_functions/log_debug.html" onMouseOver="funcPopup(event,'log_debug')">log_debug</a>('***** Signature: ' . <a class="var it201" onMouseOver="hilite(201)" onMouseOut="lolite()" onClick="logVariable('signature')" href="../_variables/signature.html">$signature</a>);
<a name="l972"><span class="linenum"> 972</span></a>          
<a name="l973"><span class="linenum"> 973</span></a>          if (<a class="var it201" onMouseOver="hilite(201)" onMouseOut="lolite()" onClick="logVariable('signature')" href="../_variables/signature.html">$signature</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.sig']) {
<a name="l974"><span class="linenum"> 974</span></a>              <a class="function" onClick="logFunction('log_warn')" href="../_functions/log_warn.html" onMouseOver="funcPopup(event,'log_warn')">log_warn</a>('simpleid_verify_signatures: Signature supplied in request does not match the signatured generated.');
<a name="l975"><span class="linenum"> 975</span></a>              <a class="var it470" onMouseOver="hilite(470)" onMouseOut="lolite()" onClick="logVariable('is_valid')" href="../_variables/is_valid.html">$is_valid</a> = FALSE;
<a name="l976"><span class="linenum"> 976</span></a>          }
<a name="l977"><span class="linenum"> 977</span></a>          
<a name="l978"><span class="linenum"> 978</span></a>          <a class="function" onClick="logFunction('cache_delete')" href="../_functions/cache_delete.html" onMouseOver="funcPopup(event,'cache_delete')">cache_delete</a>('stateless', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.response_nonce']);
<a name="l979"><span class="linenum"> 979</span></a>      }
<a name="l980"><span class="linenum"> 980</span></a>      
<a name="l981"><span class="linenum"> 981</span></a>      return <a class="var it470" onMouseOver="hilite(470)" onMouseOut="lolite()" onClick="logVariable('is_valid')" href="../_variables/is_valid.html">$is_valid</a>;
<a name="l982"><span class="linenum"> 982</span></a>  }
<a name="l983"><span class="linenum"> 983</span></a>  
<a name="l984"><span class="linenum"> 984</span></a>  
<a name="l985"><span class="linenum"> 985</span></a>  <span class="comment">/**</span>
<a name="l986"><span class="linenum"> 986</span></a>  <span class="comment"> * Continues an OpenID authentication request.</span>
<a name="l987"><span class="linenum"> 987</span></a>  <span class="comment"> *</span>
<a name="l988"><span class="linenum"> 988</span></a>  <span class="comment"> * This function decodes an OpenID authentication request specified in the</span>
<a name="l989"><span class="linenum"> 989</span></a>  <span class="comment"> * s request parameter and feeds it to the</span>
<a name="l990"><span class="linenum"> 990</span></a>  <span class="comment"> * {@link simpleid_process_openid} function.  This allows SimpleID to preserve</span>
<a name="l991"><span class="linenum"> 991</span></a>  <span class="comment"> * the state of an OpenID request.</span>
<a name="l992"><span class="linenum"> 992</span></a>  <span class="comment"> */</span>
<a name="l993"><span class="linenum"> 993</span></a>  function <a class="function" onClick="logFunction('simpleid_continue')" href="../_functions/simpleid_continue.html" onMouseOver="funcPopup(event,'simpleid_continue')">simpleid_continue</a>() {
<a name="l994"><span class="linenum"> 994</span></a>      global <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>;
<a name="l995"><span class="linenum"> 995</span></a>      
<a name="l996"><span class="linenum"> 996</span></a>      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a> = <a class="function" onClick="logFunction('unpickle')" href="../_functions/unpickle.html" onMouseOver="funcPopup(event,'unpickle')">unpickle</a>(<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['s']);
<a name="l997"><span class="linenum"> 997</span></a>      <a class="function" onClick="logFunction('openid_parse_request')" href="../_functions/openid_parse_request.html" onMouseOver="funcPopup(event,'openid_parse_request')">openid_parse_request</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l998"><span class="linenum"> 998</span></a>      <a class="function" onClick="logFunction('simpleid_process_openid')" href="../_functions/simpleid_process_openid.html" onMouseOver="funcPopup(event,'simpleid_process_openid')">simpleid_process_openid</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l999"><span class="linenum"> 999</span></a>  }
<a name="l1000"><span class="linenum">1000</span></a>  
<a name="l1001"><span class="linenum">1001</span></a>  <span class="comment">/**</span>
<a name="l1002"><span class="linenum">1002</span></a>  <span class="comment"> * Provides a form for user consent of an OpenID relying party, where the </span>
<a name="l1003"><span class="linenum">1003</span></a>  <span class="comment"> * {@link simpleid_checkid_identity()} function returns a CHECKID_APPROVAL_REQUIRED</span>
<a name="l1004"><span class="linenum">1004</span></a>  <span class="comment"> * or CHECKID_RETURN_TO_SUSPECT.</span>
<a name="l1005"><span class="linenum">1005</span></a>  <span class="comment"> *</span>
<a name="l1006"><span class="linenum">1006</span></a>  <span class="comment"> * Alternatively, provide a form for the user to rectify the situation where</span>
<a name="l1007"><span class="linenum">1007</span></a>  <span class="comment"> * {@link simpleid_checkid_identity()} function returns a CHECKID_IDENTITIES_NOT_MATCHING</span>
<a name="l1008"><span class="linenum">1008</span></a>  <span class="comment"> * or CHECKID_IDENTITY_NOT_EXIST</span>
<a name="l1009"><span class="linenum">1009</span></a>  <span class="comment"> *</span>
<a name="l1010"><span class="linenum">1010</span></a>  <span class="comment"> * @param array $request the original OpenID request</span>
<a name="l1011"><span class="linenum">1011</span></a>  <span class="comment"> * @param array $response the proposed OpenID response, subject to user</span>
<a name="l1012"><span class="linenum">1012</span></a>  <span class="comment"> * verification</span>
<a name="l1013"><span class="linenum">1013</span></a>  <span class="comment"> * @param int $reason either CHECKID_APPROVAL_REQUIRED, CHECKID_RETURN_TO_SUSPECT,</span>
<a name="l1014"><span class="linenum">1014</span></a>  <span class="comment"> * CHECKID_IDENTITIES_NOT_MATCHING or CHECKID_IDENTITY_NOT_EXIST</span>
<a name="l1015"><span class="linenum">1015</span></a>  <span class="comment"> */</span>
<a name="l1016"><span class="linenum">1016</span></a>  function <a class="function" onClick="logFunction('simpleid_openid_consent_form')" href="../_functions/simpleid_openid_consent_form.html" onMouseOver="funcPopup(event,'simpleid_openid_consent_form')">simpleid_openid_consent_form</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it347" onMouseOver="hilite(347)" onMouseOut="lolite()" onClick="logVariable('reason')" href="../_variables/reason.html">$reason</a> = <a class="constant" onClick="logConstant('CHECKID_APPROVAL_REQUIRED')" href="../_constants/CHECKID_APPROVAL_REQUIRED.html" onMouseOver="constPopup(event,'CHECKID_APPROVAL_REQUIRED')">CHECKID_APPROVAL_REQUIRED</a>) {
<a name="l1017"><span class="linenum">1017</span></a>      global <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l1018"><span class="linenum">1018</span></a>      global <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>;
<a name="l1019"><span class="linenum">1019</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l1020"><span class="linenum">1020</span></a>      
<a name="l1021"><span class="linenum">1021</span></a>      <a class="var it474" onMouseOver="hilite(474)" onMouseOut="lolite()" onClick="logVariable('request_state')" href="../_variables/request_state.html">$request_state</a> = <a class="function" onClick="logFunction('pickle')" href="../_functions/pickle.html" onMouseOver="funcPopup(event,'pickle')">pickle</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>);
<a name="l1022"><span class="linenum">1022</span></a>      
<a name="l1023"><span class="linenum">1023</span></a>      <a class="function" onClick="logFunction('user_header')" href="../_functions/user_header.html" onMouseOver="funcPopup(event,'user_header')">user_header</a>(<a class="var it474" onMouseOver="hilite(474)" onMouseOut="lolite()" onClick="logVariable('request_state')" href="../_variables/request_state.html">$request_state</a>);
<a name="l1024"><span class="linenum">1024</span></a>  
<a name="l1025"><span class="linenum">1025</span></a>      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a> = <a class="function" onClick="logFunction('openid_get_realm')" href="../_functions/openid_get_realm.html" onMouseOver="funcPopup(event,'openid_get_realm')">openid_get_realm</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l1026"><span class="linenum">1026</span></a>      
<a name="l1027"><span class="linenum">1027</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('token', <a class="function" onClick="logFunction('get_form_token')" href="../_functions/get_form_token.html" onMouseOver="funcPopup(event,'get_form_token')">get_form_token</a>('rp'));
<a name="l1028"><span class="linenum">1028</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('state', <a class="function" onClick="logFunction('pickle')" href="../_functions/pickle.html" onMouseOver="funcPopup(event,'pickle')">pickle</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>));
<a name="l1029"><span class="linenum">1029</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('realm', <a class="phpfunction" onClick="logFunction('htmlspecialchars')" href="../_functions/htmlspecialchars.html" onMouseOver="phpfuncPopup(event,'htmlspecialchars')">htmlspecialchars</a>(<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>, ENT_QUOTES, 'UTF-8'));
<a name="l1030"><span class="linenum">1030</span></a>      
<a name="l1031"><span class="linenum">1031</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('cancel_button', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Cancel'));
<a name="l1032"><span class="linenum">1032</span></a>  
<a name="l1033"><span class="linenum">1033</span></a>      if (<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.mode'] == 'cancel') {
<a name="l1034"><span class="linenum">1034</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('return_to', <a class="phpfunction" onClick="logFunction('htmlspecialchars')" href="../_functions/htmlspecialchars.html" onMouseOver="phpfuncPopup(event,'htmlspecialchars')">htmlspecialchars</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.return_to'], ENT_QUOTES, 'UTF-8'));
<a name="l1035"><span class="linenum">1035</span></a>          
<a name="l1036"><span class="linenum">1036</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('unable_label', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Unable to log into &lt;strong class=&quot;realm&quot;&gt;@realm&lt;/strong&gt;.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('@realm' =&gt; <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>)));
<a name="l1037"><span class="linenum">1037</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('identity_not_matching_label', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Your current identity does not match the requested identity %identity.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%identity' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>['openid.identity'])));
<a name="l1038"><span class="linenum">1038</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('switch_user_label', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('&lt;a href=&quot;!url&quot;&gt;Switch to a different user&lt;/a&gt; and try again.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; <a class="function" onClick="logFunction('simpleid_url')" href="../_functions/simpleid_url.html" onMouseOver="funcPopup(event,'simpleid_url')">simpleid_url</a>('logout', 'destination=continue&amp;s=' . <a class="phpfunction" onClick="logFunction('rawurlencode')" href="../_functions/rawurlencode.html" onMouseOver="phpfuncPopup(event,'rawurlencode')">rawurlencode</a>(<a class="var it474" onMouseOver="hilite(474)" onMouseOut="lolite()" onClick="logVariable('request_state')" href="../_variables/request_state.html">$request_state</a>), true))));
<a name="l1039"><span class="linenum">1039</span></a>          
<a name="l1040"><span class="linenum">1040</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.openid_consent.cancel');
<a name="l1041"><span class="linenum">1041</span></a>      } else {
<a name="l1042"><span class="linenum">1042</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('javascript', '&lt;script src=&quot;' . <a class="function" onClick="logFunction('get_base_path')" href="../_functions/get_base_path.html" onMouseOver="funcPopup(event,'get_base_path')">get_base_path</a>() . 'html/openid-consent.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;');
<a name="l1043"><span class="linenum">1043</span></a>          
<a name="l1044"><span class="linenum">1044</span></a>          <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a> = (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['rp'][<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>])) ? <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['rp'][<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>] : NULL;
<a name="l1045"><span class="linenum">1045</span></a>          
<a name="l1046"><span class="linenum">1046</span></a>          <a class="var it418" onMouseOver="hilite(418)" onMouseOut="lolite()" onClick="logVariable('extensions')" href="../_variables/extensions.html">$extensions</a> = <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('consent_form', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('request')" href="../_variables/request.html">$request</a>, <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a>);
<a name="l1047"><span class="linenum">1047</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('extensions', <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(<a class="var it418" onMouseOver="hilite(418)" onMouseOut="lolite()" onClick="logVariable('extensions')" href="../_variables/extensions.html">$extensions</a>));
<a name="l1048"><span class="linenum">1048</span></a>          
<a name="l1049"><span class="linenum">1049</span></a>          if (<a class="var it347" onMouseOver="hilite(347)" onMouseOut="lolite()" onClick="logVariable('reason')" href="../_variables/reason.html">$reason</a> == <a class="constant" onClick="logConstant('CHECKID_RETURN_TO_SUSPECT')" href="../_constants/CHECKID_RETURN_TO_SUSPECT.html" onMouseOver="constPopup(event,'CHECKID_RETURN_TO_SUSPECT')">CHECKID_RETURN_TO_SUSPECT</a>) {
<a name="l1050"><span class="linenum">1050</span></a>              <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('suspect_label', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Warning: This web site has not confirmed its identity and might be fraudulent.  Do not share any personal information with this web site unless you are sure it is legitimate. See the &lt;a href=&quot;!url&quot; class=&quot;popup&quot;&gt;SimpleID documentation for details&lt;/a&gt; (OpenID version 2.0 return_to discovery failure)',
<a name="l1051"><span class="linenum">1051</span></a>                  <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/troubleshooting/returnto-discovery-failure')));
<a name="l1052"><span class="linenum">1052</span></a>              
<a name="l1053"><span class="linenum">1053</span></a>              <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.openid_consent.setup.suspect');
<a name="l1054"><span class="linenum">1054</span></a>              <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('realm_class', 'return-to-suspect');
<a name="l1055"><span class="linenum">1055</span></a>          }
<a name="l1056"><span class="linenum">1056</span></a>          
<a name="l1057"><span class="linenum">1057</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('realm_label', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('You are being logged into &lt;strong class=&quot;realm&quot;&gt;@realm&lt;/strong&gt;.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('@realm' =&gt; <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>)));
<a name="l1058"><span class="linenum">1058</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('auto_release_label', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Automatically send my information to this site for any future requests.'));
<a name="l1059"><span class="linenum">1059</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('ok_button', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('OK'));
<a name="l1060"><span class="linenum">1060</span></a>          
<a name="l1061"><span class="linenum">1061</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.openid_consent.setup');
<a name="l1062"><span class="linenum">1062</span></a>      }
<a name="l1063"><span class="linenum">1063</span></a>      
<a name="l1064"><span class="linenum">1064</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.openid_consent');
<a name="l1065"><span class="linenum">1065</span></a>      
<a name="l1066"><span class="linenum">1066</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>(<a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('js_locale_label' =&gt; 'openid_suspect', 'js_locale_text' =&gt; <a class="phpfunction" onClick="logFunction('addslashes')" href="../_functions/addslashes.html" onMouseOver="phpfuncPopup(event,'addslashes')">addslashes</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('This web site has not confirmed its identity and might be fraudulent.')) . '\n\n' . <a class="phpfunction" onClick="logFunction('addslashes')" href="../_functions/addslashes.html" onMouseOver="phpfuncPopup(event,'addslashes')">addslashes</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Are you sure you wish to automatically send your information to this site for any future requests?'))));
<a name="l1067"><span class="linenum">1067</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.js_locale');
<a name="l1068"><span class="linenum">1068</span></a>      
<a name="l1069"><span class="linenum">1069</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.framekiller');
<a name="l1070"><span class="linenum">1070</span></a>      
<a name="l1071"><span class="linenum">1071</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('X-Frame-Options: DENY');
<a name="l1072"><span class="linenum">1072</span></a>      
<a name="l1073"><span class="linenum">1073</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('title', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('OpenID Login'));
<a name="l1074"><span class="linenum">1074</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('page_class', 'dialog-page');
<a name="l1075"><span class="linenum">1075</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main');
<a name="l1076"><span class="linenum">1076</span></a>      
<a name="l1077"><span class="linenum">1077</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>('main');
<a name="l1078"><span class="linenum">1078</span></a>  }
<a name="l1079"><span class="linenum">1079</span></a>  
<a name="l1080"><span class="linenum">1080</span></a>  
<a name="l1081"><span class="linenum">1081</span></a>  <span class="comment">/**</span>
<a name="l1082"><span class="linenum">1082</span></a>  <span class="comment"> * Processes a user response from the {@link simpleid_openid_consent_form()} function.</span>
<a name="l1083"><span class="linenum">1083</span></a>  <span class="comment"> *</span>
<a name="l1084"><span class="linenum">1084</span></a>  <span class="comment"> * If the user verifies the relying party, an OpenID response will be sent to</span>
<a name="l1085"><span class="linenum">1085</span></a>  <span class="comment"> * the relying party.  Otherwise, the dashboard will be displayed to the user.</span>
<a name="l1086"><span class="linenum">1086</span></a>  <span class="comment"> *</span>
<a name="l1087"><span class="linenum">1087</span></a>  <span class="comment"> */</span>
<a name="l1088"><span class="linenum">1088</span></a>  function <a class="function" onClick="logFunction('simpleid_openid_consent')" href="../_functions/simpleid_openid_consent.html" onMouseOver="funcPopup(event,'simpleid_openid_consent')">simpleid_openid_consent</a>() {
<a name="l1089"><span class="linenum">1089</span></a>      global <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>, <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>;
<a name="l1090"><span class="linenum">1090</span></a>      
<a name="l1091"><span class="linenum">1091</span></a>      if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> == NULL) {
<a name="l1092"><span class="linenum">1092</span></a>          <a class="function" onClick="logFunction('user_login_form')" href="../_functions/user_login_form.html" onMouseOver="funcPopup(event,'user_login_form')">user_login_form</a>('');
<a name="l1093"><span class="linenum">1093</span></a>          return;
<a name="l1094"><span class="linenum">1094</span></a>      }
<a name="l1095"><span class="linenum">1095</span></a>      
<a name="l1096"><span class="linenum">1096</span></a>      if (!<a class="function" onClick="logFunction('validate_form_token')" href="../_functions/validate_form_token.html" onMouseOver="funcPopup(event,'validate_form_token')">validate_form_token</a>(<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['tk'], 'rp')) {
<a name="l1097"><span class="linenum">1097</span></a>          <a class="function" onClick="logFunction('set_message')" href="../_functions/set_message.html" onMouseOver="funcPopup(event,'set_message')">set_message</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('SimpleID detected a potential security attack.  Please try again.'));
<a name="l1098"><span class="linenum">1098</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('title', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('OpenID Login'));
<a name="l1099"><span class="linenum">1099</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main');
<a name="l1100"><span class="linenum">1100</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>('main');
<a name="l1101"><span class="linenum">1101</span></a>          return;
<a name="l1102"><span class="linenum">1102</span></a>      }
<a name="l1103"><span class="linenum">1103</span></a>      
<a name="l1104"><span class="linenum">1104</span></a>      <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('uid')" href="../_variables/uid.html">$uid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['uid'];
<a name="l1105"><span class="linenum">1105</span></a>      
<a name="l1106"><span class="linenum">1106</span></a>      <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('unpickle')" href="../_functions/unpickle.html" onMouseOver="funcPopup(event,'unpickle')">unpickle</a>(<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['s']);
<a name="l1107"><span class="linenum">1107</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> = <a class="function" onClick="logFunction('openid_get_version')" href="../_functions/openid_get_version.html" onMouseOver="funcPopup(event,'openid_get_version')">openid_get_version</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>);
<a name="l1108"><span class="linenum">1108</span></a>      <a class="function" onClick="logFunction('openid_parse_request')" href="../_functions/openid_parse_request.html" onMouseOver="funcPopup(event,'openid_parse_request')">openid_parse_request</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>);
<a name="l1109"><span class="linenum">1109</span></a>      <a class="var it159" onMouseOver="hilite(159)" onMouseOut="lolite()" onClick="logVariable('return_to')" href="../_variables/return_to.html">$return_to</a> = <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.return_to'];
<a name="l1110"><span class="linenum">1110</span></a>      if (!<a class="var it159" onMouseOver="hilite(159)" onMouseOut="lolite()" onClick="logVariable('return_to')" href="../_variables/return_to.html">$return_to</a>) <a class="var it159" onMouseOver="hilite(159)" onMouseOut="lolite()" onClick="logVariable('return_to')" href="../_variables/return_to.html">$return_to</a> = <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['openid.return_to'];
<a name="l1111"><span class="linenum">1111</span></a>      
<a name="l1112"><span class="linenum">1112</span></a>      if (<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['op'] == <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Cancel')) {
<a name="l1113"><span class="linenum">1113</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_checkid_error')" href="../_functions/simpleid_checkid_error.html" onMouseOver="funcPopup(event,'simpleid_checkid_error')">simpleid_checkid_error</a>(false);
<a name="l1114"><span class="linenum">1114</span></a>          if (!<a class="var it159" onMouseOver="hilite(159)" onMouseOut="lolite()" onClick="logVariable('return_to')" href="../_variables/return_to.html">$return_to</a>) <a class="function" onClick="logFunction('set_message')" href="../_functions/set_message.html" onMouseOver="funcPopup(event,'set_message')">set_message</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Log in cancelled.'));
<a name="l1115"><span class="linenum">1115</span></a>      } else {
<a name="l1116"><span class="linenum">1116</span></a>          <a class="var it475" onMouseOver="hilite(475)" onMouseOut="lolite()" onClick="logVariable('now')" href="../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1117"><span class="linenum">1117</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a> = <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['openid.realm'];
<a name="l1118"><span class="linenum">1118</span></a>          
<a name="l1119"><span class="linenum">1119</span></a>          if (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['rp'][<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>])) {
<a name="l1120"><span class="linenum">1120</span></a>              <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['rp'][<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>];
<a name="l1121"><span class="linenum">1121</span></a>          } else {
<a name="l1122"><span class="linenum">1122</span></a>              <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('realm' =&gt; <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>, 'first_time' =&gt; <a class="var it475" onMouseOver="hilite(475)" onMouseOut="lolite()" onClick="logVariable('now')" href="../_variables/now.html">$now</a>);
<a name="l1123"><span class="linenum">1123</span></a>          }
<a name="l1124"><span class="linenum">1124</span></a>          <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a>['last_time'] = <a class="var it475" onMouseOver="hilite(475)" onMouseOut="lolite()" onClick="logVariable('now')" href="../_variables/now.html">$now</a>;
<a name="l1125"><span class="linenum">1125</span></a>          <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a>['auto_release'] = (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['autorelease']) &amp;&amp; <a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['autorelease']) ? 1 : 0;
<a name="l1126"><span class="linenum">1126</span></a>          
<a name="l1127"><span class="linenum">1127</span></a>  <span class="comment">        // Mimic extension_invoke_all, but allow for passing by reference {{</span>
<a name="l1128"><span class="linenum">1128</span></a>          global <a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('simpleid_extensions')" href="../_variables/simpleid_extensions.html">$simpleid_extensions</a>;
<a name="l1129"><span class="linenum">1129</span></a>      
<a name="l1130"><span class="linenum">1130</span></a>          foreach (<a class="var it241" onMouseOver="hilite(241)" onMouseOut="lolite()" onClick="logVariable('simpleid_extensions')" href="../_variables/simpleid_extensions.html">$simpleid_extensions</a> as <a class="var it242" onMouseOver="hilite(242)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../_variables/extension.html">$extension</a>) {
<a name="l1131"><span class="linenum">1131</span></a>              <a class="var it476" onMouseOver="hilite(476)" onMouseOut="lolite()" onClick="logVariable('consent_function')" href="../_variables/consent_function.html">$consent_function</a> = <a class="var it242" onMouseOver="hilite(242)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../_variables/extension.html">$extension</a> . '_consent';
<a name="l1132"><span class="linenum">1132</span></a>              if (<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>(<a class="var it476" onMouseOver="hilite(476)" onMouseOut="lolite()" onClick="logVariable('consent_function')" href="../_variables/consent_function.html">$consent_function</a>)) {
<a name="l1133"><span class="linenum">1133</span></a>                  <a class="var it476" onMouseOver="hilite(476)" onMouseOut="lolite()" onClick="logVariable('consent_function')" href="../_variables/consent_function.html">$consent_function</a>(<a class="var it247" onMouseOver="hilite(247)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>, <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a>);
<a name="l1134"><span class="linenum">1134</span></a>              }
<a name="l1135"><span class="linenum">1135</span></a>          }
<a name="l1136"><span class="linenum">1136</span></a>  <span class="comment">        // }}</span>
<a name="l1137"><span class="linenum">1137</span></a>          
<a name="l1138"><span class="linenum">1138</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['rp'][<a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('realm')" href="../_variables/realm.html">$realm</a>] = <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a>;
<a name="l1139"><span class="linenum">1139</span></a>          <a class="function" onClick="logFunction('user_save')" href="../_functions/user_save.html" onMouseOver="funcPopup(event,'user_save')">user_save</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l1140"><span class="linenum">1140</span></a>          
<a name="l1141"><span class="linenum">1141</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="function" onClick="logFunction('simpleid_sign')" href="../_functions/simpleid_sign.html" onMouseOver="funcPopup(event,'simpleid_sign')">simpleid_sign</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.assoc_handle']) ? <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>['openid.assoc_handle'] : NULL);
<a name="l1142"><span class="linenum">1142</span></a>          if (!<a class="var it159" onMouseOver="hilite(159)" onMouseOut="lolite()" onClick="logVariable('return_to')" href="../_variables/return_to.html">$return_to</a>) <a class="function" onClick="logFunction('set_message')" href="../_functions/set_message.html" onMouseOver="funcPopup(event,'set_message')">set_message</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('You were logged in successfully.'));
<a name="l1143"><span class="linenum">1143</span></a>      }
<a name="l1144"><span class="linenum">1144</span></a>  
<a name="l1145"><span class="linenum">1145</span></a>      if (<a class="var it159" onMouseOver="hilite(159)" onMouseOut="lolite()" onClick="logVariable('return_to')" href="../_variables/return_to.html">$return_to</a>) {
<a name="l1146"><span class="linenum">1146</span></a>          <a class="function" onClick="logFunction('simpleid_assertion_response')" href="../_functions/simpleid_assertion_response.html" onMouseOver="funcPopup(event,'simpleid_assertion_response')">simpleid_assertion_response</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it159" onMouseOver="hilite(159)" onMouseOut="lolite()" onClick="logVariable('return_to')" href="../_variables/return_to.html">$return_to</a>);
<a name="l1147"><span class="linenum">1147</span></a>      } else {
<a name="l1148"><span class="linenum">1148</span></a>          <a class="function" onClick="logFunction('page_dashboard')" href="../_functions/page_dashboard.html" onMouseOver="funcPopup(event,'page_dashboard')">page_dashboard</a>();
<a name="l1149"><span class="linenum">1149</span></a>      }
<a name="l1150"><span class="linenum">1150</span></a>  }
<a name="l1151"><span class="linenum">1151</span></a>  
<a name="l1152"><span class="linenum">1152</span></a>  <span class="comment">/**</span>
<a name="l1153"><span class="linenum">1153</span></a>  <span class="comment"> * Sends an OpenID assertion response.</span>
<a name="l1154"><span class="linenum">1154</span></a>  <span class="comment"> *</span>
<a name="l1155"><span class="linenum">1155</span></a>  <span class="comment"> * The OpenID specification version 2.0 provides for the sending of assertions</span>
<a name="l1156"><span class="linenum">1156</span></a>  <span class="comment"> * via indirect communication.  However, future versions of the OpenID</span>
<a name="l1157"><span class="linenum">1157</span></a>  <span class="comment"> * specification may provide for sending of assertions via direct communication.</span>
<a name="l1158"><span class="linenum">1158</span></a>  <span class="comment"> *</span>
<a name="l1159"><span class="linenum">1159</span></a>  <span class="comment"> * @param array $response the signed OpenID assertion response to send</span>
<a name="l1160"><span class="linenum">1160</span></a>  <span class="comment"> * @param string $indirect_url the URL to which the OpenID response is sent.  If</span>
<a name="l1161"><span class="linenum">1161</span></a>  <span class="comment"> * this is an empty string, the response is sent via direct communication</span>
<a name="l1162"><span class="linenum">1162</span></a>  <span class="comment"> */</span>
<a name="l1163"><span class="linenum">1163</span></a>  function <a class="function" onClick="logFunction('simpleid_assertion_response')" href="../_functions/simpleid_assertion_response.html" onMouseOver="funcPopup(event,'simpleid_assertion_response')">simpleid_assertion_response</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it477" onMouseOver="hilite(477)" onMouseOut="lolite()" onClick="logVariable('indirect_url')" href="../_variables/indirect_url.html">$indirect_url</a> = NULL) {
<a name="l1164"><span class="linenum">1164</span></a>      global <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>;
<a name="l1165"><span class="linenum">1165</span></a>      
<a name="l1166"><span class="linenum">1166</span></a>      if (<a class="var it477" onMouseOver="hilite(477)" onMouseOut="lolite()" onClick="logVariable('indirect_url')" href="../_variables/indirect_url.html">$indirect_url</a>) {
<a name="l1167"><span class="linenum">1167</span></a>  <span class="comment">        // We want to see if the extensions want to change the way indirect responses are made</span>
<a name="l1168"><span class="linenum">1168</span></a>          <a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a> = <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('indirect_response', <a class="var it477" onMouseOver="hilite(477)" onMouseOut="lolite()" onClick="logVariable('indirect_url')" href="../_variables/indirect_url.html">$indirect_url</a>, <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>);
<a name="l1169"><span class="linenum">1169</span></a>          <a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a> = <a class="phpfunction" onClick="logFunction('array_filter')" href="../_functions/array_filter.html" onMouseOver="phpfuncPopup(event,'array_filter')">array_filter</a>(<a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a>, 'is_null');
<a name="l1170"><span class="linenum">1170</span></a>          <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> = (<a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a>) ? <a class="phpfunction" onClick="logFunction('max')" href="../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(<a class="var it251" onMouseOver="hilite(251)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a>) : <a class="constant" onClick="logConstant('OPENID_RESPONSE_QUERY')" href="../_constants/OPENID_RESPONSE_QUERY.html" onMouseOver="constPopup(event,'OPENID_RESPONSE_QUERY')">OPENID_RESPONSE_QUERY</a>;
<a name="l1171"><span class="linenum">1171</span></a>          
<a name="l1172"><span class="linenum">1172</span></a>          <a class="function" onClick="logFunction('openid_indirect_response')" href="../_functions/openid_indirect_response.html" onMouseOver="funcPopup(event,'openid_indirect_response')">openid_indirect_response</a>(<a class="var it477" onMouseOver="hilite(477)" onMouseOut="lolite()" onClick="logVariable('indirect_url')" href="../_variables/indirect_url.html">$indirect_url</a>, <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l1173"><span class="linenum">1173</span></a>      } else {
<a name="l1174"><span class="linenum">1174</span></a>          <a class="function" onClick="logFunction('openid_direct_response')" href="../_functions/openid_direct_response.html" onMouseOver="funcPopup(event,'openid_direct_response')">openid_direct_response</a>(<a class="function" onClick="logFunction('openid_direct_message')" href="../_functions/openid_direct_message.html" onMouseOver="funcPopup(event,'openid_direct_message')">openid_direct_message</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>));
<a name="l1175"><span class="linenum">1175</span></a>      }
<a name="l1176"><span class="linenum">1176</span></a>  }
<a name="l1177"><span class="linenum">1177</span></a>  
<a name="l1178"><span class="linenum">1178</span></a>  <span class="comment">/**</span>
<a name="l1179"><span class="linenum">1179</span></a>  <span class="comment"> * Displays the XRDS document for this SimpleID installation.</span>
<a name="l1180"><span class="linenum">1180</span></a>  <span class="comment"> * </span>
<a name="l1181"><span class="linenum">1181</span></a>  <span class="comment"> */</span>
<a name="l1182"><span class="linenum">1182</span></a>  function <a class="function" onClick="logFunction('simpleid_xrds')" href="../_functions/simpleid_xrds.html" onMouseOver="funcPopup(event,'simpleid_xrds')">simpleid_xrds</a>() {
<a name="l1183"><span class="linenum">1183</span></a>      global <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>;
<a name="l1184"><span class="linenum">1184</span></a>      
<a name="l1185"><span class="linenum">1185</span></a>      <a class="function" onClick="logFunction('log_debug')" href="../_functions/log_debug.html" onMouseOver="funcPopup(event,'log_debug')">log_debug</a>('Providing XRDS.');
<a name="l1186"><span class="linenum">1186</span></a>      
<a name="l1187"><span class="linenum">1187</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Content-Type: application/xrds+xml');
<a name="l1188"><span class="linenum">1188</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Content-Disposition: inline; filename=yadis.xml');
<a name="l1189"><span class="linenum">1189</span></a>      
<a name="l1190"><span class="linenum">1190</span></a>      <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('types')" href="../_variables/types.html">$types</a> = <a class="function" onClick="logFunction('extension_invoke_all')" href="../_functions/extension_invoke_all.html" onMouseOver="funcPopup(event,'extension_invoke_all')">extension_invoke_all</a>('xrds_types');
<a name="l1191"><span class="linenum">1191</span></a>      foreach (<a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('types')" href="../_variables/types.html">$types</a> as <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>) {
<a name="l1192"><span class="linenum">1192</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('uri', <a class="phpfunction" onClick="logFunction('htmlspecialchars')" href="../_functions/htmlspecialchars.html" onMouseOver="phpfuncPopup(event,'htmlspecialchars')">htmlspecialchars</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>, ENT_QUOTES, 'UTF-8'));
<a name="l1193"><span class="linenum">1193</span></a>          <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('xrds.op_xrds.type');
<a name="l1194"><span class="linenum">1194</span></a>      }
<a name="l1195"><span class="linenum">1195</span></a>      
<a name="l1196"><span class="linenum">1196</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('simpleid_base_url', <a class="phpfunction" onClick="logFunction('htmlspecialchars')" href="../_functions/htmlspecialchars.html" onMouseOver="phpfuncPopup(event,'htmlspecialchars')">htmlspecialchars</a>(<a class="function" onClick="logFunction('simpleid_url')" href="../_functions/simpleid_url.html" onMouseOver="funcPopup(event,'simpleid_url')">simpleid_url</a>(), ENT_QUOTES, 'UTF-8'), false, 'detect');
<a name="l1197"><span class="linenum">1197</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('xrds.op_xrds');
<a name="l1198"><span class="linenum">1198</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('xrds');
<a name="l1199"><span class="linenum">1199</span></a>      <a class="var it25" onMouseOver="hilite(25)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>('xrds');
<a name="l1200"><span class="linenum">1200</span></a>  }
<a name="l1201"><span class="linenum">1201</span></a>  
<a name="l1202"><span class="linenum">1202</span></a>  
<a name="l1203"><span class="linenum">1203</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_form_token': ['get_form_token', 'Obtains a form token given a form ID. ', [['www','common.inc.php',518]], 10],
'openid_association_types': ['openid_association_types', 'Returns the association types supported by this server. ', [['www','openid.inc.php',635]], 4],
'simpleid_continue': ['simpleid_continue', 'Continues an OpenID authentication request. ', [['www','index.php',985]], 0],
'openid_indirect_error': ['openid_indirect_error', 'Sends an indirect message indicating an error.  This is a convenience function for {@link openid_indirect_response()}. ', [['www','openid.inc.php',284]], 1],
'simpleid_sign': ['simpleid_sign', 'Signs an OpenID response, using signature information from an association handle. ', [['www','index.php',838]], 2],
'simpleweb_run': ['simpleweb_run', 'Handles a supplied request, based on a set of routes. ', [['www','simpleweb.inc.php',61]], 2],
'user_header': ['user_header', 'Set up the user section in the header, showing the currently logged in user. ', [['www','user.inc.php',804]], 4],
'get_user_agent_id': ['get_user_agent_id', 'Assigns and returns a unique ID for the user agent (UAID). ', [['www','common.inc.php',231]], 3],
'log_warn': ['log_warn', 'Logs a WARN message. ', [['www','log.inc.php',114]], 9],
'log_debug': ['log_debug', 'Logs a DEBUG message. ', [['www','log.inc.php',84]], 16],
'cache_set': ['cache_set', 'Stores data into the cache. ', [['www','cache.inc.php',37]], 11],
'set_message': ['set_message', 'Sets a message to display to the user on the rendered SimpleID page. ', [['www','common.inc.php',37]], 31],
'openid_parse_request': ['openid_parse_request', 'Parses the OpenID request to extract namespace information. ', [['www','openid.inc.php',371]], 5],
'user_load': ['user_load', 'Loads user data for a specified user name. ', [['www','user.inc.php',115]], 11],
'simpleid_check_authentication': ['simpleid_check_authentication', 'Processes a direct verification request.  This is used in the OpenID specification to verify signatures generated using stateless mode. ', [['www','index.php',900]], 1],
'simpleid_checkid_identity': ['simpleid_checkid_identity', 'Processes a standard OpenID authentication request about an identity. ', [['www','index.php',571]], 1],
'openid_sign': ['openid_sign', 'Calculates a signature of an OpenID message ', [['www','openid.inc.php',907]], 2],
'log_error': ['log_error', 'Logs a ERROR message. ', [['www','log.inc.php',124]], 10],
'simpleid_checkid_error': ['simpleid_checkid_error', 'Returns an OpenID response indicating a generic negative assertion. ', [['www','index.php',807]], 5],
'fix_http_request': ['fix_http_request', 'Fix PHP\'s handling of request data.  PHP changes dots in all request parameters to underscores when creating the $_GET, $_POST and $_REQUEST arrays. ', [['www','common.inc.php',155]], 1],
'simpleid_set_rp_info': ['simpleid_set_rp_info', 'Saves information on a relying party to disk. ', [['www','index.php',710]], 2],
'simpleid_openid_consent': ['simpleid_openid_consent', 'Processes a user response from the {@link simpleid_openid_consent_form()} function. ', [['www','index.php',1081]], 0],
'cache_expire': ['cache_expire', 'Garbage collects data stored the cache.  Data is deleted if it was stored for longer than the specified expiry. ', [['www','cache.inc.php',142]], 7],
'negotiate_content_type': ['negotiate_content_type', 'Content type negotiation using the Accept Header. ', [['www','common.inc.php',254]], 3],
't': ['t', 'Translates a string. ', [['www','locale.inc.php',49]], 183],
'openid_direct_message': ['openid_direct_message', 'Creates a OpenID message for direct response. ', [['www','openid.inc.php',107]], 6],
'user_login_form': ['user_login_form', 'Displays a user login or a login verification form. ', [['www','user.inc.php',466]], 17],
'extension_init': ['extension_init', 'Initialises the extension mechanism.  This function looks up the extensions to load in the {@link SIMPLEID_EXTENSIONS} constants, loads them, then calls the ns hook. ', [['www','common.inc.php',591]], 2],
'simpleid_url': ['simpleid_url', 'Obtains a SimpleID URL.  URLs produced by SimpleID should use this function. ', [['www','common.inc.php',422]], 26],
'user_load_from_identity': ['user_load_from_identity', 'Loads user data for a specified OpenID Identity URI. ', [['www','user.inc.php',141]], 1],
'check_https': ['check_https', 'Ensure the current connection with the user agent is secure with HTTPS. ', [['www','common.inc.php',101]], 8],
'openid_url_matches_realm': ['openid_url_matches_realm', 'Determines whether a URL matches a realm. ', [['www','openid.inc.php',389]], 2],
'openid_direct_error': ['openid_direct_error', 'Sends a direct message indicating an error.  This is a convenience function for {@link openid_direct_response()}. ', [['www','openid.inc.php',270]], 5],
'simpleid_checkid': ['simpleid_checkid', 'Processes an authentication request from a relying party. ', [['www','index.php',432]], 1],
'simpleid_openid_consent_form': ['simpleid_openid_consent_form', 'Provides a form for user consent of an OpenID relying party, where the {@link simpleid_checkid_identity()} function returns a CHECKID_APPROVAL_REQUIRED or CHECKID_RETURN_TO_SUSPECT. ', [['www','index.php',1001]], 3],
'locale_init': ['locale_init', 'Initialises the localisation system. ', [['www','locale.inc.php',33]], 2],
'discovery_xrds_services_by_type': ['discovery_xrds_services_by_type', 'Given an array of discovered services, obtains information on services of a particular type. ', [['www','discovery.inc.php',93]], 2],
'simpleid_checkid_approval_required': ['simpleid_checkid_approval_required', 'Returns an OpenID response indicating a negative assertion to a checkid_immediate request, where an approval of the relying party by the user is required ', [['www','index.php',753]], 1],
'page_dashboard': ['page_dashboard', 'Displays the dashboard page. ', [['www','page.inc.php',32]], 7],
'simpleid_start': ['simpleid_start', 'Entry point for SimpleID. ', [['www','index.php',100]], 1],
'unpickle': ['unpickle', 'Deserialises data specified in a URL parameter as a variable. ', [['www','common.inc.php',338]], 4],
'simpleid_associate': ['simpleid_associate', 'Processes an association request from a relying party. ', [['www','index.php',288]], 1],
'simpleid_xrds': ['simpleid_xrds', 'Displays the XRDS document for this SimpleID installation. ', [['www','index.php',1178]], 1],
'log_notice': ['log_notice', 'Logs a NOTICE message. ', [['www','log.inc.php',104]], 8],
'openid_realm_discovery_url': ['openid_realm_discovery_url', 'Returns the URL of a relying party endpoint for a specified realm.  This URL is used to discover services associated with the realm. ', [['www','openid.inc.php',444]], 1],
'out': ['out', 'prints the parsed text ', [['www/lib','xtemplate.class.php',777]], 18],
'pickle': ['pickle', 'Serialises a variable for inclusion as a URL parameter. ', [['www','common.inc.php',327]], 6],
'openid_indirect_message': ['openid_indirect_message', 'Creates a OpenID message for indirect response. ', [['www','openid.inc.php',153]], 5],
'user_save': ['user_save', 'Stores user data for a specified user name. ', [['www','user.inc.php',156]], 7],
'simpleid_verify_signatures': ['simpleid_verify_signatures', 'Verifies the signature of a signed OpenID request/response. ', [['www','index.php',935]], 1],
'cache_delete': ['cache_delete', 'Deletes data from the cache. ', [['www','cache.inc.php',99]], 8],
'cache_get': ['cache_get', 'Obtains data from the cache. ', [['www','cache.inc.php',58]], 13],
'random_id': ['random_id', 'Generates a relatively unique identifier which can be used as, among other things, an OpenID association handle or an OAuth client identifier.  The identifier returned is at least 24 characters long and contains only hexadecimal characters. ', [['www','random.inc.php',91]], 3],
'is_https': ['is_https', 'Determines whether the current connection with the user agent is via HTTPS. ', [['www','common.inc.php',82]], 7],
'random_bytes': ['random_bytes', 'Obtains a number of random bytes.  This function uses an entropy source specified in SIMPLEID_RAND_SOURCE.  If SIMPLEID_RAND_SOURCE is not available, the mt_rand() PHP function is used ', [['www','random.inc.php',40]], 6],
'openid_session_types': ['openid_session_types', 'Returns the association types supported by this server and the version of OpenID. ', [['www','openid.inc.php',648]], 2],
'simpleid_assertion_response': ['simpleid_assertion_response', 'Sends an OpenID assertion response. ', [['www','index.php',1152]], 8],
'header_response_code': ['header_response_code', 'Send a HTTP response code to the user agent. ', [['www','common.inc.php',64]], 5],
'user_init': ['user_init', 'Initialises the user system.  Loads data for the currently logged-in user, if any. ', [['www','user.inc.php',56]], 2],
'_simpleid_create_association': ['_simpleid_create_association', 'Creates an association. ', [['www','index.php',362]], 3],
'simpleid_index': ['simpleid_index', 'The default route, called when the q parameter is missing or is invalid. ', [['www','index.php',210]], 0],
'get_base_path': ['get_base_path', 'Returns the base URL path, relative to the current host, of the SimpleID installation. ', [['www','common.inc.php',384]], 14],
'openid_dh_server_assoc': ['openid_dh_server_assoc', 'Generates the cryptographic values required for responding to association requests ', [['www','openid.inc.php',675]], 1],
'openid_get_version': ['openid_get_version', 'Detects the OpenID version of the current request ', [['www','openid.inc.php',91]], 3],
'openid_indirect_response': ['openid_indirect_response', 'Sends an indirect response to a URL. ', [['www','openid.inc.php',173]], 4],
'log_fatal': ['log_fatal', 'Logs a FATAL message. ', [['www','log.inc.php',134]], 16],
'log_array': ['log_array', 'Converts an array into a string for logging purposes. ', [['www','log.inc.php',144]], 11],
'extension_invoke_all': ['extension_invoke_all', 'Invokes a hook in all the loaded extensions. ', [['www','common.inc.php',606]], 14],
'log_info': ['log_info', 'Logs an INFO message. ', [['www','log.inc.php',94]], 27],
'bignum_loaded': ['bignum_loaded', 'Returns whether either the GMP or the BCMath library is installed.  If neither of these libraries are installed, the functions in this file will not work. ', [['www','bignum.inc.php',44]], 2],
'simpleid_checkid_login_required': ['simpleid_checkid_login_required', 'Returns an OpenID response indicating a negative assertion to a checkid_immediate request, where the user has not logged in. ', [['www','index.php',781]], 1],
'simpleid_process_openid': ['simpleid_process_openid', 'Process an OpenID request. ', [['www','index.php',245]], 2],
'discovery_xrds_discover': ['discovery_xrds_discover', 'Obtains the services for particular identifier. ', [['www','discovery.inc.php',62]], 1],
'assign': ['assign', 'assign a variable ', [['www/lib','xtemplate.class.php',438]], 181],
'indirect_fatal_error': ['indirect_fatal_error', 'Displays a fatal error message and exits. ', [['www','common.inc.php',49]], 29],
'simpleid_checkid_ok': ['simpleid_checkid_ok', 'Returns an OpenID response indicating a positive assertion. ', [['www','index.php',723]], 3],
'openid_get_realm': ['openid_get_realm', 'Gets the realm from the OpenID request.  This is specified differently depending on the OpenID version. ', [['www','openid.inc.php',301]], 4],
'simpleid_get_rp_info': ['simpleid_get_rp_info', 'Obtains information on a relying party by performing discovery on them.  Information obtained includes the discovery URL, the parsed XRDS document, and any other information saved by SimpleID extensions ', [['www','index.php',673]], 3],
'openid_direct_response': ['openid_direct_response', 'Sends a direct response. ', [['www','openid.inc.php',136]], 4],
'parse': ['parse', 'Parses an XRDS document. ', [['www','discovery.inc.php',462],['www/lib','xtemplate.class.php',511]], 78],
'simpleid_route': ['simpleid_route', 'Dispatches to the correct SimpleID function based on the request path.  The request path usually comes from the q parameter in the query string (which may be inserted by mod_rewrite), but can come from other functions as well. ', [['www','index.php',182]], 1],
'openid_nonce': ['openid_nonce', 'Generates a nonce for use in OpenID responses ', [['www','openid.inc.php',623]], 2],
'validate_form_token': ['validate_form_token', 'Checks whether a form token is valid ', [['www','common.inc.php',541]], 6],
'define': ['define', '', [], 54],
'file_exists': ['file_exists', '', [], 15],
'is_dir': ['is_dir', '', [], 6],
'count': ['count', '', [], 14],
'max': ['max', '', [], 1],
'function_exists': ['function_exists', '', [], 34],
'array_key_exists': ['array_key_exists', '', [], 13],
'gethostbyaddr': ['gethostbyaddr', '', [], 1],
'isset': ['isset', '', [], 239],
'is_numeric': ['is_numeric', '', [], 2],
'base64_encode': ['base64_encode', '', [], 8],
'addslashes': ['addslashes', '', [], 6],
'implode': ['implode', '', [], 15],
'is_writeable': ['is_writeable', '', [], 5],
'header': ['header', '', [], 39],
'explode': ['explode', '', [], 30],
'call_user_func': ['call_user_func', '', [], 5],
'array': ['array', '', [], 241],
'array_merge': ['array_merge', '', [], 30],
'rawurlencode': ['rawurlencode', '', [], 15],
'array_diff': ['array_diff', '', [], 2],
'htmlspecialchars': ['htmlspecialchars', '', [], 46],
'min': ['min', '', [], 3],
'die': ['die', '', [], 3],
'strtolower': ['strtolower', '', [], 18],
'array_filter': ['array_filter', '', [], 1],
'ini_get': ['ini_get', '', [], 15],
'time': ['time', '', [], 19]};
CLASS_DATA={
'xtemplate': ['xtemplate', 'XTemplate PHP templating engine ', [['www/lib','xtemplate.class.php',6]], 7]};
CONST_DATA={
'CHECKID_APPROVAL_REQUIRED': ['CHECKID_APPROVAL_REQUIRED', '', [['www','index.php',64]], 5],
'CACHE_DIR': ['CACHE_DIR', '', [['www','upgrade.php',72],['www','index.php',58]], 11],
'OPENID_RESPONSE_QUERY': ['OPENID_RESPONSE_QUERY', '', [['www','openid.inc.php',78]], 6],
'CHECKID_RETURN_TO_SUSPECT': ['CHECKID_RETURN_TO_SUSPECT', '', [['www','index.php',63]], 5],
'OPENID_VERSION_2': ['OPENID_VERSION_2', '', [['www','openid.inc.php',57]], 21],
'ASSOCIATION_PRIVATE': ['ASSOCIATION_PRIVATE', '', [['www','index.php',70]], 4],
'OPENID_IDENTIFIER_SELECT': ['OPENID_IDENTIFIER_SELECT', '', [['www','openid.inc.php',73]], 4],
'CHECKID_LOGIN_REQUIRED': ['CHECKID_LOGIN_REQUIRED', '', [['www','index.php',65]], 5],
'CHECKID_PROTOCOL_ERROR': ['CHECKID_PROTOCOL_ERROR', '', [['www','index.php',68]], 3],
'CHECKID_OK': ['CHECKID_OK', '', [['www','index.php',62]], 4],
'ASSOCIATION_SHARED': ['ASSOCIATION_SHARED', '', [['www','index.php',71]], 4],
'SIMPLEID_VERSION': ['SIMPLEID_VERSION', '', [['www','version.inc.php',33]], 6],
'OPENID_VERSION_1_1': ['OPENID_VERSION_1_1', '', [['www','openid.inc.php',59]], 11],
'CHECKID_IDENTITIES_NOT_MATCHING': ['CHECKID_IDENTITIES_NOT_MATCHING', '', [['www','index.php',66]], 4],
'OPENID_RETURN_TO': ['OPENID_RETURN_TO', '', [['www','openid.inc.php',75]], 2],
'CHECKID_IDENTITY_NOT_EXIST': ['CHECKID_IDENTITY_NOT_EXIST', '', [['www','index.php',67]], 4]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Mon Apr  6 15:24:46 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
