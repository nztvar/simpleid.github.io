<!DOCTYPE html>
<html>
<head>
    <title>PHPXRef 0.7.1 : SimpleID : /www/upgrade.php source</title>
    <link rel="stylesheet" href="../xref.css" type="text/css">
    <link rel="stylesheet" href="../xref-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>
<body>
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of SimpleID</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Mon Apr  6 15:06:20 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='www';
filename='upgrade.php.source.html';
cookiekey='simpleid';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/www/</a> -> <a href="upgrade.php.html">upgrade.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="upgrade.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="upgrade.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/*</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * SimpleID</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> *</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> * Copyright (C) Kelvin Mo 2009</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> *</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> * modify it under the terms of the GNU General Public</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> * version 2 of the License, or (at your option) any later version.</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> *</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment"> * General Public License for more details.</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment"> *</span>
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment"> * You should have received a copy of the GNU General Public</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * License along with this program; if not, write to the Free</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * </span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * $Id$</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> */</span>
<a name="l23"><span class="linenum">  23</span></a>  
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment">/**</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * SimpleID upgrade script.</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> *</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * This script performs various upgrades to SimpleID's storage backend, which</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * are required for different versions of SimpleID.</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> *</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @package simpleid</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * @since 0.7</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * @filesource</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> */</span>
<a name="l34"><span class="linenum">  34</span></a>  
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment">/**</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * Access control for this script.</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> *</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> * If you are upgrading your SimpleID installation using the upgrade.php script,</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * and you are not logged in as an administrator, you will need to modify the access</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> * check statement below.</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment"> *</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment"> * Change the TRUE to a FALSE to disable the access</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> * check. After finishing the upgrade, be sure to open this file again</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> * and change the FALSE back to a TRUE.</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment"> *</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment"> * @global bool $upgrade_access_check</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment"> */</span>
<a name="l48"><span class="linenum">  48</span></a>  <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a> = TRUE;
<a name="l49"><span class="linenum">  49</span></a>  
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">/* ----- Do not modify anything following this line ------------------------- */</span>
<a name="l51"><span class="linenum">  51</span></a>  
<a name="l52"><span class="linenum">  52</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/version.inc.php.html" onMouseOver="reqPopup(event, 'version.inc.php', '../www/version.inc.php')"> &quot;version.inc.php&quot;</a>;
<a name="l53"><span class="linenum">  53</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/locale.inc.php.html" onMouseOver="reqPopup(event, 'locale.inc.php', '../www/locale.inc.php')"> &quot;locale.inc.php&quot;</a>;
<a name="l54"><span class="linenum">  54</span></a>  if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;config.php&quot;)) {
<a name="l55"><span class="linenum">  55</span></a>      include_once &quot;config.php&quot;;
<a name="l56"><span class="linenum">  56</span></a>  } elseif (<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;config.inc&quot;)) {
<a name="l57"><span class="linenum">  57</span></a>      include_once &quot;config.inc&quot;;
<a name="l58"><span class="linenum">  58</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('UPGRADE_LEGACY_CONFIG_INC')" href="../_constants/UPGRADE_LEGACY_CONFIG_INC.html" onMouseOver="constPopup(event,'UPGRADE_LEGACY_CONFIG_INC')">UPGRADE_LEGACY_CONFIG_INC</a>', TRUE);
<a name="l59"><span class="linenum">  59</span></a>  } else {
<a name="l60"><span class="linenum">  60</span></a>      <a class="phpfunction" onClick="logFunction('die')" href="../_functions/die.html" onMouseOver="phpfuncPopup(event,'die')">die</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('No configuration file found.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for instructions on how to set up a configuration file.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started')));
<a name="l61"><span class="linenum">  61</span></a>  }
<a name="l62"><span class="linenum">  62</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/config.default.php.html" onMouseOver="reqPopup(event, 'config.default.php', '../www/config.default.php')"> &quot;config.default.php&quot;</a>;
<a name="l63"><span class="linenum">  63</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/log.inc.php.html" onMouseOver="reqPopup(event, 'log.inc.php', '../www/log.inc.php')"> &quot;log.inc.php&quot;</a>;
<a name="l64"><span class="linenum">  64</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/common.inc.php.html" onMouseOver="reqPopup(event, 'common.inc.php', '../www/common.inc.php')"> &quot;common.inc.php&quot;</a>;
<a name="l65"><span class="linenum">  65</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/simpleweb.inc.php.html" onMouseOver="reqPopup(event, 'simpleweb.inc.php', '../www/simpleweb.inc.php')"> &quot;simpleweb.inc.php&quot;</a>;
<a name="l66"><span class="linenum">  66</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/openid.inc.php.html" onMouseOver="reqPopup(event, 'openid.inc.php', '../www/openid.inc.php')"> &quot;openid.inc.php&quot;</a>;
<a name="l67"><span class="linenum">  67</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/user.inc.php.html" onMouseOver="reqPopup(event, 'user.inc.php', '../www/user.inc.php')"> &quot;user.inc.php&quot;</a>;
<a name="l68"><span class="linenum">  68</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/cache.inc.php.html" onMouseOver="reqPopup(event, 'cache.inc.php', '../www/cache.inc.php')"> &quot;cache.inc.php&quot;</a>;
<a name="l69"><span class="linenum">  69</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../www/filesystem.store.php.html" onMouseOver="reqPopup(event, 'filesystem.store.php', '../www/filesystem.store.php')"> SIMPLEID_STORE . &quot;.store.php&quot;</a>;
<a name="l70"><span class="linenum">  70</span></a>  <span class="keyword">include</span> <a class="filename" href="../www/lib/xtemplate.class.php.html" onMouseOver="reqPopup(event, 'xtemplate.class.php', '../www/lib/xtemplate.class.php')"> &quot;lib/xtemplate.class.php&quot;</a>;
<a name="l71"><span class="linenum">  71</span></a>  
<a name="l72"><span class="linenum">  72</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CACHE_DIR')" href="../_constants/CACHE_DIR.html" onMouseOver="constPopup(event,'CACHE_DIR')">CACHE_DIR</a>', SIMPLEID_CACHE_DIR);
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('PRE_0_7_0_VERSION')" href="../_constants/PRE_0_7_0_VERSION.html" onMouseOver="constPopup(event,'PRE_0_7_0_VERSION')">PRE_0_7_0_VERSION</a>', '0.6.0 or earlier');
<a name="l75"><span class="linenum">  75</span></a>  
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">/**</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment"> * This variable holds the upgrade functions for each version of SimpleID</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment"> *</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment"> * @global array $upgrade_functions</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> */</span>
<a name="l81"><span class="linenum">  81</span></a>  <a class="var it144" onMouseOver="hilite(144)" onMouseOut="lolite()" onClick="logVariable('upgrade_functions')" href="../_variables/upgrade_functions.html">$upgrade_functions</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l82"><span class="linenum">  82</span></a>      '0.9.0' =&gt; <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('upgrade_config_inc_to_php', 'upgrade_delete_token'),
<a name="l83"><span class="linenum">  83</span></a>      '0.7.0' =&gt; <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('upgrade_rp_to_store', 'upgrade_token_to_store')
<a name="l84"><span class="linenum">  84</span></a>  );
<a name="l85"><span class="linenum">  85</span></a>  
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment">/**</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment"> * This variable holds an instance of the XTemplate engine.</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment"> *</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment"> * @global object $xtpl</span>
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment"> */</span>
<a name="l92"><span class="linenum">  92</span></a>  <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a> = NULL;
<a name="l93"><span class="linenum">  93</span></a>  
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment">/**</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment"> * This variable holds the combined $_GET and $_POST superglobal arrays.</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment"> *</span>
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment"> * @global array $GETPOST</span>
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment"> */</span>
<a name="l99"><span class="linenum">  99</span></a>  <a class="var it145" onMouseOver="hilite(145)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it66" onMouseOver="hilite(66)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../_variables/_GET.html">$_GET</a>, <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('_POST')" href="../_variables/_POST.html">$_POST</a>);
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>  <a class="function" onClick="logFunction('upgrade_start')" href="../_functions/upgrade_start.html" onMouseOver="funcPopup(event,'upgrade_start')">upgrade_start</a>();
<a name="l102"><span class="linenum"> 102</span></a>  
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">/**</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment"> * Entry point for SimpleID upgrade script.</span>
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment"> *</span>
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment"> * @see user_init()</span>
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment"> */</span>
<a name="l108"><span class="linenum"> 108</span></a>  function <a class="function" onClick="logFunction('upgrade_start')" href="../_functions/upgrade_start.html" onMouseOver="funcPopup(event,'upgrade_start')">upgrade_start</a>() {
<a name="l109"><span class="linenum"> 109</span></a>      global <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>, <a class="var it145" onMouseOver="hilite(145)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>;
<a name="l110"><span class="linenum"> 110</span></a>      
<a name="l111"><span class="linenum"> 111</span></a>      <a class="function" onClick="logFunction('locale_init')" href="../_functions/locale_init.html" onMouseOver="funcPopup(event,'locale_init')">locale_init</a>(SIMPLEID_LOCALE);
<a name="l112"><span class="linenum"> 112</span></a>          
<a name="l113"><span class="linenum"> 113</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a> = <span class="keyword">new </span><a class="class" onClick="logClass('XTemplate')" href="../_classes/xtemplate.html" onMouseOver="classPopup(event,'xtemplate')">XTemplate</a>('html/template.xtpl');
<a name="l114"><span class="linenum"> 114</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('version', <a class="constant" onClick="logConstant('SIMPLEID_VERSION')" href="../_constants/SIMPLEID_VERSION.html" onMouseOver="constPopup(event,'SIMPLEID_VERSION')">SIMPLEID_VERSION</a>);
<a name="l115"><span class="linenum"> 115</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('base_path', <a class="function" onClick="logFunction('get_base_path')" href="../_functions/get_base_path.html" onMouseOver="funcPopup(event,'get_base_path')">get_base_path</a>());
<a name="l116"><span class="linenum"> 116</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('css', '@import url(' . <a class="function" onClick="logFunction('get_base_path')" href="../_functions/get_base_path.html" onMouseOver="funcPopup(event,'get_base_path')">get_base_path</a>() . 'html/upgrade.css);');
<a name="l117"><span class="linenum"> 117</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('footer_doc', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Documentation'));
<a name="l118"><span class="linenum"> 118</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('footer_support', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Support'));
<a name="l119"><span class="linenum"> 119</span></a>      
<a name="l120"><span class="linenum"> 120</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(SIMPLEID_IDENTITIES_DIR)) {
<a name="l121"><span class="linenum"> 121</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Identities directory not found.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for instructions on how to set up SimpleID.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started')));
<a name="l122"><span class="linenum"> 122</span></a>      }
<a name="l123"><span class="linenum"> 123</span></a>      
<a name="l124"><span class="linenum"> 124</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(SIMPLEID_CACHE_DIR) || !<a class="phpfunction" onClick="logFunction('is_writeable')" href="../_functions/is_writeable.html" onMouseOver="phpfuncPopup(event,'is_writeable')">is_writeable</a>(SIMPLEID_CACHE_DIR)) {
<a name="l125"><span class="linenum"> 125</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Cache directory not found or not writeable.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for instructions on how to set up SimpleID.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started')));
<a name="l126"><span class="linenum"> 126</span></a>      }
<a name="l127"><span class="linenum"> 127</span></a>      
<a name="l128"><span class="linenum"> 128</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(SIMPLEID_STORE_DIR) || !<a class="phpfunction" onClick="logFunction('is_writeable')" href="../_functions/is_writeable.html" onMouseOver="phpfuncPopup(event,'is_writeable')">is_writeable</a>(SIMPLEID_STORE_DIR)) {
<a name="l129"><span class="linenum"> 129</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Store directory not found or not writeable.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for instructions on how to set up SimpleID.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started')));
<a name="l130"><span class="linenum"> 130</span></a>      }
<a name="l131"><span class="linenum"> 131</span></a>  
<a name="l132"><span class="linenum"> 132</span></a>      if ((@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('register_globals') === 1) || (@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('register_globals') === '1') || (<a class="phpfunction" onClick="logFunction('strtolower')" href="../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('register_globals')) == 'on')) {
<a name="l133"><span class="linenum"> 133</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('register_globals is enabled in PHP configuration, which is not supported by SimpleID.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l134"><span class="linenum"> 134</span></a>      }
<a name="l135"><span class="linenum"> 135</span></a>      
<a name="l136"><span class="linenum"> 136</span></a>      if (!<a class="function" onClick="logFunction('bignum_loaded')" href="../_functions/bignum_loaded.html" onMouseOver="funcPopup(event,'bignum_loaded')">bignum_loaded</a>()) {
<a name="l137"><span class="linenum"> 137</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('gmp/bcmath PHP extension not loaded.');
<a name="l138"><span class="linenum"> 138</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'gmp/bcmath', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l139"><span class="linenum"> 139</span></a>      }
<a name="l140"><span class="linenum"> 140</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('preg_match')) {
<a name="l141"><span class="linenum"> 141</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('pcre PHP extension not loaded.');
<a name="l142"><span class="linenum"> 142</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'pcre', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l143"><span class="linenum"> 143</span></a>      }
<a name="l144"><span class="linenum"> 144</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('session_start')) {
<a name="l145"><span class="linenum"> 145</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('session PHP extension not loaded.');
<a name="l146"><span class="linenum"> 146</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'session', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l147"><span class="linenum"> 147</span></a>      }
<a name="l148"><span class="linenum"> 148</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('xml_parser_create_ns')) {
<a name="l149"><span class="linenum"> 149</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('xml PHP extension not loaded.');
<a name="l150"><span class="linenum"> 150</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'xml', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l151"><span class="linenum"> 151</span></a>      }
<a name="l152"><span class="linenum"> 152</span></a>      if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('hash')) {
<a name="l153"><span class="linenum"> 153</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('hash PHP extension not loaded.');
<a name="l154"><span class="linenum"> 154</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('One or more required PHP extensions (%extension) is not loaded.  See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('%extension' =&gt; 'hash', '!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l155"><span class="linenum"> 155</span></a>      }
<a name="l156"><span class="linenum"> 156</span></a>      if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('suhosin.get.max_value_length')) &amp;&amp; (@<a class="phpfunction" onClick="logFunction('ini_get')" href="../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>('suhosin.get.max_value_length') &lt; 1024)) {
<a name="l157"><span class="linenum"> 157</span></a>          <a class="function" onClick="logFunction('log_fatal')" href="../_functions/log_fatal.html" onMouseOver="funcPopup(event,'log_fatal')">log_fatal</a>('suhosin.get.max_value_length &lt; 1024');
<a name="l158"><span class="linenum"> 158</span></a>          <a class="function" onClick="logFunction('indirect_fatal_error')" href="../_functions/indirect_fatal_error.html" onMouseOver="funcPopup(event,'indirect_fatal_error')">indirect_fatal_error</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('suhosin.get.max_value_length is less than 1024, which will lead to problems. See the &lt;a href=&quot;!url&quot;&gt;manual&lt;/a&gt; for further information on system requirements.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/system-requirements')));
<a name="l159"><span class="linenum"> 159</span></a>      }
<a name="l160"><span class="linenum"> 160</span></a>  
<a name="l161"><span class="linenum"> 161</span></a>      <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a> = (<a class="phpfunction" onClick="logFunction('isset')" href="../_functions/isset.html" onMouseOver="phpfuncPopup(event,'isset')">isset</a>(<a class="var it145" onMouseOver="hilite(145)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['q'])) ? <a class="var it145" onMouseOver="hilite(145)" onMouseOut="lolite()" onClick="logVariable('GETPOST')" href="../_variables/GETPOST.html">$GETPOST</a>['q'] : '';
<a name="l162"><span class="linenum"> 162</span></a>      <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a>);
<a name="l163"><span class="linenum"> 163</span></a>      
<a name="l164"><span class="linenum"> 164</span></a>      <a class="function" onClick="logFunction('extension_init')" href="../_functions/extension_init.html" onMouseOver="funcPopup(event,'extension_init')">extension_init</a>();
<a name="l165"><span class="linenum"> 165</span></a>      <a class="function" onClick="logFunction('user_init')" href="../_functions/user_init.html" onMouseOver="funcPopup(event,'user_init')">user_init</a>(NULL);
<a name="l166"><span class="linenum"> 166</span></a>      <a class="function" onClick="logFunction('upgrade_user_init')" href="../_functions/upgrade_user_init.html" onMouseOver="funcPopup(event,'upgrade_user_init')">upgrade_user_init</a>();
<a name="l167"><span class="linenum"> 167</span></a>      
<a name="l168"><span class="linenum"> 168</span></a>      <a class="var it147" onMouseOver="hilite(147)" onMouseOut="lolite()" onClick="logVariable('routes')" href="../_variables/routes.html">$routes</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>(
<a name="l169"><span class="linenum"> 169</span></a>          'upgrade-selection' =&gt; 'upgrade_selection',
<a name="l170"><span class="linenum"> 170</span></a>          'upgrade-apply' =&gt; 'upgrade_apply',
<a name="l171"><span class="linenum"> 171</span></a>          '.*' =&gt; 'upgrade_info'
<a name="l172"><span class="linenum"> 172</span></a>      );
<a name="l173"><span class="linenum"> 173</span></a>      
<a name="l174"><span class="linenum"> 174</span></a>      <a class="function" onClick="logFunction('simpleweb_run')" href="../_functions/simpleweb_run.html" onMouseOver="funcPopup(event,'simpleweb_run')">simpleweb_run</a>(<a class="var it147" onMouseOver="hilite(147)" onMouseOut="lolite()" onClick="logVariable('routes')" href="../_variables/routes.html">$routes</a>, <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('q')" href="../_variables/q.html">$q</a>));
<a name="l175"><span class="linenum"> 175</span></a>  }
<a name="l176"><span class="linenum"> 176</span></a>  
<a name="l177"><span class="linenum"> 177</span></a>  <span class="comment">/**</span>
<a name="l178"><span class="linenum"> 178</span></a>  <span class="comment"> * Displays the upgrade info page.</span>
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment"> */</span>
<a name="l180"><span class="linenum"> 180</span></a>  function <a class="function" onClick="logFunction('upgrade_info')" href="../_functions/upgrade_info.html" onMouseOver="funcPopup(event,'upgrade_info')">upgrade_info</a>() {
<a name="l181"><span class="linenum"> 181</span></a>      global <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>;
<a name="l182"><span class="linenum"> 182</span></a>      
<a name="l183"><span class="linenum"> 183</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('token', <a class="function" onClick="logFunction('get_form_token')" href="../_functions/get_form_token.html" onMouseOver="funcPopup(event,'get_form_token')">get_form_token</a>('upgrade_info'));
<a name="l184"><span class="linenum"> 184</span></a>      
<a name="l185"><span class="linenum"> 185</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('intro', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Use this script to update your installation whenever you upgrade to a new version of SimpleID.'));
<a name="l186"><span class="linenum"> 186</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('simpleid_docs', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('For more detailed information, see the &lt;a href=&quot;!url&quot;&gt;SimpleID documentation&lt;/a&gt;.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/upgrading')));
<a name="l187"><span class="linenum"> 187</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('step1', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('&lt;strong&gt;Back up your installation&lt;/strong&gt;. This process will change various files within your SimpleID installation and in case of emergency you may need to revert to a backup.'));
<a name="l188"><span class="linenum"> 188</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('step2', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Install your new files in the appropriate location, as described in the &lt;a href=&quot;!url&quot;&gt;SimpleID documentation&lt;/a&gt;.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/installing-simpleid')));
<a name="l189"><span class="linenum"> 189</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('click_continue', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('When you have performed the steps above, click &lt;strong&gt;Continue&lt;/strong&gt;.'));
<a name="l190"><span class="linenum"> 190</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('continue_button', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Continue'));
<a name="l191"><span class="linenum"> 191</span></a>      
<a name="l192"><span class="linenum"> 192</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.upgrade_info');
<a name="l193"><span class="linenum"> 193</span></a>      
<a name="l194"><span class="linenum"> 194</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('title', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Upgrade'));
<a name="l195"><span class="linenum"> 195</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main');
<a name="l196"><span class="linenum"> 196</span></a>      
<a name="l197"><span class="linenum"> 197</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>('main');
<a name="l198"><span class="linenum"> 198</span></a>  }
<a name="l199"><span class="linenum"> 199</span></a>  
<a name="l200"><span class="linenum"> 200</span></a>  <span class="comment">/**</span>
<a name="l201"><span class="linenum"> 201</span></a>  <span class="comment"> * Detects the current installed version of SimpleID, selects the individual upgrade</span>
<a name="l202"><span class="linenum"> 202</span></a>  <span class="comment"> * functions applicable to this upgrade and displays the upgrade</span>
<a name="l203"><span class="linenum"> 203</span></a>  <span class="comment"> * selection page.</span>
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment"> */</span>
<a name="l205"><span class="linenum"> 205</span></a>  function <a class="function" onClick="logFunction('upgrade_selection')" href="../_functions/upgrade_selection.html" onMouseOver="funcPopup(event,'upgrade_selection')">upgrade_selection</a>() {
<a name="l206"><span class="linenum"> 206</span></a>      global <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a>;
<a name="l207"><span class="linenum"> 207</span></a>      
<a name="l208"><span class="linenum"> 208</span></a>      <a class="function" onClick="logFunction('cache_expire')" href="../_functions/cache_expire.html" onMouseOver="funcPopup(event,'cache_expire')">cache_expire</a>(<a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('upgrade' =&gt; 0));
<a name="l209"><span class="linenum"> 209</span></a>      
<a name="l210"><span class="linenum"> 210</span></a>      if (!<a class="function" onClick="logFunction('validate_form_token')" href="../_functions/validate_form_token.html" onMouseOver="funcPopup(event,'validate_form_token')">validate_form_token</a>(<a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('_POST')" href="../_variables/_POST.html">$_POST</a>['tk'], 'upgrade_info')) {
<a name="l211"><span class="linenum"> 211</span></a>          <a class="function" onClick="logFunction('set_message')" href="../_functions/set_message.html" onMouseOver="funcPopup(event,'set_message')">set_message</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('SimpleID detected a potential security attack.  Please try again.'));
<a name="l212"><span class="linenum"> 212</span></a>          <a class="function" onClick="logFunction('upgrade_info')" href="../_functions/upgrade_info.html" onMouseOver="funcPopup(event,'upgrade_info')">upgrade_info</a>();
<a name="l213"><span class="linenum"> 213</span></a>          return;
<a name="l214"><span class="linenum"> 214</span></a>      }
<a name="l215"><span class="linenum"> 215</span></a>  
<a name="l216"><span class="linenum"> 216</span></a>      <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="function" onClick="logFunction('upgrade_get_functions')" href="../_functions/upgrade_get_functions.html" onMouseOver="funcPopup(event,'upgrade_get_functions')">upgrade_get_functions</a>();
<a name="l217"><span class="linenum"> 217</span></a>      
<a name="l218"><span class="linenum"> 218</span></a>      if (<a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>) == 0) {
<a name="l219"><span class="linenum"> 219</span></a>          if (!<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a>) {
<a name="l220"><span class="linenum"> 220</span></a>              <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('edit_upgrade_php', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Remember to edit upgrade.php to check &lt;code&gt;<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a>&lt;/code&gt; back to &lt;code&gt;FALSE&lt;/code&gt;.'));
<a name="l221"><span class="linenum"> 221</span></a>              <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.selection.selection_complete.upgrade_access_check');
<a name="l222"><span class="linenum"> 222</span></a>          }
<a name="l223"><span class="linenum"> 223</span></a>          
<a name="l224"><span class="linenum"> 224</span></a>          <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('script_complete', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Your SimpleID installation is up-to-date.  This script is complete.'));
<a name="l225"><span class="linenum"> 225</span></a>          
<a name="l226"><span class="linenum"> 226</span></a>          <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.upgrade_selection.selection_complete');
<a name="l227"><span class="linenum"> 227</span></a>      } else {
<a name="l228"><span class="linenum"> 228</span></a>          <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('handle')" href="../_variables/handle.html">$handle</a> = <a class="function" onClick="logFunction('random_id')" href="../_functions/random_id.html" onMouseOver="funcPopup(event,'random_id')">random_id</a>();
<a name="l229"><span class="linenum"> 229</span></a>          <a class="function" onClick="logFunction('cache_set')" href="../_functions/cache_set.html" onMouseOver="funcPopup(event,'cache_set')">cache_set</a>('upgrade', <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('handle')" href="../_variables/handle.html">$handle</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>);
<a name="l230"><span class="linenum"> 230</span></a>          
<a name="l231"><span class="linenum"> 231</span></a>          <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('handle', <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('handle')" href="../_variables/handle.html">$handle</a>);
<a name="l232"><span class="linenum"> 232</span></a>          <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('token', <a class="function" onClick="logFunction('get_form_token')" href="../_functions/get_form_token.html" onMouseOver="funcPopup(event,'get_form_token')">get_form_token</a>('upgrade_selection'));
<a name="l233"><span class="linenum"> 233</span></a>          
<a name="l234"><span class="linenum"> 234</span></a>          <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('click_continue', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Click &lt;strong&gt;Continue&lt;/strong&gt; to proceed with the upgrade.'));
<a name="l235"><span class="linenum"> 235</span></a>          <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('continue_button', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Continue'));
<a name="l236"><span class="linenum"> 236</span></a>          
<a name="l237"><span class="linenum"> 237</span></a>          <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.upgrade_selection.selection_continue');
<a name="l238"><span class="linenum"> 238</span></a>      }
<a name="l239"><span class="linenum"> 239</span></a>      
<a name="l240"><span class="linenum"> 240</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('original_version', <a class="function" onClick="logFunction('upgrade_get_version')" href="../_functions/upgrade_get_version.html" onMouseOver="funcPopup(event,'upgrade_get_version')">upgrade_get_version</a>());
<a name="l241"><span class="linenum"> 241</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('this_version', <a class="constant" onClick="logConstant('SIMPLEID_VERSION')" href="../_constants/SIMPLEID_VERSION.html" onMouseOver="constPopup(event,'SIMPLEID_VERSION')">SIMPLEID_VERSION</a>);
<a name="l242"><span class="linenum"> 242</span></a>      
<a name="l243"><span class="linenum"> 243</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('version_detected', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('The version of SimpleID you are updating from has been automatically detected.'));
<a name="l244"><span class="linenum"> 244</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('original_version_label', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Original version'));
<a name="l245"><span class="linenum"> 245</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('this_version_label', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Upgrade version'));
<a name="l246"><span class="linenum"> 246</span></a>      
<a name="l247"><span class="linenum"> 247</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.upgrade_selection');
<a name="l248"><span class="linenum"> 248</span></a>      
<a name="l249"><span class="linenum"> 249</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('title', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Upgrade'));
<a name="l250"><span class="linenum"> 250</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main');
<a name="l251"><span class="linenum"> 251</span></a>      
<a name="l252"><span class="linenum"> 252</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>('main');
<a name="l253"><span class="linenum"> 253</span></a>  }
<a name="l254"><span class="linenum"> 254</span></a>  
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">/**</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment"> * Applies the upgrade.</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment"> */</span>
<a name="l258"><span class="linenum"> 258</span></a>  function <a class="function" onClick="logFunction('upgrade_apply')" href="../_functions/upgrade_apply.html" onMouseOver="funcPopup(event,'upgrade_apply')">upgrade_apply</a>() {
<a name="l259"><span class="linenum"> 259</span></a>      global <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a>;
<a name="l260"><span class="linenum"> 260</span></a>      
<a name="l261"><span class="linenum"> 261</span></a>      if (!<a class="function" onClick="logFunction('validate_form_token')" href="../_functions/validate_form_token.html" onMouseOver="funcPopup(event,'validate_form_token')">validate_form_token</a>(<a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('_POST')" href="../_variables/_POST.html">$_POST</a>['tk'], 'upgrade_selection')) {
<a name="l262"><span class="linenum"> 262</span></a>          <a class="function" onClick="logFunction('set_message')" href="../_functions/set_message.html" onMouseOver="funcPopup(event,'set_message')">set_message</a>(<a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('SimpleID detected a potential security attack.  Please try again.'));
<a name="l263"><span class="linenum"> 263</span></a>          <a class="function" onClick="logFunction('upgrade_selection')" href="../_functions/upgrade_selection.html" onMouseOver="funcPopup(event,'upgrade_selection')">upgrade_selection</a>();
<a name="l264"><span class="linenum"> 264</span></a>          return;
<a name="l265"><span class="linenum"> 265</span></a>      }
<a name="l266"><span class="linenum"> 266</span></a>      
<a name="l267"><span class="linenum"> 267</span></a>      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a> = '';
<a name="l268"><span class="linenum"> 268</span></a>      <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>('upgrade', <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('_POST')" href="../_variables/_POST.html">$_POST</a>['handle']);
<a name="l269"><span class="linenum"> 269</span></a>      
<a name="l270"><span class="linenum"> 270</span></a>      foreach (<a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> as <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>) {
<a name="l271"><span class="linenum"> 271</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a> .= <a class="phpfunction" onClick="logFunction('call_user_func')" href="../_functions/call_user_func.html" onMouseOver="phpfuncPopup(event,'call_user_func')">call_user_func</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>);
<a name="l272"><span class="linenum"> 272</span></a>      }
<a name="l273"><span class="linenum"> 273</span></a>      
<a name="l274"><span class="linenum"> 274</span></a>      if (!<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a>) {
<a name="l275"><span class="linenum"> 275</span></a>          <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('edit_upgrade_php', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Remember to edit upgrade.php to check &lt;code&gt;<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a>&lt;/code&gt; back to &lt;code&gt;TRUE&lt;/code&gt;.'));
<a name="l276"><span class="linenum"> 276</span></a>          <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.upgrade_results.upgrade_access_check');
<a name="l277"><span class="linenum"> 277</span></a>      }
<a name="l278"><span class="linenum"> 278</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('results', <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('results')" href="../_variables/results.html">$results</a>);
<a name="l279"><span class="linenum"> 279</span></a>      
<a name="l280"><span class="linenum"> 280</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('upgrade_complete', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Your SimpleID installation has been upgraded.  Please check the results below for any errors.'));
<a name="l281"><span class="linenum"> 281</span></a>      
<a name="l282"><span class="linenum"> 282</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.upgrade_results');
<a name="l283"><span class="linenum"> 283</span></a>      
<a name="l284"><span class="linenum"> 284</span></a>      <a class="function" onClick="logFunction('cache_expire')" href="../_functions/cache_expire.html" onMouseOver="funcPopup(event,'cache_expire')">cache_expire</a>(<a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('upgrade' =&gt; 0));
<a name="l285"><span class="linenum"> 285</span></a>      
<a name="l286"><span class="linenum"> 286</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('title', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Upgrade'));
<a name="l287"><span class="linenum"> 287</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main');
<a name="l288"><span class="linenum"> 288</span></a>      
<a name="l289"><span class="linenum"> 289</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>('main');
<a name="l290"><span class="linenum"> 290</span></a>  }
<a name="l291"><span class="linenum"> 291</span></a>  
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment">/**</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment"> * Detects the current installed version of SimpleID</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment"> *</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment"> * The current installed version of SimpleID is taken from the {@link store_get() version}</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment"> * application setting.  This setting is only available for versions 0.7 or later, so</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment"> * if it is absent we can assume it's prior to version 0.7.</span>
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment"> *</span>
<a name="l299"><span class="linenum"> 299</span></a>  <span class="comment"> * @return string the detected version, or the string '0.6.0 or earlier'</span>
<a name="l300"><span class="linenum"> 300</span></a>  <span class="comment"> */</span>
<a name="l301"><span class="linenum"> 301</span></a>  function <a class="function" onClick="logFunction('upgrade_get_version')" href="../_functions/upgrade_get_version.html" onMouseOver="funcPopup(event,'upgrade_get_version')">upgrade_get_version</a>() {
<a name="l302"><span class="linenum"> 302</span></a>      return <a class="function" onClick="logFunction('store_get')" href="../_functions/store_get.html" onMouseOver="funcPopup(event,'store_get')">store_get</a>('version', '0.6.0 or earlier');
<a name="l303"><span class="linenum"> 303</span></a>  }
<a name="l304"><span class="linenum"> 304</span></a>  
<a name="l305"><span class="linenum"> 305</span></a>  <span class="comment">/**</span>
<a name="l306"><span class="linenum"> 306</span></a>  <span class="comment"> * Sets the current version of SimpleID.</span>
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment"> *</span>
<a name="l308"><span class="linenum"> 308</span></a>  <span class="comment"> * This function sets the version application setting via {@link store_get()}.</span>
<a name="l309"><span class="linenum"> 309</span></a>  <span class="comment"> * A specific version can be specified, or it can be taken from {@link SIMPLEID_VERSION}.</span>
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment"> *</span>
<a name="l311"><span class="linenum"> 311</span></a>  <span class="comment"> * @param string $version the version to set</span>
<a name="l312"><span class="linenum"> 312</span></a>  <span class="comment"> */</span>
<a name="l313"><span class="linenum"> 313</span></a>  function <a class="function" onClick="logFunction('upgrade_set_version')" href="../_functions/upgrade_set_version.html" onMouseOver="funcPopup(event,'upgrade_set_version')">upgrade_set_version</a>(<a class="var it41" onMouseOver="hilite(41)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> = NULL) {
<a name="l314"><span class="linenum"> 314</span></a>      if (<a class="var it41" onMouseOver="hilite(41)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> == NULL) <a class="var it41" onMouseOver="hilite(41)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> = <a class="constant" onClick="logConstant('SIMPLEID_VERSION')" href="../_constants/SIMPLEID_VERSION.html" onMouseOver="constPopup(event,'SIMPLEID_VERSION')">SIMPLEID_VERSION</a>;
<a name="l315"><span class="linenum"> 315</span></a>      <a class="function" onClick="logFunction('store_set')" href="../_functions/store_set.html" onMouseOver="funcPopup(event,'store_set')">store_set</a>('version', <a class="var it41" onMouseOver="hilite(41)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>);
<a name="l316"><span class="linenum"> 316</span></a>  }
<a name="l317"><span class="linenum"> 317</span></a>  
<a name="l318"><span class="linenum"> 318</span></a>  <span class="comment">/**</span>
<a name="l319"><span class="linenum"> 319</span></a>  <span class="comment"> * Selects the upgrade functions applicable for this upgrade.</span>
<a name="l320"><span class="linenum"> 320</span></a>  <span class="comment"> *</span>
<a name="l321"><span class="linenum"> 321</span></a>  <span class="comment"> * The upgrade functions are specified by the {@link $upgrade_functions}</span>
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment"> * variable.  This variable is an associative array containing version numbers</span>
<a name="l323"><span class="linenum"> 323</span></a>  <span class="comment"> * as keys and an array of upgrade function names as values.  This function</span>
<a name="l324"><span class="linenum"> 324</span></a>  <span class="comment"> * merges all the upgrade function names of the version between the current</span>
<a name="l325"><span class="linenum"> 325</span></a>  <span class="comment"> * installed version and the upgraded version.</span>
<a name="l326"><span class="linenum"> 326</span></a>  <span class="comment"> *</span>
<a name="l327"><span class="linenum"> 327</span></a>  <span class="comment"> * @param string $version the version of SimpleID to upgrade from, calls</span>
<a name="l328"><span class="linenum"> 328</span></a>  <span class="comment"> * {@link upgrade_get_version()} if not specified</span>
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment"> * @return array an array of strings, containing the list of upgrade functions</span>
<a name="l330"><span class="linenum"> 330</span></a>  <span class="comment"> * to call.  The functions should be called in the same order as they appear</span>
<a name="l331"><span class="linenum"> 331</span></a>  <span class="comment"> * in this array</span>
<a name="l332"><span class="linenum"> 332</span></a>  <span class="comment"> *</span>
<a name="l333"><span class="linenum"> 333</span></a>  <span class="comment"> */</span>
<a name="l334"><span class="linenum"> 334</span></a>  function <a class="function" onClick="logFunction('upgrade_get_functions')" href="../_functions/upgrade_get_functions.html" onMouseOver="funcPopup(event,'upgrade_get_functions')">upgrade_get_functions</a>(<a class="var it41" onMouseOver="hilite(41)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> = NULL) {
<a name="l335"><span class="linenum"> 335</span></a>      global <a class="var it144" onMouseOver="hilite(144)" onMouseOut="lolite()" onClick="logVariable('upgrade_functions')" href="../_variables/upgrade_functions.html">$upgrade_functions</a>;
<a name="l336"><span class="linenum"> 336</span></a>      
<a name="l337"><span class="linenum"> 337</span></a>      if (<a class="var it41" onMouseOver="hilite(41)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> == NULL) <a class="var it41" onMouseOver="hilite(41)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a> = <a class="function" onClick="logFunction('upgrade_get_version')" href="../_functions/upgrade_get_version.html" onMouseOver="funcPopup(event,'upgrade_get_version')">upgrade_get_version</a>();
<a name="l338"><span class="linenum"> 338</span></a>      <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>();
<a name="l339"><span class="linenum"> 339</span></a>      
<a name="l340"><span class="linenum"> 340</span></a>      <a class="phpfunction" onClick="logFunction('uksort')" href="../_functions/uksort.html" onMouseOver="phpfuncPopup(event,'uksort')">uksort</a>(<a class="var it144" onMouseOver="hilite(144)" onMouseOut="lolite()" onClick="logVariable('upgrade_functions')" href="../_variables/upgrade_functions.html">$upgrade_functions</a>, '_upgrade_version_reverse_sort');
<a name="l341"><span class="linenum"> 341</span></a>      
<a name="l342"><span class="linenum"> 342</span></a>      foreach (<a class="var it144" onMouseOver="hilite(144)" onMouseOut="lolite()" onClick="logVariable('upgrade_functions')" href="../_variables/upgrade_functions.html">$upgrade_functions</a> as <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('upgrade_version')" href="../_variables/upgrade_version.html">$upgrade_version</a> =&gt; <a class="var it153" onMouseOver="hilite(153)" onMouseOut="lolite()" onClick="logVariable('upgrades')" href="../_variables/upgrades.html">$upgrades</a>) {
<a name="l343"><span class="linenum"> 343</span></a>          if (<a class="phpfunction" onClick="logFunction('version_compare')" href="../_functions/version_compare.html" onMouseOver="phpfuncPopup(event,'version_compare')">version_compare</a>(<a class="var it41" onMouseOver="hilite(41)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>, <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('upgrade_version')" href="../_variables/upgrade_version.html">$upgrade_version</a>, '&lt;')) {
<a name="l344"><span class="linenum"> 344</span></a>              <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>, <a class="var it153" onMouseOver="hilite(153)" onMouseOut="lolite()" onClick="logVariable('upgrades')" href="../_variables/upgrades.html">$upgrades</a>);
<a name="l345"><span class="linenum"> 345</span></a>          }
<a name="l346"><span class="linenum"> 346</span></a>      }
<a name="l347"><span class="linenum"> 347</span></a>      
<a name="l348"><span class="linenum"> 348</span></a>      if (<a class="phpfunction" onClick="logFunction('version_compare')" href="../_functions/version_compare.html" onMouseOver="phpfuncPopup(event,'version_compare')">version_compare</a>(<a class="var it41" onMouseOver="hilite(41)" onMouseOut="lolite()" onClick="logVariable('version')" href="../_variables/version.html">$version</a>, <a class="constant" onClick="logConstant('SIMPLEID_VERSION')" href="../_constants/SIMPLEID_VERSION.html" onMouseOver="constPopup(event,'SIMPLEID_VERSION')">SIMPLEID_VERSION</a>, '&lt;')) <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>[] = 'upgrade_set_version';
<a name="l349"><span class="linenum"> 349</span></a>      
<a name="l350"><span class="linenum"> 350</span></a>      return <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>;
<a name="l351"><span class="linenum"> 351</span></a>  }
<a name="l352"><span class="linenum"> 352</span></a>  
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment">/**</span>
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment"> * Callback function for uksort() to reverse sort version numbers.</span>
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment"> *</span>
<a name="l356"><span class="linenum"> 356</span></a>  <span class="comment"> * @param string $a</span>
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment"> * @param string $b</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment"> * @return int</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment"> */</span>
<a name="l360"><span class="linenum"> 360</span></a>  function <a class="function" onClick="logFunction('_upgrade_version_reverse_sort')" href="../_functions/_upgrade_version_reverse_sort.html" onMouseOver="funcPopup(event,'_upgrade_version_reverse_sort')">_upgrade_version_reverse_sort</a>(<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>, <a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('b')" href="../_variables/b.html">$b</a>) {
<a name="l361"><span class="linenum"> 361</span></a>      return -<a class="phpfunction" onClick="logFunction('version_compare')" href="../_functions/version_compare.html" onMouseOver="phpfuncPopup(event,'version_compare')">version_compare</a>(<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>, <a class="var it155" onMouseOver="hilite(155)" onMouseOut="lolite()" onClick="logVariable('b')" href="../_variables/b.html">$b</a>);
<a name="l362"><span class="linenum"> 362</span></a>  }
<a name="l363"><span class="linenum"> 363</span></a>  
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment">/**</span>
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment"> * Determines whether the current user has permission to run this script.</span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment"> *</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment"> * A user has permission to run this script if:</span>
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment"> *</span>
<a name="l369"><span class="linenum"> 369</span></a>  <span class="comment"> * - administrator=1 appears in the user's identity file; or</span>
<a name="l370"><span class="linenum"> 370</span></a>  <span class="comment"> * - {@link $upgrade_access_check} is false</span>
<a name="l371"><span class="linenum"> 371</span></a>  <span class="comment"> *</span>
<a name="l372"><span class="linenum"> 372</span></a>  <span class="comment"> * If the user does not have permission, {@link upgade_access_denied()} is called</span>
<a name="l373"><span class="linenum"> 373</span></a>  <span class="comment"> */</span>
<a name="l374"><span class="linenum"> 374</span></a>  function <a class="function" onClick="logFunction('upgrade_user_init')" href="../_functions/upgrade_user_init.html" onMouseOver="funcPopup(event,'upgrade_user_init')">upgrade_user_init</a>() {
<a name="l375"><span class="linenum"> 375</span></a>      global <a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a>;
<a name="l376"><span class="linenum"> 376</span></a>      
<a name="l377"><span class="linenum"> 377</span></a>      if (<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a>) {
<a name="l378"><span class="linenum"> 378</span></a>          if ((<a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> == NULL) || (<a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['administrator'] != 1)) <a class="function" onClick="logFunction('upgrade_access_denied')" href="../_functions/upgrade_access_denied.html" onMouseOver="funcPopup(event,'upgrade_access_denied')">upgrade_access_denied</a>();
<a name="l379"><span class="linenum"> 379</span></a>      }
<a name="l380"><span class="linenum"> 380</span></a>  }
<a name="l381"><span class="linenum"> 381</span></a>  
<a name="l382"><span class="linenum"> 382</span></a>  <span class="comment">/**</span>
<a name="l383"><span class="linenum"> 383</span></a>  <span class="comment"> * Displays a page notifying the user that he or she does not have permission to</span>
<a name="l384"><span class="linenum"> 384</span></a>  <span class="comment"> * run the upgrade script.</span>
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment"> */</span>
<a name="l386"><span class="linenum"> 386</span></a>  function <a class="function" onClick="logFunction('upgrade_access_denied')" href="../_functions/upgrade_access_denied.html" onMouseOver="funcPopup(event,'upgrade_access_denied')">upgrade_access_denied</a>() {
<a name="l387"><span class="linenum"> 387</span></a>      global <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>;
<a name="l388"><span class="linenum"> 388</span></a>      
<a name="l389"><span class="linenum"> 389</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('login_required', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Access denied. You are not authorised to access this page. Please &lt;a href=&quot;index.php?q=login&quot;&gt;log in&lt;/a&gt; as an administrator (a user whose identity file includes the line &lt;code&gt;administrator=1&lt;/code&gt;).'));    
<a name="l390"><span class="linenum"> 390</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('edit_upgrade_php', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('If you cannot log in, you will have to edit &lt;code&gt;upgrade.php&lt;/code&gt; to bypass this access check. To do this:'));
<a name="l391"><span class="linenum"> 391</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('edit_upgrade_php1', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('With a text editor find the upgrade.php file.'));
<a name="l392"><span class="linenum"> 392</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('edit_upgrade_php2', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('There is a line inside your upgrade.php file that says &lt;code&gt;<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a> = TRUE;&lt;/code&gt;. Change it to &lt;code&gt;<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a> = FALSE;&lt;/code&gt;.'));
<a name="l393"><span class="linenum"> 393</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('edit_upgrade_php3', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('As soon as the upgrade.php script is done, you must change the file back to its original form with &lt;code&gt;<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('upgrade_access_check')" href="../_variables/upgrade_access_check.html">$upgrade_access_check</a> = TRUE;&lt;/code&gt;.'));
<a name="l394"><span class="linenum"> 394</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('edit_upgrade_php4', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('To avoid having this problem in future, remember to log in to SimpleID as an administrator before you run this script.'));
<a name="l395"><span class="linenum"> 395</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('simpleid_docs', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('For more detailed information, see the &lt;a href=&quot;!url&quot;&gt;SimpleID documentation&lt;/a&gt;.', <a class="phpfunction" onClick="logFunction('array')" href="../_functions/array.html" onMouseOver="phpfuncPopup(event,'array')">array</a>('!url' =&gt; 'http://simpleid.koinic.net/documentation/getting-started/upgrading/running-upgradephp')));
<a name="l396"><span class="linenum"> 396</span></a>      
<a name="l397"><span class="linenum"> 397</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main.upgrade_access_denied');
<a name="l398"><span class="linenum"> 398</span></a>      
<a name="l399"><span class="linenum"> 399</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('assign')" href="../_functions/assign.html" onMouseOver="funcPopup(event,'assign')">assign</a>('title', <a class="function" onClick="logFunction('t')" href="../_functions/t.html" onMouseOver="funcPopup(event,'t')">t</a>('Access Denied'));
<a name="l400"><span class="linenum"> 400</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('parse')" href="../_functions/parse.html" onMouseOver="funcPopup(event,'parse')">parse</a>('main');
<a name="l401"><span class="linenum"> 401</span></a>      
<a name="l402"><span class="linenum"> 402</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('xtpl')" href="../_variables/xtpl.html">$xtpl</a>-&gt;<a class="function" onClick="logFunction('out')" href="../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>('main');
<a name="l403"><span class="linenum"> 403</span></a>      exit;
<a name="l404"><span class="linenum"> 404</span></a>  }
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">/* ------------------------------------------------------------------------------------------------------- */</span>
<a name="l407"><span class="linenum"> 407</span></a>  
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment">/**</span>
<a name="l409"><span class="linenum"> 409</span></a>  <span class="comment"> * Moves the user's site preferences from the cache to the store.</span>
<a name="l410"><span class="linenum"> 410</span></a>  <span class="comment"> *</span>
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment"> * @since 0.7</span>
<a name="l412"><span class="linenum"> 412</span></a>  <span class="comment"> */</span>
<a name="l413"><span class="linenum"> 413</span></a>  function <a class="function" onClick="logFunction('upgrade_rp_to_store')" href="../_functions/upgrade_rp_to_store.html" onMouseOver="funcPopup(event,'upgrade_rp_to_store')">upgrade_rp_to_store</a>() {
<a name="l414"><span class="linenum"> 414</span></a>      <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../_variables/dir.html">$dir</a> = <a class="phpfunction" onClick="logFunction('opendir')" href="../_functions/opendir.html" onMouseOver="phpfuncPopup(event,'opendir')">opendir</a>(SIMPLEID_IDENTITIES_DIR);
<a name="l415"><span class="linenum"> 415</span></a>      
<a name="l416"><span class="linenum"> 416</span></a>      while ((<a class="var it21" onMouseOver="hilite(21)" onMouseOut="lolite()" onClick="logVariable('file')" href="../_variables/file.html">$file</a> = <a class="phpfunction" onClick="logFunction('readdir')" href="../_functions/readdir.html" onMouseOver="phpfuncPopup(event,'readdir')">readdir</a>(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../_variables/dir.html">$dir</a>)) !== false) {
<a name="l417"><span class="linenum"> 417</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../_variables/filename.html">$filename</a> = SIMPLEID_IDENTITIES_DIR . '/' . <a class="var it21" onMouseOver="hilite(21)" onMouseOut="lolite()" onClick="logVariable('file')" href="../_variables/file.html">$file</a>;
<a name="l418"><span class="linenum"> 418</span></a>          
<a name="l419"><span class="linenum"> 419</span></a>          if ((<a class="phpfunction" onClick="logFunction('filetype')" href="../_functions/filetype.html" onMouseOver="phpfuncPopup(event,'filetype')">filetype</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../_variables/filename.html">$filename</a>) != &quot;file&quot;) || (!<a class="phpfunction" onClick="logFunction('preg_match')" href="../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/^(.+)\.identity$/', <a class="var it21" onMouseOver="hilite(21)" onMouseOut="lolite()" onClick="logVariable('file')" href="../_variables/file.html">$file</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../_variables/matches.html">$matches</a>))) continue;
<a name="l420"><span class="linenum"> 420</span></a>          
<a name="l421"><span class="linenum"> 421</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('uid')" href="../_variables/uid.html">$uid</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../_variables/matches.html">$matches</a>[1];
<a name="l422"><span class="linenum"> 422</span></a>          
<a name="l423"><span class="linenum"> 423</span></a>          <a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="function" onClick="logFunction('user_load')" href="../_functions/user_load.html" onMouseOver="funcPopup(event,'user_load')">user_load</a>(<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('uid')" href="../_variables/uid.html">$uid</a>);
<a name="l424"><span class="linenum"> 424</span></a>          <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a> = <a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>('rp', <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('uid')" href="../_variables/uid.html">$uid</a>);
<a name="l425"><span class="linenum"> 425</span></a>          if (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a> != NULL) {
<a name="l426"><span class="linenum"> 426</span></a>              <a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>['rp'] = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('rp')" href="../_variables/rp.html">$rp</a>;
<a name="l427"><span class="linenum"> 427</span></a>              <a class="function" onClick="logFunction('user_save')" href="../_functions/user_save.html" onMouseOver="funcPopup(event,'user_save')">user_save</a>(<a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l428"><span class="linenum"> 428</span></a>              <a class="function" onClick="logFunction('cache_delete')" href="../_functions/cache_delete.html" onMouseOver="funcPopup(event,'cache_delete')">cache_delete</a>('rp', <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('uid')" href="../_variables/uid.html">$uid</a>);
<a name="l429"><span class="linenum"> 429</span></a>          }
<a name="l430"><span class="linenum"> 430</span></a>      }
<a name="l431"><span class="linenum"> 431</span></a>  }
<a name="l432"><span class="linenum"> 432</span></a>  
<a name="l433"><span class="linenum"> 433</span></a>  <span class="comment">/**</span>
<a name="l434"><span class="linenum"> 434</span></a>  <span class="comment"> * Moves the site token from the cache to the store.</span>
<a name="l435"><span class="linenum"> 435</span></a>  <span class="comment"> *</span>
<a name="l436"><span class="linenum"> 436</span></a>  <span class="comment"> * @since 0.7</span>
<a name="l437"><span class="linenum"> 437</span></a>  <span class="comment"> */</span>
<a name="l438"><span class="linenum"> 438</span></a>  function <a class="function" onClick="logFunction('upgrade_token_to_store')" href="../_functions/upgrade_token_to_store.html" onMouseOver="funcPopup(event,'upgrade_token_to_store')">upgrade_token_to_store</a>() {
<a name="l439"><span class="linenum"> 439</span></a>      <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('site_token')" href="../_variables/site_token.html">$site_token</a> = <a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>('token', SIMPLEID_BASE_URL);
<a name="l440"><span class="linenum"> 440</span></a>      
<a name="l441"><span class="linenum"> 441</span></a>      if (<a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('site_token')" href="../_variables/site_token.html">$site_token</a> != NULL) {
<a name="l442"><span class="linenum"> 442</span></a>          <a class="function" onClick="logFunction('store_set')" href="../_functions/store_set.html" onMouseOver="funcPopup(event,'store_set')">store_set</a>('site-token', <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('site_token')" href="../_variables/site_token.html">$site_token</a>);
<a name="l443"><span class="linenum"> 443</span></a>          <a class="function" onClick="logFunction('cache_delete')" href="../_functions/cache_delete.html" onMouseOver="funcPopup(event,'cache_delete')">cache_delete</a>('token', SIMPLEID_BASE_URL);
<a name="l444"><span class="linenum"> 444</span></a>      }
<a name="l445"><span class="linenum"> 445</span></a>  }
<a name="l446"><span class="linenum"> 446</span></a>  
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">/**</span>
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment"> * Checks that config.inc has been renamed to config.php</span>
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment"> *</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment"> * @since 0.9</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment"> */</span>
<a name="l452"><span class="linenum"> 452</span></a>  function <a class="function" onClick="logFunction('upgrade_config_inc_to_php')" href="../_functions/upgrade_config_inc_to_php.html" onMouseOver="funcPopup(event,'upgrade_config_inc_to_php')">upgrade_config_inc_to_php</a>() {
<a name="l453"><span class="linenum"> 453</span></a>      if (<a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('UPGRADE_LEGACY_CONFIG_INC')" href="../_constants/UPGRADE_LEGACY_CONFIG_INC.html" onMouseOver="constPopup(event,'UPGRADE_LEGACY_CONFIG_INC')">UPGRADE_LEGACY_CONFIG_INC</a>')) {
<a name="l454"><span class="linenum"> 454</span></a>          return '&lt;p&gt;You will need to rename &lt;code&gt;config.inc&lt;/code&gt; to &lt;code&gt;config.php&lt;/code&gt;.&lt;/p&gt;';
<a name="l455"><span class="linenum"> 455</span></a>      }
<a name="l456"><span class="linenum"> 456</span></a>  }
<a name="l457"><span class="linenum"> 457</span></a>  
<a name="l458"><span class="linenum"> 458</span></a>  <span class="comment">/**</span>
<a name="l459"><span class="linenum"> 459</span></a>  <span class="comment"> * Deletes the site-token setting for a more secure version</span>
<a name="l460"><span class="linenum"> 460</span></a>  <span class="comment"> *</span>
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment"> * @since 0.9</span>
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment"> */</span>
<a name="l463"><span class="linenum"> 463</span></a>  function <a class="function" onClick="logFunction('upgrade_delete_token')" href="../_functions/upgrade_delete_token.html" onMouseOver="funcPopup(event,'upgrade_delete_token')">upgrade_delete_token</a>() {
<a name="l464"><span class="linenum"> 464</span></a>      <a class="function" onClick="logFunction('store_del')" href="../_functions/store_del.html" onMouseOver="funcPopup(event,'store_del')">store_del</a>('site-token');
<a name="l465"><span class="linenum"> 465</span></a>  }
<a name="l466"><span class="linenum"> 466</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'random_id': ['random_id', 'Generates a relatively unique identifier which can be used as, among other things, an OpenID association handle or an OAuth client identifier.  The identifier returned is at least 24 characters long and contains only hexadecimal characters. ', [['www','random.inc.php',91],['www','random.inc',91]], 3],
'upgrade_token_to_store': ['upgrade_token_to_store', 'Moves the site token from the cache to the store. ', [['www','upgrade.php',433]], 0],
't': ['t', 'Translates a string. ', [['www','locale.inc.php',49]], 183],
'upgrade_get_functions': ['upgrade_get_functions', 'Selects the upgrade functions applicable for this upgrade. ', [['www','upgrade.php',318]], 1],
'upgrade_info': ['upgrade_info', 'Displays the upgrade info page. ', [['www','upgrade.php',177]], 1],
'indirect_fatal_error': ['indirect_fatal_error', 'Displays a fatal error message and exits. ', [['www','common.inc',49],['www','common.inc.php',49]], 32],
'get_form_token': ['get_form_token', 'Obtains a form token given a form ID. ', [['www','common.inc',272],['www','common.inc.php',518]], 14],
'cache_get': ['cache_get', 'Obtains data from the cache. ', [['www','cache.inc.php',58],['www','cache.inc',57]], 17],
'upgrade_start': ['upgrade_start', 'Entry point for SimpleID upgrade script. ', [['www','upgrade.php',103]], 1],
'cache_expire': ['cache_expire', 'Garbage collects data stored the cache.  Data is deleted if it was stored for longer than the specified expiry. ', [['www','cache.inc.php',142]], 7],
'upgrade_apply': ['upgrade_apply', 'Applies the upgrade. ', [['www','upgrade.php',255]], 0],
'upgrade_access_denied': ['upgrade_access_denied', 'Displays a page notifying the user that he or she does not have permission to run the upgrade script. ', [['www','upgrade.php',382]], 1],
'user_init': ['user_init', 'Initialises the user system.  Loads data for the currently logged-in user, if any. ', [['www','user.inc.php',56],['www','user.inc',56]], 2],
'user_load': ['user_load', 'Loads user data for a specified user name. ', [['www','user.inc.php',115],['www','user.inc',89]], 18],
'upgrade_get_version': ['upgrade_get_version', 'Detects the current installed version of SimpleID ', [['www','upgrade.php',292]], 2],
'log_fatal': ['log_fatal', 'Logs a FATAL message. ', [['www','log.inc',121],['www','log.inc.php',134]], 16],
'upgrade_selection': ['upgrade_selection', 'Detects the current installed version of SimpleID, selects the individual upgrade functions applicable to this upgrade and displays the upgrade selection page. ', [['www','upgrade.php',200]], 1],
'cache_delete': ['cache_delete', 'Deletes data from the cache. ', [['www','cache.inc.php',99],['www','cache.inc',98]], 12],
'store_set': ['store_set', 'Saves an application setting. ', [['www','filesystem.store.php',278],['www','filesystem.store.inc',230]], 6],
'upgrade_delete_token': ['upgrade_delete_token', 'Deletes the site-token setting for a more secure version ', [['www','upgrade.php',458]], 0],
'upgrade_set_version': ['upgrade_set_version', 'Sets the current version of SimpleID. ', [['www','upgrade.php',305]], 0],
'locale_init': ['locale_init', 'Initialises the localisation system. ', [['www','locale.inc.php',33]], 2],
'simpleweb_run': ['simpleweb_run', 'Handles a supplied request, based on a set of routes. ', [['www','simpleweb.inc',61],['www','simpleweb.inc.php',61]], 2],
'user_save': ['user_save', 'Stores user data for a specified user name. ', [['www','user.inc.php',156],['www','user.inc',130]], 9],
'upgrade_rp_to_store': ['upgrade_rp_to_store', 'Moves the user\'s site preferences from the cache to the store. ', [['www','upgrade.php',408]], 0],
'cache_set': ['cache_set', 'Stores data into the cache. ', [['www','cache.inc.php',37],['www','cache.inc',37]], 15],
'_upgrade_version_reverse_sort': ['_upgrade_version_reverse_sort', 'Callback function for uksort() to reverse sort version numbers. ', [['www','upgrade.php',353]], 0],
'extension_init': ['extension_init', 'Initialises the extension mechanism.  This function looks up the extensions to load in the {@link SIMPLEID_EXTENSIONS} constants, loads them, then calls the ns hook. ', [['www','common.inc',328],['www','common.inc.php',591]], 2],
'store_del': ['store_del', 'Deletes an application setting. ', [['www','filesystem.store.php',301],['www','filesystem.store.inc',253]], 1],
'upgrade_config_inc_to_php': ['upgrade_config_inc_to_php', 'Checks that config.inc has been renamed to config.php ', [['www','upgrade.php',447]], 0],
'validate_form_token': ['validate_form_token', 'Checks whether a form token is valid ', [['www','common.inc',298],['www','common.inc.php',541]], 7],
'set_message': ['set_message', 'Sets a message to display to the user on the rendered SimpleID page. ', [['www','common.inc',37],['www','common.inc.php',37]], 46],
'store_get': ['store_get', 'Loads an application setting. ', [['www','filesystem.store.php',252],['www','filesystem.store.inc',204]], 11],
'upgrade_user_init': ['upgrade_user_init', 'Determines whether the current user has permission to run this script. ', [['www','upgrade.php',364]], 1],
'bignum_loaded': ['bignum_loaded', 'Returns whether either the GMP or the BCMath library is installed.  If neither of these libraries are installed, the functions in this file will not work. ', [['www','bignum.inc',44],['www','bignum.inc.php',44]], 2],
'get_base_path': ['get_base_path', 'Returns the base URL path, relative to the current host, of the SimpleID installation. ', [['www','common.inc',213],['www','common.inc.php',384]], 20],
'out': ['out', 'prints the parsed text ', [['www/lib','xtemplate.class.php',777],['www/lib','xtemplate-php4.class.php',761]], 28],
'assign': ['assign', 'assign a variable ', [['www/lib','xtemplate.class.php',438],['www/lib','xtemplate-php4.class.php',422]], 245],
'parse': ['parse', 'Parses an XRDS document. ', [['www','discovery.inc',552],['www/lib','xtemplate.class.php',511],['www/lib','xtemplate-php4.class.php',495],['www','discovery.inc.php',462]], 122],
'count': ['count', '', [], 24],
'is_writeable': ['is_writeable', '', [], 6],
'file_exists': ['file_exists', '', [], 22],
'uksort': ['uksort', '', [], 2],
'implode': ['implode', '', [], 26],
'is_dir': ['is_dir', '', [], 6],
'defined': ['defined', '', [], 14],
'preg_match': ['preg_match', '', [], 42],
'array': ['array', '', [], 390],
'version_compare': ['version_compare', '', [], 8],
'define': ['define', '', [], 95],
'strtolower': ['strtolower', '', [], 35],
'call_user_func': ['call_user_func', '', [], 7],
'is_numeric': ['is_numeric', '', [], 2],
'ini_get': ['ini_get', '', [], 18],
'explode': ['explode', '', [], 53],
'opendir': ['opendir', '', [], 10],
'filetype': ['filetype', '', [], 10],
'isset': ['isset', '', [], 405],
'function_exists': ['function_exists', '', [], 49],
'die': ['die', '', [], 4],
'readdir': ['readdir', '', [], 10],
'array_merge': ['array_merge', '', [], 47]};
CLASS_DATA={
'xtemplate': ['xtemplate', 'XTemplate PHP templating engine ', [['www/lib','xtemplate.class.php',6],['www/lib','xtemplate-php4.class.php',6]], 12]};
CONST_DATA={
'CACHE_DIR': ['CACHE_DIR', '', [['www','upgrade.php',72],['www','index.php',58]], 16],
'PRE_0_7_0_VERSION': ['PRE_0_7_0_VERSION', '', [['www','upgrade.php',74]], 1],
'SIMPLEID_VERSION': ['SIMPLEID_VERSION', '', [['www','version.inc',33],['www','version.inc.php',33]], 7],
'UPGRADE_LEGACY_CONFIG_INC': ['UPGRADE_LEGACY_CONFIG_INC', '', [['www','upgrade.php',58]], 2]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Mon Apr  6 15:06:20 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
